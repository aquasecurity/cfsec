{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+","tags":false},"docs":[{"location":"","text":"<p></p> <p> </p> <p><code>cfsec</code> is a static analysis security scanner for your <code>yaml</code> and <code>json</code> CloudFormation templates.</p> <p>Designed to run locally and in your CI pipelines, developer-friendly output and fully documented checks mean detection and remediation can take place as quickly and efficiently as possible</p> <p><code>cfsec</code> takes a developer-first approach to scanning your CloudFormation templates; using static analysis and deep integration with the official HCL parser it ensures thatsecurity issues can be detected before your infrastructure changes take effect.</p> <p> </p>   Demo: Misconfiguration Detection  <p><code>cfsec</code> is an Aqua Security open source project. Learn about our open source work and portfolio here. Contact us about any matter by opening a GitHub Discussion here</p>","title":"HOME"},{"location":"checks/api-gateway/enable-access-logging/","text":"","title":"enable-access-logging"},{"location":"checks/api-gateway/enable-access-logging/#explanation","text":"<p>API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages.</p>","title":"Explanation"},{"location":"checks/api-gateway/enable-access-logging/#possible-impact","text":"<p>Logging provides vital information about access and usage</p>","title":"Possible Impact"},{"location":"checks/api-gateway/enable-access-logging/#suggested-resolution","text":"<p>Enable logging for API Gateway stages</p>","title":"Suggested Resolution"},{"location":"checks/api-gateway/enable-access-logging/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0001 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad Example of ApiGateway\nResources:\n  BadApi:\n    Type: AWS::ApiGatewayV2::Api\n  BadApiStage:\n    Type: AWS::ApiGatewayV2::Stage\n    Properties:\n      AccessLogSettings:\n        Format: json\n      ApiId: !Ref BadApi\n      StageName: BadApiStage\n</code></pre>","title":"Insecure Example"},{"location":"checks/api-gateway/enable-access-logging/#secure-example","text":"<p>The following example will pass the AVD-AWS-0001 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good Example of ApiGateway\nResources:\n  GoodApi:\n    Type: AWS::ApiGatewayV2::Api\n  GoodApiStage:\n    Type: AWS::ApiGatewayV2::Stage\n    Properties:\n      AccessLogSettings:\n        DestinationArn: gateway-logging\n        Format: json\n      ApiId: !Ref GoodApi\n      StageName: GoodApiStage\n</code></pre>","title":"Secure Example"},{"location":"checks/api-gateway/enable-access-logging/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-logging.html</li> </ul>","title":"Related Links"},{"location":"checks/athena/enable-at-rest-encryption/","text":"","title":"enable-at-rest-encryption"},{"location":"checks/athena/enable-at-rest-encryption/#explanation","text":"<p>Athena databases and workspace result sets should be encrypted at rests. These databases and query sets are generally derived from data in S3 buckets and should have the same level of at rest protection.</p>","title":"Explanation"},{"location":"checks/athena/enable-at-rest-encryption/#possible-impact","text":"<p>Data can be read if the Athena Database is compromised</p>","title":"Possible Impact"},{"location":"checks/athena/enable-at-rest-encryption/#suggested-resolution","text":"<p>Enable encryption at rest for Athena databases and workgroup configurations</p>","title":"Suggested Resolution"},{"location":"checks/athena/enable-at-rest-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0006 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      Name: badExample\n      WorkGroupConfiguration:\n        ResultConfiguration:\n    Type: AWS::Athena::WorkGroup\n</code></pre>","title":"Insecure Example"},{"location":"checks/athena/enable-at-rest-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0006 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      Name: goodExample\n      WorkGroupConfiguration:\n        ResultConfiguration:\n          EncryptionConfiguration:\n            EncryptionOption: SSE_KMS\n    Type: AWS::Athena::WorkGroup\n</code></pre>","title":"Secure Example"},{"location":"checks/athena/enable-at-rest-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/athena/latest/ug/encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/athena/no-encryption-override/","text":"","title":"no-encryption-override"},{"location":"checks/athena/no-encryption-override/#explanation","text":"<p>Athena workgroup configuration should be enforced to prevent client side changes to disable encryption settings.</p>","title":"Explanation"},{"location":"checks/athena/no-encryption-override/#possible-impact","text":"<p>Clients can ignore encryption requirements</p>","title":"Possible Impact"},{"location":"checks/athena/no-encryption-override/#suggested-resolution","text":"<p>Enforce the configuration to prevent client overrides</p>","title":"Suggested Resolution"},{"location":"checks/athena/no-encryption-override/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0007 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      Name: badExample\n      WorkGroupConfiguration:\n        EnforceWorkGroupConfiguration: false\n        ResultConfiguration:\n          EncryptionConfiguration:\n            EncryptionOption: SSE_KMS\n    Type: AWS::Athena::WorkGroup\n</code></pre>","title":"Insecure Example"},{"location":"checks/athena/no-encryption-override/#secure-example","text":"<p>The following example will pass the AVD-AWS-0007 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      Name: goodExample\n      WorkGroupConfiguration:\n        EnforceWorkGroupConfiguration: true\n        ResultConfiguration:\n          EncryptionConfiguration:\n            EncryptionOption: SSE_KMS\n    Type: AWS::Athena::WorkGroup\n</code></pre>","title":"Secure Example"},{"location":"checks/athena/no-encryption-override/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/athena/latest/ug/manage-queries-control-costs-with-workgroups.html</li> </ul>","title":"Related Links"},{"location":"checks/autoscaling/enable-at-rest-encryption/","text":"","title":"enable-at-rest-encryption"},{"location":"checks/autoscaling/enable-at-rest-encryption/#explanation","text":"<p>Block devices should be encrypted to ensure sensitive data is held securely at rest.</p>","title":"Explanation"},{"location":"checks/autoscaling/enable-at-rest-encryption/#possible-impact","text":"<p>The block device could be compromised and read from</p>","title":"Possible Impact"},{"location":"checks/autoscaling/enable-at-rest-encryption/#suggested-resolution","text":"<p>Turn on encryption for all block devices</p>","title":"Suggested Resolution"},{"location":"checks/autoscaling/enable-at-rest-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0008 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      BlockDeviceMappings:\n        - DeviceName: root\n          Ebs:\n            Encrypted: true\n        - DeviceName: data\n          Ebs:\n            Encrypted: false\n      ImageId: ami-123456\n      InstanceType: t2.small\n    Type: AWS::AutoScaling::LaunchConfiguration\n</code></pre>","title":"Insecure Example"},{"location":"checks/autoscaling/enable-at-rest-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0008 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      BlockDeviceMappings:\n        - DeviceName: root\n          Ebs:\n            Encrypted: true\n      ImageId: ami-123456\n      InstanceType: t2.small\n    Type: AWS::AutoScaling::LaunchConfiguration\n</code></pre>","title":"Secure Example"},{"location":"checks/autoscaling/enable-at-rest-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html</li> </ul>","title":"Related Links"},{"location":"checks/autoscaling/no-public-ip/","text":"","title":"no-public-ip"},{"location":"checks/autoscaling/no-public-ip/#explanation","text":"<p>You should limit the provision of public IP addresses for resources. Resources should not be exposed on the public internet, but should have access limited to consumers required for the function of your application.</p>","title":"Explanation"},{"location":"checks/autoscaling/no-public-ip/#possible-impact","text":"<p>The instance or configuration is publicly accessible</p>","title":"Possible Impact"},{"location":"checks/autoscaling/no-public-ip/#suggested-resolution","text":"<p>Set the instance to not be publicly accessible</p>","title":"Suggested Resolution"},{"location":"checks/autoscaling/no-public-ip/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0009 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      AssociatePublicIpAddress: true\n      ImageId: ami-123456\n      InstanceType: t2.small\n    Type: AWS::AutoScaling::LaunchConfiguration\n</code></pre>","title":"Insecure Example"},{"location":"checks/autoscaling/no-public-ip/#secure-example","text":"<p>The following example will pass the AVD-AWS-0009 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      ImageId: ami-123456\n      InstanceType: t2.small\n    Type: AWS::AutoScaling::LaunchConfiguration\n</code></pre>","title":"Secure Example"},{"location":"checks/autoscaling/no-public-ip/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html</li> </ul>","title":"Related Links"},{"location":"checks/cloudfront/enable-logging/","text":"","title":"enable-logging"},{"location":"checks/cloudfront/enable-logging/#explanation","text":"<p>You should configure CloudFront Access Logging to create log files that contain detailed information about every user request that CloudFront receives</p>","title":"Explanation"},{"location":"checks/cloudfront/enable-logging/#possible-impact","text":"<p>Logging provides vital information about access and usage</p>","title":"Possible Impact"},{"location":"checks/cloudfront/enable-logging/#suggested-resolution","text":"<p>Enable logging for CloudFront distributions</p>","title":"Suggested Resolution"},{"location":"checks/cloudfront/enable-logging/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0010 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      DistributionConfig:\n        DefaultCacheBehavior:\n          TargetOriginId: target\n          ViewerProtocolPolicy: https-only\n        Enabled: true\n        Origins:\n          - DomainName: https://some.domain\n            Id: somedomain1\n    Type: AWS::CloudFront::Distribution\n</code></pre>","title":"Insecure Example"},{"location":"checks/cloudfront/enable-logging/#secure-example","text":"<p>The following example will pass the AVD-AWS-0010 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      DistributionConfig:\n        DefaultCacheBehavior:\n          TargetOriginId: target\n          ViewerProtocolPolicy: https-only\n        Enabled: true\n        Logging:\n          Bucket: logging-bucket\n        Origins:\n          - DomainName: https://some.domain\n            Id: somedomain1\n    Type: AWS::CloudFront::Distribution\n</code></pre>","title":"Secure Example"},{"location":"checks/cloudfront/enable-logging/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html</li> </ul>","title":"Related Links"},{"location":"checks/cloudfront/enable-waf/","text":"","title":"enable-waf"},{"location":"checks/cloudfront/enable-waf/#explanation","text":"<p>You should configure a Web Application Firewall in front of your CloudFront distribution. This will mitigate many types of attacks on your web application.</p>","title":"Explanation"},{"location":"checks/cloudfront/enable-waf/#possible-impact","text":"<p>Complex web application attacks can more easily be performed without a WAF</p>","title":"Possible Impact"},{"location":"checks/cloudfront/enable-waf/#suggested-resolution","text":"<p>Enable WAF for the CloudFront distribution</p>","title":"Suggested Resolution"},{"location":"checks/cloudfront/enable-waf/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0011 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      DistributionConfig:\n        DefaultCacheBehavior:\n          TargetOriginId: target\n          ViewerProtocolPolicy: https-only\n        Enabled: true\n        Logging:\n          Bucket: logging-bucket\n        Origins:\n          - DomainName: https://some.domain\n            Id: somedomain1\n    Type: AWS::CloudFront::Distribution\n</code></pre>","title":"Insecure Example"},{"location":"checks/cloudfront/enable-waf/#secure-example","text":"<p>The following example will pass the AVD-AWS-0011 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      DistributionConfig:\n        DefaultCacheBehavior:\n          TargetOriginId: target\n          ViewerProtocolPolicy: https-only\n        Enabled: true\n        Logging:\n          Bucket: logging-bucket\n        Origins:\n          - DomainName: https://some.domain\n            Id: somedomain1\n        WebACLId: waf_id\n    Type: AWS::CloudFront::Distribution\n</code></pre>","title":"Secure Example"},{"location":"checks/cloudfront/enable-waf/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/waf/latest/developerguide/cloudfront-features.html</li> </ul>","title":"Related Links"},{"location":"checks/cloudfront/enforce-https/","text":"","title":"enforce-https"},{"location":"checks/cloudfront/enforce-https/#explanation","text":"<p>Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth.</p> <p>You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.</p>","title":"Explanation"},{"location":"checks/cloudfront/enforce-https/#possible-impact","text":"<p>CloudFront is available through an unencrypted connection</p>","title":"Possible Impact"},{"location":"checks/cloudfront/enforce-https/#suggested-resolution","text":"<p>Only allow HTTPS for CloudFront distribution communication</p>","title":"Suggested Resolution"},{"location":"checks/cloudfront/enforce-https/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0012 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      DistributionConfig:\n        DefaultCacheBehavior:\n          TargetOriginId: target\n          ViewerProtocolPolicy: allow-all\n        Enabled: true\n        Logging:\n          Bucket: logging-bucket\n        Origins:\n          - DomainName: https://some.domain\n            Id: somedomain1\n        WebACLId: waf_id\n    Type: AWS::CloudFront::Distribution\n</code></pre>","title":"Insecure Example"},{"location":"checks/cloudfront/enforce-https/#secure-example","text":"<p>The following example will pass the AVD-AWS-0012 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      DistributionConfig:\n        DefaultCacheBehavior:\n          TargetOriginId: target\n          ViewerProtocolPolicy: https-only\n        Enabled: true\n        Logging:\n          Bucket: logging-bucket\n        Origins:\n          - DomainName: https://some.domain\n            Id: somedomain1\n        WebACLId: waf_id\n    Type: AWS::CloudFront::Distribution\n</code></pre>","title":"Secure Example"},{"location":"checks/cloudfront/enforce-https/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-cloudfront-to-s3-origin.html</li> </ul>","title":"Related Links"},{"location":"checks/cloudfront/use-secure-tls-policy/","text":"","title":"use-secure-tls-policy"},{"location":"checks/cloudfront/use-secure-tls-policy/#explanation","text":"<p>You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.</p>","title":"Explanation"},{"location":"checks/cloudfront/use-secure-tls-policy/#possible-impact","text":"<p>Outdated SSL policies increase exposure to known vulnerabilities</p>","title":"Possible Impact"},{"location":"checks/cloudfront/use-secure-tls-policy/#suggested-resolution","text":"<p>Use the most modern TLS/SSL policies available</p>","title":"Suggested Resolution"},{"location":"checks/cloudfront/use-secure-tls-policy/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0013 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      DistributionConfig:\n        DefaultCacheBehavior:\n          TargetOriginId: target\n          ViewerProtocolPolicy: https-only\n        Enabled: true\n        Logging:\n          Bucket: logging-bucket\n        Origins:\n          - DomainName: https://some.domain\n            Id: somedomain1\n        ViewerCertificate:\n          MinimumProtocolVersion: TLSv1.0\n    Type: AWS::CloudFront::Distribution\n</code></pre>","title":"Insecure Example"},{"location":"checks/cloudfront/use-secure-tls-policy/#secure-example","text":"<p>The following example will pass the AVD-AWS-0013 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      DistributionConfig:\n        DefaultCacheBehavior:\n          TargetOriginId: target\n          ViewerProtocolPolicy: https-only\n        Enabled: true\n        Logging:\n          Bucket: logging-bucket\n        Origins:\n          - DomainName: https://some.domain\n            Id: somedomain1\n        ViewerCertificate:\n          MinimumProtocolVersion: TLSv1.2_2021\n    Type: AWS::CloudFront::Distribution\n</code></pre>","title":"Secure Example"},{"location":"checks/cloudfront/use-secure-tls-policy/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html</li> </ul>","title":"Related Links"},{"location":"checks/cloudtrail/enable-all-regions/","text":"","title":"enable-all-regions"},{"location":"checks/cloudtrail/enable-all-regions/#explanation","text":"<p>When creating Cloudtrail in the AWS Management Console the trail is configured by default to be multi-region, this isn't the case with the Terraform resource. Cloudtrail should cover the full AWS account to ensure you can track changes in regions you are not actively operting in.</p>","title":"Explanation"},{"location":"checks/cloudtrail/enable-all-regions/#possible-impact","text":"<p>Activity could be happening in your account in a different region</p>","title":"Possible Impact"},{"location":"checks/cloudtrail/enable-all-regions/#suggested-resolution","text":"<p>Enable Cloudtrail in all regions</p>","title":"Suggested Resolution"},{"location":"checks/cloudtrail/enable-all-regions/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0014 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::CloudTrail::Trail\n    Properties:\n      IsLogging: true\n      IsMultiRegionTrail: false     \n      S3BucketName: \"CloudtrailBucket\"\n      S3KeyPrefix: \"/trailing\"\n      TrailName: \"Cloudtrail\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/cloudtrail/enable-all-regions/#secure-example","text":"<p>The following example will pass the AVD-AWS-0014 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::CloudTrail::Trail\n    Properties:\n      IsLogging: true\n      IsMultiRegionTrail: true     \n      S3BucketName: \"CloudtrailBucket\"\n      S3KeyPrefix: \"/trailing\"\n      TrailName: \"Cloudtrail\"\n</code></pre>","title":"Secure Example"},{"location":"checks/cloudtrail/enable-all-regions/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/awscloudtrail/latest/userguide/receive-cloudtrail-log-files-from-multiple-regions.html</li> </ul>","title":"Related Links"},{"location":"checks/cloudtrail/enable-at-rest-encryption/","text":"","title":"enable-at-rest-encryption"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#explanation","text":"<p>Cloudtrail logs should be encrypted at rest to secure the sensitive data. Cloudtrail logs record all activity that occurs in the the account through API calls and would be one of the first places to look when reacting to a breach.</p>","title":"Explanation"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#possible-impact","text":"<p>Data can be freely read if compromised</p>","title":"Possible Impact"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#suggested-resolution","text":"<p>Enable encryption at rest</p>","title":"Suggested Resolution"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0015 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::CloudTrail::Trail\n    Properties:\n      IsLogging: true\n      IsMultiRegionTrail: false     \n      S3BucketName: \"CloudtrailBucket\"\n      S3KeyPrefix: \"/trailing\"\n      TrailName: \"Cloudtrail\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0015 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::CloudTrail::Trail\n    Properties:\n      IsLogging: true\n      IsMultiRegionTrail: true\n      KmsKeyId: \"alias/CloudtrailKey\"\n      S3BucketName: \"CloudtrailBucket\"\n      S3KeyPrefix: \"/trailing\"\n      TrailName: \"Cloudtrail\"\n</code></pre>","title":"Secure Example"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/awscloudtrail/latest/userguide/encrypting-cloudtrail-log-files-with-aws-kms.html</li> </ul>","title":"Related Links"},{"location":"checks/cloudtrail/enable-log-validation/","text":"","title":"enable-log-validation"},{"location":"checks/cloudtrail/enable-log-validation/#explanation","text":"<p>Log validation should be activated on Cloudtrail logs to prevent the tampering of the underlying data in the S3 bucket. It is feasible that a rogue actor compromising an AWS account might want to modify the log data to remove trace of their actions.</p>","title":"Explanation"},{"location":"checks/cloudtrail/enable-log-validation/#possible-impact","text":"<p>Illicit activity could be removed from the logs</p>","title":"Possible Impact"},{"location":"checks/cloudtrail/enable-log-validation/#suggested-resolution","text":"<p>Turn on log validation for Cloudtrail</p>","title":"Suggested Resolution"},{"location":"checks/cloudtrail/enable-log-validation/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0016 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::CloudTrail::Trail\n    Properties:\n      IsLogging: true\n      IsMultiRegionTrail: false\n      S3BucketName: \"CloudtrailBucket\"\n      S3KeyPrefix: \"/trailing\"\n      TrailName: \"Cloudtrail\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/cloudtrail/enable-log-validation/#secure-example","text":"<p>The following example will pass the AVD-AWS-0016 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::CloudTrail::Trail\n    Properties:\n      IsLogging: true\n      IsMultiRegionTrail: true\n      EnableLogFileValidation: true\n      S3BucketName: \"CloudtrailBucket\"\n      S3KeyPrefix: \"/trailing\"\n      TrailName: \"Cloudtrail\"\n</code></pre>","title":"Secure Example"},{"location":"checks/cloudtrail/enable-log-validation/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-log-file-validation-intro.html</li> </ul>","title":"Related Links"},{"location":"checks/cloudwatch/log-group-customer-key/","text":"","title":"log-group-customer-key"},{"location":"checks/cloudwatch/log-group-customer-key/#explanation","text":"<p>CloudWatch log groups are encrypted by default, however, to get the full benefit of controlling key rotation and other KMS aspects a KMS CMK should be used.</p>","title":"Explanation"},{"location":"checks/cloudwatch/log-group-customer-key/#possible-impact","text":"<p>Log data may be leaked if the logs are compromised. No auditing of who have viewed the logs.</p>","title":"Possible Impact"},{"location":"checks/cloudwatch/log-group-customer-key/#suggested-resolution","text":"<p>Enable CMK encryption of CloudWatch Log Groups</p>","title":"Suggested Resolution"},{"location":"checks/cloudwatch/log-group-customer-key/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0017 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      KmsKeyId: \"\"\n      LogGroupName: \"aws/lambda/badExample\"\n      RetentionInDays: 30\n</code></pre>","title":"Insecure Example"},{"location":"checks/cloudwatch/log-group-customer-key/#secure-example","text":"<p>The following example will pass the AVD-AWS-0017 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      KmsKeyId: \"arn:aws:kms:us-west-2:111122223333:key/lambdalogging\"\n      LogGroupName: \"aws/lambda/goodExample\"\n      RetentionInDays: 30\n</code></pre>","title":"Secure Example"},{"location":"checks/cloudwatch/log-group-customer-key/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/encrypt-log-data-kms.html</li> </ul>","title":"Related Links"},{"location":"checks/codebuild/enable-encryption/","text":"","title":"enable-encryption"},{"location":"checks/codebuild/enable-encryption/#explanation","text":"<p>All artifacts produced by your CodeBuild project pipeline should always be encrypted</p>","title":"Explanation"},{"location":"checks/codebuild/enable-encryption/#possible-impact","text":"<p>CodeBuild project artifacts are unencrypted</p>","title":"Possible Impact"},{"location":"checks/codebuild/enable-encryption/#suggested-resolution","text":"<p>Enable encryption for CodeBuild project artifacts</p>","title":"Suggested Resolution"},{"location":"checks/codebuild/enable-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0018 check.</p> <pre><code>---\nResources:\n  GoodProject:\n    Type: AWS::CodeBuild::Project\n    Properties:\n      Artifacts:\n        ArtifactIdentifier: \"String\"\n        EncryptionDisabled: true\n        Location: \"String\"\n        Name: \"String\"\n        NamespaceType: \"String\"\n        OverrideArtifactName: false\n        Packaging: \"String\"\n        Path: \"String\"\n        Type: \"String\"\n      SecondaryArtifacts:\n        - ArtifactIdentifier: \"String\"\n          EncryptionDisabled: false\n          Location: \"String\"\n          Name: \"String\"\n          NamespaceType: \"String\"\n          OverrideArtifactName: false\n          Packaging: \"String\"\n          Path: \"String\"\n          Type: \"String\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/codebuild/enable-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0018 check.</p> <pre><code>---\nResources:\n  GoodProject:\n    Type: AWS::CodeBuild::Project\n    Properties:\n      Artifacts:\n        ArtifactIdentifier: \"String\"\n        EncryptionDisabled: false\n        Location: \"String\"\n        Name: \"String\"\n        NamespaceType: \"String\"\n        OverrideArtifactName: false\n        Packaging: \"String\"\n        Path: \"String\"\n        Type: \"String\"\n      SecondaryArtifacts:\n        - ArtifactIdentifier: \"String\"\n          EncryptionDisabled: false\n          Location: \"String\"\n          Name: \"String\"\n          NamespaceType: \"String\"\n          OverrideArtifactName: false\n          Packaging: \"String\"\n          Path: \"String\"\n          Type: \"String\"\n</code></pre>","title":"Secure Example"},{"location":"checks/codebuild/enable-encryption/#related-links","text":"<ul> <li> <p>https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-codebuild-project-artifacts.html</p> </li> <li> <p>https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codebuild-project.html</p> </li> </ul>","title":"Related Links"},{"location":"checks/config/aggregate-all-regions/","text":"","title":"aggregate-all-regions"},{"location":"checks/config/aggregate-all-regions/#explanation","text":"<p>The configuration aggregator should be configured with all_regions for the source. </p> <p>This will help limit the risk of any unmonitored configuration in regions that are thought to be unused.</p>","title":"Explanation"},{"location":"checks/config/aggregate-all-regions/#possible-impact","text":"<p>Sources that aren't covered by the aggregator are not include in the configuration</p>","title":"Possible Impact"},{"location":"checks/config/aggregate-all-regions/#suggested-resolution","text":"<p>Set the aggregator to cover all regions</p>","title":"Suggested Resolution"},{"location":"checks/config/aggregate-all-regions/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0019 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Config::ConfigurationAggregator\n    Properties:\n      ConfigurationAggregatorName: \"BadAccountLevelAggregation\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/config/aggregate-all-regions/#secure-example","text":"<p>The following example will pass the AVD-AWS-0019 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::Config::ConfigurationAggregator\n    Properties:\n      AccountAggregationSources:\n        - AllAwsRegions: true\n      ConfigurationAggregatorName: \"GoodAccountLevelAggregation\"\n</code></pre>","title":"Secure Example"},{"location":"checks/config/aggregate-all-regions/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/config/latest/developerguide/aggregate-data.html</li> </ul>","title":"Related Links"},{"location":"checks/documentdb/enable-log-export/","text":"","title":"enable-log-export"},{"location":"checks/documentdb/enable-log-export/#explanation","text":"<p>Document DB does not have auditing by default. To ensure that you are able to accurately audit the usage of your DocumentDB cluster you should enable export logs.</p>","title":"Explanation"},{"location":"checks/documentdb/enable-log-export/#possible-impact","text":"<p>Limited visibility of audit trail for changes to the DocumentDB</p>","title":"Possible Impact"},{"location":"checks/documentdb/enable-log-export/#suggested-resolution","text":"<p>Enable export logs</p>","title":"Suggested Resolution"},{"location":"checks/documentdb/enable-log-export/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0020 check.</p> <pre><code>---\n Resources:\n  BadExample:\n    Type: \"AWS::DocDB::DBCluster\"\n    Properties:\n      BackupRetentionPeriod: 8\n      DBClusterIdentifier: sample-cluster\n      DBClusterParameterGroupName: default.docdb3.6\n  BadInstanceExample:\n    Type: \"AWS::DocDB::DBInstance\"\n    Properties:\n      AutoMinorVersionUpgrade: true\n      AvailabilityZone: us-east-1c\n      DBClusterIdentifier: sample-cluster\n      DBInstanceClass: db.r5.large\n      DBInstanceIdentifier: sample-cluster-instance-0\n      PreferredMaintenanceWindow: 'sat:06:54-sat:07:24'\n</code></pre>","title":"Insecure Example"},{"location":"checks/documentdb/enable-log-export/#secure-example","text":"<p>The following example will pass the AVD-AWS-0020 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: \"AWS::DocDB::DBCluster\"\n    Properties:\n      BackupRetentionPeriod : 8\n      DBClusterIdentifier : \"sample-cluster\"\n      DBClusterParameterGroupName : \"default.docdb3.6\"\n      KmsKeyId : \"your-kms-key-id\"\n      EnableCloudwatchLogsExports:\n      - audit\n      - profiler\n  InstanceInstanceExample:\n    Type: \"AWS::DocDB::DBInstance\"\n    Properties:\n      AutoMinorVersionUpgrade: true\n      AvailabilityZone: \"us-east-1c\"\n      DBClusterIdentifier: \"sample-cluster\"\n      DBInstanceClass: \"db.r5.large\"\n      DBInstanceIdentifier: \"sample-cluster-instance-0\"\n      PreferredMaintenanceWindow: \"sat:06:54-sat:07:24\"\n</code></pre>","title":"Secure Example"},{"location":"checks/documentdb/enable-log-export/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/documentdb/latest/developerguide/event-auditing.html</li> </ul>","title":"Related Links"},{"location":"checks/documentdb/enable-storage-encryption/","text":"","title":"enable-storage-encryption"},{"location":"checks/documentdb/enable-storage-encryption/#explanation","text":"<p>Encryption of the underlying storage used by DocumentDB ensures that if their is compromise of the disks, the data is still protected.</p>","title":"Explanation"},{"location":"checks/documentdb/enable-storage-encryption/#possible-impact","text":"<p>Unencrypted sensitive data is vulnerable to compromise.</p>","title":"Possible Impact"},{"location":"checks/documentdb/enable-storage-encryption/#suggested-resolution","text":"<p>Enable storage encryption</p>","title":"Suggested Resolution"},{"location":"checks/documentdb/enable-storage-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0021 check.</p> <pre><code>---\n Resources:\n  BadExample:\n    Type: \"AWS::DocDB::DBCluster\"\n    Properties:\n      BackupRetentionPeriod: 8\n      DBClusterIdentifier: sample-cluster\n      DBClusterParameterGroupName: default.docdb3.6\n  BadInstanceExample:\n    Type: \"AWS::DocDB::DBInstance\"\n    Properties:\n      AutoMinorVersionUpgrade: true\n      AvailabilityZone: us-east-1c\n      DBClusterIdentifier: sample-cluster\n      DBInstanceClass: db.r5.large\n      DBInstanceIdentifier: sample-cluster-instance-0\n      PreferredMaintenanceWindow: 'sat:06:54-sat:07:24'\n</code></pre>","title":"Insecure Example"},{"location":"checks/documentdb/enable-storage-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0021 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: \"AWS::DocDB::DBCluster\"\n    Properties:\n      BackupRetentionPeriod : 8\n      DBClusterIdentifier : \"sample-cluster\"\n      DBClusterParameterGroupName : \"default.docdb3.6\"\n      KmsKeyId : \"your-kms-key-id\"\n      StorageEncrypted: true\n      EnableCloudwatchLogsExports:\n      - audit\n      - profiler\n  InstanceInstanceExample:\n    Type: \"AWS::DocDB::DBInstance\"\n    Properties:\n      AutoMinorVersionUpgrade: true\n      AvailabilityZone: \"us-east-1c\"\n      DBClusterIdentifier: \"sample-cluster\"\n      DBInstanceClass: \"db.r5.large\"\n      DBInstanceIdentifier: \"sample-cluster-instance-0\"\n      PreferredMaintenanceWindow: \"sat:06:54-sat:07:24\"\n</code></pre>","title":"Secure Example"},{"location":"checks/documentdb/enable-storage-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/documentdb/latest/developerguide/encryption-at-rest.html</li> </ul>","title":"Related Links"},{"location":"checks/documentdb/encryption-customer-key/","text":"","title":"encryption-customer-key"},{"location":"checks/documentdb/encryption-customer-key/#explanation","text":"<p>Encryption using AWS keys provides protection for your DocumentDB underlying storage. To increase control of the encryption and manage factors like rotation use customer managed keys.</p>","title":"Explanation"},{"location":"checks/documentdb/encryption-customer-key/#possible-impact","text":"<p>Using AWS managed keys does not allow for fine grained control</p>","title":"Possible Impact"},{"location":"checks/documentdb/encryption-customer-key/#suggested-resolution","text":"<p>Enable encryption using customer managed keys</p>","title":"Suggested Resolution"},{"location":"checks/documentdb/encryption-customer-key/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0022 check.</p> <pre><code>---\n Resources:\n  BadExample:\n    Type: \"AWS::DocDB::DBCluster\"\n    Properties:\n      BackupRetentionPeriod: 8\n      DBClusterIdentifier: sample-cluster\n      DBClusterParameterGroupName: default.docdb3.6\n  BadInstanceExample:\n    Type: \"AWS::DocDB::DBInstance\"\n    Properties:\n      AutoMinorVersionUpgrade: true\n      AvailabilityZone: us-east-1c\n      DBClusterIdentifier: sample-cluster\n      DBInstanceClass: db.r5.large\n      DBInstanceIdentifier: sample-cluster-instance-0\n      PreferredMaintenanceWindow: 'sat:06:54-sat:07:24'\n</code></pre>","title":"Insecure Example"},{"location":"checks/documentdb/encryption-customer-key/#secure-example","text":"<p>The following example will pass the AVD-AWS-0022 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: \"AWS::DocDB::DBCluster\"\n    Properties:\n      BackupRetentionPeriod : 8\n      DBClusterIdentifier : \"sample-cluster\"\n      DBClusterParameterGroupName : \"default.docdb3.6\"\n      KmsKeyId : \"your-kms-key-id\"\n      EnableCloudwatchLogsExports:\n      - audit\n      - profiler\n  InstanceInstanceExample:\n    Type: \"AWS::DocDB::DBInstance\"\n    Properties:\n      AutoMinorVersionUpgrade: true\n      AvailabilityZone: \"us-east-1c\"\n      DBClusterIdentifier: \"sample-cluster\"\n      DBInstanceClass: \"db.r5.large\"\n      DBInstanceIdentifier: \"sample-cluster-instance-0\"\n      PreferredMaintenanceWindow: \"sat:06:54-sat:07:24\"\n</code></pre>","title":"Secure Example"},{"location":"checks/documentdb/encryption-customer-key/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/documentdb/latest/developerguide/security.encryption.ssl.public-key.html</li> </ul>","title":"Related Links"},{"location":"checks/dynamodb/enable-at-rest-encryption/","text":"","title":"enable-at-rest-encryption"},{"location":"checks/dynamodb/enable-at-rest-encryption/#explanation","text":"<p>Amazon DynamoDB Accelerator (DAX) encryption at rest provides an additional layer of data protection by helping secure your data from unauthorized access to the underlying storage.</p>","title":"Explanation"},{"location":"checks/dynamodb/enable-at-rest-encryption/#possible-impact","text":"<p>Data can be freely read if compromised</p>","title":"Possible Impact"},{"location":"checks/dynamodb/enable-at-rest-encryption/#suggested-resolution","text":"<p>Enable encryption at rest for DAX Cluster</p>","title":"Suggested Resolution"},{"location":"checks/dynamodb/enable-at-rest-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0023 check.</p> <pre><code>---\nResources:\n  daxCluster:\n    Type: AWS::DAX::Cluster\n    Properties:\n      ClusterName: \"MyDAXCluster\"\n      NodeType: \"dax.r3.large\"\n      ReplicationFactor: 1\n      IAMRoleARN: \"arn:aws:iam::111122223333:role/DaxAccess\"\n      Description: \"DAX cluster created with CloudFormation\"\n      SubnetGroupName: !Ref subnetGroupClu\n</code></pre>","title":"Insecure Example"},{"location":"checks/dynamodb/enable-at-rest-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0023 check.</p> <pre><code>---\nResources:\n  daxCluster:\n    Type: AWS::DAX::Cluster\n    Properties:\n      ClusterName: \"MyDAXCluster\"\n      NodeType: \"dax.r3.large\"\n      ReplicationFactor: 1\n      IAMRoleARN: \"arn:aws:iam::111122223333:role/DaxAccess\"\n      Description: \"DAX cluster created with CloudFormation\"\n      SSESpecification:\n        SSEEnabled: true\n</code></pre>","title":"Secure Example"},{"location":"checks/dynamodb/enable-at-rest-encryption/#related-links","text":"<ul> <li> <p>https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAXEncryptionAtRest.html</p> </li> <li> <p>https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dax-cluster.html</p> </li> </ul>","title":"Related Links"},{"location":"checks/ebs/enable-volume-encryption/","text":"","title":"enable-volume-encryption"},{"location":"checks/ebs/enable-volume-encryption/#explanation","text":"<p>By enabling encryption on EBS volumes you protect the volume, the disk I/O and any derived snapshots from compromise if intercepted.</p>","title":"Explanation"},{"location":"checks/ebs/enable-volume-encryption/#possible-impact","text":"<p>Unencrypted sensitive data is vulnerable to compromise.</p>","title":"Possible Impact"},{"location":"checks/ebs/enable-volume-encryption/#suggested-resolution","text":"<p>Enable encryption of EBS volumes</p>","title":"Suggested Resolution"},{"location":"checks/ebs/enable-volume-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0026 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::EC2::Volume\n    Properties:\n      Size: 100\n      AvailabilityZone: !GetAtt Ec2Instance.AvailabilityZone\n    DeletionPolicy: Snapshot\n</code></pre>","title":"Insecure Example"},{"location":"checks/ebs/enable-volume-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0026 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::EC2::Volume\n    Properties: \n      Size: 100\n      Encrypted: true\n      KmsKeyId: \"alias/volumeEncrypt\"\n    DeletionPolicy: Snapshot\n</code></pre>","title":"Secure Example"},{"location":"checks/ebs/enable-volume-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html</li> </ul>","title":"Related Links"},{"location":"checks/ebs/encryption-customer-key/","text":"","title":"encryption-customer-key"},{"location":"checks/ebs/encryption-customer-key/#explanation","text":"<p>Encryption using AWS keys provides protection for your EBS volume. To increase control of the encryption and manage factors like rotation use customer managed keys.</p>","title":"Explanation"},{"location":"checks/ebs/encryption-customer-key/#possible-impact","text":"<p>Using AWS managed keys does not allow for fine grained control</p>","title":"Possible Impact"},{"location":"checks/ebs/encryption-customer-key/#suggested-resolution","text":"<p>Enable encryption using customer managed keys</p>","title":"Suggested Resolution"},{"location":"checks/ebs/encryption-customer-key/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0027 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::EC2::Volume\n    Properties:\n      Size: 100\n      AvailabilityZone: !GetAtt Ec2Instance.AvailabilityZone\n    DeletionPolicy: Snapshot\n</code></pre>","title":"Insecure Example"},{"location":"checks/ebs/encryption-customer-key/#secure-example","text":"<p>The following example will pass the AVD-AWS-0027 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::EC2::Volume\n    Properties: \n      Size: 100\n      Encrypted: true\n      KmsKeyId: \"alias/volumeEncrypt\"\n    DeletionPolicy: Snapshot\n</code></pre>","title":"Secure Example"},{"location":"checks/ebs/encryption-customer-key/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html</li> </ul>","title":"Related Links"},{"location":"checks/ec2/no-secrets-in-user-data/","text":"","title":"no-secrets-in-user-data"},{"location":"checks/ec2/no-secrets-in-user-data/#explanation","text":"<p>EC2 instance data is used to pass start up information into the EC2 instance. This userdata must not contain access key credentials. Instead use an IAM Instance Profile assigned to the instance to grant access to other AWS Services.</p>","title":"Explanation"},{"location":"checks/ec2/no-secrets-in-user-data/#possible-impact","text":"<p>User data is visible through the AWS Management console</p>","title":"Possible Impact"},{"location":"checks/ec2/no-secrets-in-user-data/#suggested-resolution","text":"<p>Remove sensitive data from the EC2 instance user-data</p>","title":"Suggested Resolution"},{"location":"checks/ec2/no-secrets-in-user-data/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0029 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::EC2::Instance\n    Properties:\n      ImageId: \"ami-79fd7eee\"\n      KeyName: \"testkey\"\n      UserData: export DATABASE_PASSWORD=password1234\n      BlockDeviceMappings:\n        - DeviceName: \"/dev/sdm\"\n          Ebs:\n            VolumeType: \"io1\"\n            Iops: \"200\"\n            DeleteOnTermination: \"false\"\n            VolumeSize: \"20\"\n        - DeviceName: \"/dev/sdk\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/ec2/no-secrets-in-user-data/#secure-example","text":"<p>The following example will pass the AVD-AWS-0029 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::EC2::Instance\n    Properties:\n      ImageId: \"ami-79fd7eee\"\n      KeyName: \"testkey\"\n      UserData: export SSM_PATH=/database/creds\n      BlockDeviceMappings:\n        - DeviceName: \"/dev/sdm\"\n          Ebs:\n            VolumeType: \"io1\"\n            Iops: \"200\"\n            DeleteOnTermination: \"false\"\n            VolumeSize: \"20\"\n        - DeviceName: \"/dev/sdk\"\n</code></pre>","title":"Secure Example"},{"location":"checks/ec2/no-secrets-in-user-data/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-add-user-data.html</li> </ul>","title":"Related Links"},{"location":"checks/ecr/enable-image-scans/","text":"","title":"enable-image-scans"},{"location":"checks/ecr/enable-image-scans/#explanation","text":"<p>Repository image scans should be enabled to ensure vulnerable software can be discovered and remediated as soon as possible.</p>","title":"Explanation"},{"location":"checks/ecr/enable-image-scans/#possible-impact","text":"<p>The ability to scan images is not being used and vulnerabilities will not be highlighted</p>","title":"Possible Impact"},{"location":"checks/ecr/enable-image-scans/#suggested-resolution","text":"<p>Enable ECR image scanning</p>","title":"Suggested Resolution"},{"location":"checks/ecr/enable-image-scans/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0030 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::ECR::Repository\n    Properties:\n      RepositoryName: \"test-repository\"\n      ImageScanningConfiguration:\n        ScanOnPush: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/ecr/enable-image-scans/#secure-example","text":"<p>The following example will pass the AVD-AWS-0030 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::ECR::Repository\n    Properties:\n      RepositoryName: \"test-repository\"\n      ImageTagImmutability: IMMUTABLE\n      ImageScanningConfiguration:\n        ScanOnPush: true\n      EncryptionConfiguration:\n        EncryptionType: KMS\n        KmsKey: \"alias/ecr-key\"\n</code></pre>","title":"Secure Example"},{"location":"checks/ecr/enable-image-scans/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html</li> </ul>","title":"Related Links"},{"location":"checks/ecr/enforce-immutable-repository/","text":"","title":"enforce-immutable-repository"},{"location":"checks/ecr/enforce-immutable-repository/#explanation","text":"<p>ECR images should be set to IMMUTABLE to prevent code injection through image mutation.</p> <p>This can be done by setting <code>image_tab_mutability</code> to <code>IMMUTABLE</code></p>","title":"Explanation"},{"location":"checks/ecr/enforce-immutable-repository/#possible-impact","text":"<p>Image tags could be overwritten with compromised images</p>","title":"Possible Impact"},{"location":"checks/ecr/enforce-immutable-repository/#suggested-resolution","text":"<p>Only use immutable images in ECR</p>","title":"Suggested Resolution"},{"location":"checks/ecr/enforce-immutable-repository/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0031 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::ECR::Repository\n    Properties:\n      RepositoryName: \"test-repository\"\n      ImageScanningConfiguration:\n        ScanOnPush: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/ecr/enforce-immutable-repository/#secure-example","text":"<p>The following example will pass the AVD-AWS-0031 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::ECR::Repository\n    Properties:\n      RepositoryName: \"test-repository\"\n      ImageTagMutability: IMMUTABLE\n      ImageScanningConfiguration:\n        ScanOnPush: false\n      EncryptionConfiguration:\n        EncryptionType: KMS\n        KmsKey: \"alias/ecr-key\"\n</code></pre>","title":"Secure Example"},{"location":"checks/ecr/enforce-immutable-repository/#related-links","text":"<ul> <li>https://sysdig.com/blog/toctou-tag-mutability/</li> </ul>","title":"Related Links"},{"location":"checks/ecr/no-public-access/","text":"","title":"no-public-access"},{"location":"checks/ecr/no-public-access/#explanation","text":"<p>Allowing public access to the ECR repository risks leaking sensitive of abusable information</p>","title":"Explanation"},{"location":"checks/ecr/no-public-access/#possible-impact","text":"<p>Risk of potential data leakage of sensitive artifacts</p>","title":"Possible Impact"},{"location":"checks/ecr/no-public-access/#suggested-resolution","text":"<p>Do not allow public access in the policy</p>","title":"Suggested Resolution"},{"location":"checks/ecr/no-public-access/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0032 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::ECR::Repository\n    Properties:\n      RepositoryName: \"test-repository\"\n      ImageScanningConfiguration:\n        ScanOnPush: false\n      RepositoryPolicyText: \n        Version: \"2012-10-17\"\n        Statement: \n          - \n            Sid: AllowPushPull\n            Effect: Allow\n            Principal: \n              AWS: \n                - \"*\"\n            Action: \n              - \"ecr:GetDownloadUrlForLayer\"\n              - \"ecr:BatchGetImage\"\n              - \"ecr:BatchCheckLayerAvailability\"\n              - \"ecr:PutImage\"\n              - \"ecr:InitiateLayerUpload\"\n              - \"ecr:UploadLayerPart\"\n              - \"ecr:CompleteLayerUpload\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/ecr/no-public-access/#secure-example","text":"<p>The following example will pass the AVD-AWS-0032 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::ECR::Repository\n    Properties:\n      RepositoryName: \"test-repository\"\n      ImageTagImmutability: IMMUTABLE\n      ImageScanningConfiguration:\n        ScanOnPush: false\n      EncryptionConfiguration:\n        EncryptionType: KMS\n        KmsKey: \"alias/ecr-key\"\n      RepositoryPolicyText: \n        Version: \"2012-10-17\"\n        Statement: \n          - \n            Sid: AllowPushPull\n            Effect: Allow\n            Principal: \n              AWS: \n                - \"arn:aws:iam::123456789012:user/Alice\"\n            Action: \n              - \"ecr:GetDownloadUrlForLayer\"\n              - \"ecr:BatchGetImage\"\n              - \"ecr:BatchCheckLayerAvailability\"\n              - \"ecr:PutImage\"\n              - \"ecr:InitiateLayerUpload\"\n              - \"ecr:UploadLayerPart\"\n              - \"ecr:CompleteLayerUpload\"\n</code></pre>","title":"Secure Example"},{"location":"checks/ecr/no-public-access/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonECR/latest/public/public-repository-policies.html</li> </ul>","title":"Related Links"},{"location":"checks/ecr/repository-customer-key/","text":"","title":"repository-customer-key"},{"location":"checks/ecr/repository-customer-key/#explanation","text":"<p>Images in the ECR repository are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key.</p>","title":"Explanation"},{"location":"checks/ecr/repository-customer-key/#possible-impact","text":"<p>Using AWS managed keys does not allow for fine grained control</p>","title":"Possible Impact"},{"location":"checks/ecr/repository-customer-key/#suggested-resolution","text":"<p>Use customer managed keys</p>","title":"Suggested Resolution"},{"location":"checks/ecr/repository-customer-key/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0033 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::ECR::Repository\n    Properties:\n      RepositoryName: \"test-repository\"\n      ImageScanningConfiguration:\n        ScanOnPush: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/ecr/repository-customer-key/#secure-example","text":"<p>The following example will pass the AVD-AWS-0033 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::ECR::Repository\n    Properties:\n      RepositoryName: \"test-repository\"\n      ImageTagImmutability: IMMUTABLE\n      ImageScanningConfiguration:\n        ScanOnPush: false\n      EncryptionConfiguration:\n        EncryptionType: KMS\n        KmsKey: \"alias/ecr-key\"\n</code></pre>","title":"Secure Example"},{"location":"checks/ecr/repository-customer-key/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonECR/latest/userguide/encryption-at-rest.html</li> </ul>","title":"Related Links"},{"location":"checks/ecs/enable-container-insight/","text":"","title":"enable-container-insight"},{"location":"checks/ecs/enable-container-insight/#explanation","text":"<p>Cloudwatch Container Insights provide more metrics and logs for container based applications and micro services.</p>","title":"Explanation"},{"location":"checks/ecs/enable-container-insight/#possible-impact","text":"<p>Not all metrics and logs may be gathered for containers when Container Insights isn't enabled</p>","title":"Possible Impact"},{"location":"checks/ecs/enable-container-insight/#suggested-resolution","text":"<p>Enable Container Insights</p>","title":"Suggested Resolution"},{"location":"checks/ecs/enable-container-insight/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0034 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: 'AWS::ECS::Cluster'\n    Properties:\n      ClusterName: MyCluster\n</code></pre>","title":"Insecure Example"},{"location":"checks/ecs/enable-container-insight/#secure-example","text":"<p>The following example will pass the AVD-AWS-0034 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: 'AWS::ECS::Cluster'\n    Properties:\n      ClusterName: MyCluster\n      ClusterSettings:\n        - Name: containerInsights\n          Value: enabled\n</code></pre>","title":"Secure Example"},{"location":"checks/ecs/enable-container-insight/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html</li> </ul>","title":"Related Links"},{"location":"checks/ecs/enable-in-transit-encryption/","text":"","title":"enable-in-transit-encryption"},{"location":"checks/ecs/enable-in-transit-encryption/#explanation","text":"<p>ECS task definitions that have volumes using EFS configuration should explicitly enable in transit encryption to prevent the risk of data loss due to interception.</p>","title":"Explanation"},{"location":"checks/ecs/enable-in-transit-encryption/#possible-impact","text":"<p>Intercepted traffic to and from EFS may lead to data loss</p>","title":"Possible Impact"},{"location":"checks/ecs/enable-in-transit-encryption/#suggested-resolution","text":"<p>Enable in transit encryption when using efs</p>","title":"Suggested Resolution"},{"location":"checks/ecs/enable-in-transit-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0035 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: 'AWS::ECS::Cluster'\n    Properties:\n      ClusterName: MyCluster\n      ClusterSettings:\n        - Name: containerInsights\n          Value: enabled\n  BadTask:\n    Type: AWS::ECS::TaskDefinition\n    Properties:\n      Family: \"CFSec scan\"\n      Cpu: 512\n      Memory: 1024\n      NetworkMode: awsvpc\n      RequiresCompatibilities:\n        - FARGATE\n        - EC2\n      ContainerDefinitions:\n        - Name: cfsec\n          Image: cfsec/cfsec:latest\n          MountPoints:\n            - SourceVolume: src\n              ContainerPath: /src\n          LogConfiguration:\n            LogDriver: awslogs\n            Options:\n              awslogs-group: \"cfsec-logs\"\n              awslogs-region: !Ref AWS::Region\n              awslogs-stream-prefix: \"cfsec\"\n      Volumes:\n        - Name: jenkins-home\n          EFSVolumeConfiguration:\n            FilesystemId: \"fs1\"\n            TransitEncryption: DISABLED\n</code></pre>","title":"Insecure Example"},{"location":"checks/ecs/enable-in-transit-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0035 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: 'AWS::ECS::Cluster'\n    Properties:\n      ClusterName: MyCluster\n      ClusterSettings:\n        - Name: containerInsights\n          Value: enabled\n  GoodTask:\n    Type: AWS::ECS::TaskDefinition\n    Properties:\n      Family: \"CFSec scan\"\n      Cpu: 512\n      Memory: 1024\n      NetworkMode: awsvpc\n      RequiresCompatibilities:\n        - FARGATE\n        - EC2\n      ContainerDefinitions:\n        - Name: cfsec\n          Image: cfsec/cfsec:latest\n          MountPoints:\n            - SourceVolume: src\n              ContainerPath: /src\n          LogConfiguration:\n            LogDriver: awslogs\n            Options:\n              awslogs-group: \"cfsec-logs\"\n              awslogs-region: !Ref AWS::Region\n              awslogs-stream-prefix: \"cfsec\"\n      Volumes:\n        - Name: jenkins-home\n          EFSVolumeConfiguration:\n            FilesystemId: \"fs1\"\n            TransitEncryption: ENABLED\n</code></pre>","title":"Secure Example"},{"location":"checks/ecs/enable-in-transit-encryption/#related-links","text":"<ul> <li> <p>https://docs.aws.amazon.com/AmazonECS/latest/userguide/efs-volumes.html</p> </li> <li> <p>https://docs.aws.amazon.com/efs/latest/ug/encryption-in-transit.html</p> </li> </ul>","title":"Related Links"},{"location":"checks/ecs/no-plaintext-secrets/","text":"","title":"no-plaintext-secrets"},{"location":"checks/ecs/no-plaintext-secrets/#explanation","text":"<p>You should not make secrets available to a user in plaintext in any scenario. Secrets can instead be pulled from a secure secret storage system by the service requiring them.</p>","title":"Explanation"},{"location":"checks/ecs/no-plaintext-secrets/#possible-impact","text":"<p>Sensitive data could be exposed in the AWS Management Console</p>","title":"Possible Impact"},{"location":"checks/ecs/no-plaintext-secrets/#suggested-resolution","text":"<p>Use secrets for the task definition</p>","title":"Suggested Resolution"},{"location":"checks/ecs/no-plaintext-secrets/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0036 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: 'AWS::ECS::Cluster'\n    Properties:\n      ClusterName: MyCluster\n      ClusterSettings:\n        - Name: containerInsights\n          Value: enabled\n  BadTask:\n    Type: AWS::ECS::TaskDefinition\n    Properties:\n      Family: \"CFSec scan\"\n      Cpu: 512\n      Memory: 1024\n      NetworkMode: awsvpc\n      RequiresCompatibilities:\n        - FARGATE\n        - EC2\n      ContainerDefinitions:\n        - Name: cfsec\n          Image: cfsec/cfsec:latest\n          Environment: \n          - Name: AWS_ACCESS_KEY_ID \n            Value: AIPA8YOHGIS58IBFDU3E\n          MountPoints:\n            - SourceVolume: src\n              ContainerPath: /src\n          LogConfiguration:\n            LogDriver: awslogs\n            Options:\n              awslogs-group: \"cfsec-logs\"\n              awslogs-region: !Ref AWS::Region\n              awslogs-stream-prefix: \"cfsec\"\n      Volumes:\n        - Name: jenkins-home\n          EFSVolumeConfiguration:\n            FilesystemId: \"fs1\"\n            TransitEncryption: DISABLED\n</code></pre>","title":"Insecure Example"},{"location":"checks/ecs/no-plaintext-secrets/#secure-example","text":"<p>The following example will pass the AVD-AWS-0036 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: 'AWS::ECS::Cluster'\n    Properties:\n      ClusterName: MyCluster\n      ClusterSettings:\n        - Name: containerInsights\n          Value: enabled\n  GoodTask:\n    Type: AWS::ECS::TaskDefinition\n    Properties:\n      Family: \"CFSec scan\"\n      Cpu: 512\n      Memory: 1024\n      NetworkMode: awsvpc\n      RequiresCompatibilities:\n        - FARGATE\n        - EC2\n      ContainerDefinitions:\n        - Name: cfsec\n          Image: cfsec/cfsec:latest\n          MountPoints:\n            - SourceVolume: src\n              ContainerPath: /src\n          LogConfiguration:\n            LogDriver: awslogs\n            Options:\n              awslogs-group: \"cfsec-logs\"\n              awslogs-region: !Ref AWS::Region\n              awslogs-stream-prefix: \"cfsec\"\n      Volumes:\n        - Name: jenkins-home\n          EFSVolumeConfiguration:\n            FilesystemId: \"fs1\"\n            TransitEncryption: ENABLED\n</code></pre>","title":"Secure Example"},{"location":"checks/ecs/no-plaintext-secrets/#related-links","text":"<ul> <li> <p>https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-ps-secretsmanager.html</p> </li> <li> <p>https://www.vaultproject.io/</p> </li> </ul>","title":"Related Links"},{"location":"checks/efs/enable-at-rest-encryption/","text":"","title":"enable-at-rest-encryption"},{"location":"checks/efs/enable-at-rest-encryption/#explanation","text":"<p>If your organization is subject to corporate or regulatory policies that require encryption of data and metadata at rest, we recommend creating a file system that is encrypted at rest, and mounting your file system using encryption of data in transit.</p>","title":"Explanation"},{"location":"checks/efs/enable-at-rest-encryption/#possible-impact","text":"<p>Data can be read from the EFS if compromised</p>","title":"Possible Impact"},{"location":"checks/efs/enable-at-rest-encryption/#suggested-resolution","text":"<p>Enable encryption for EFS</p>","title":"Suggested Resolution"},{"location":"checks/efs/enable-at-rest-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0037 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::EFS::FileSystem\n    Properties:\n      BackupPolicy:\n        Status: ENABLED\n      LifecyclePolicies:\n        - TransitionToIA: AFTER_60_DAYS\n      PerformanceMode: generalPurpose\n      Encrypted: false\n      ThroughputMode: bursting\n</code></pre>","title":"Insecure Example"},{"location":"checks/efs/enable-at-rest-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0037 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::EFS::FileSystem\n    Properties:\n      BackupPolicy:\n        Status: ENABLED\n      LifecyclePolicies:\n        - TransitionToIA: AFTER_60_DAYS\n      PerformanceMode: generalPurpose\n      Encrypted: true\n      ThroughputMode: bursting\n</code></pre>","title":"Secure Example"},{"location":"checks/efs/enable-at-rest-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/efs/latest/ug/encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/eks/encrypt-secrets/","text":"","title":"encrypt-secrets"},{"location":"checks/eks/encrypt-secrets/#explanation","text":"<p>EKS cluster resources should have the encryption_config block set with protection of the secrets resource.</p>","title":"Explanation"},{"location":"checks/eks/encrypt-secrets/#possible-impact","text":"<p>EKS secrets could be read if compromised</p>","title":"Possible Impact"},{"location":"checks/eks/encrypt-secrets/#suggested-resolution","text":"<p>Enable encryption of EKS secrets</p>","title":"Suggested Resolution"},{"location":"checks/eks/encrypt-secrets/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0039 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: 'AWS::EKS::Cluster'\n    Properties:\n      Name: badExample\n      Version: '1.14'\n      RoleArn: &gt;-\n        arn:aws:iam::012345678910:role/eks-service-role-bad-example\n      ResourcesVpcConfig:\n        SecurityGroupIds:\n          - sg-6979fe18\n        SubnetIds:\n          - subnet-6782e71e\n          - subnet-e7e761ac\n</code></pre>","title":"Insecure Example"},{"location":"checks/eks/encrypt-secrets/#secure-example","text":"<p>The following example will pass the AVD-AWS-0039 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: 'AWS::EKS::Cluster'\n    Properties:\n      Name: goodExample\n      Version: '1.14'\n      RoleArn: &gt;-\n        arn:aws:iam::012345678910:role/eks-service-role-good-example\n      EncryptionConfig:\n        Provider:\n          KeyArn: alias/eks-kms\n        Resources:\n        - secrets\n      ResourcesVpcConfig:\n        SecurityGroupIds:\n          - sg-6979fe18\n        SubnetIds:\n          - subnet-6782e71e\n          - subnet-e7e761ac\n</code></pre>","title":"Secure Example"},{"location":"checks/eks/encrypt-secrets/#related-links","text":"<ul> <li>https://aws.amazon.com/about-aws/whats-new/2020/03/amazon-eks-adds-envelope-encryption-for-secrets-with-aws-kms/</li> </ul>","title":"Related Links"},{"location":"checks/elastic-search/enable-domain-encryption/","text":"","title":"enable-domain-encryption"},{"location":"checks/elastic-search/enable-domain-encryption/#explanation","text":"<p>You should ensure your Elasticsearch data is encrypted at rest to help prevent sensitive information from being read by unauthorised users.</p>","title":"Explanation"},{"location":"checks/elastic-search/enable-domain-encryption/#possible-impact","text":"<p>Data will be readable if compromised</p>","title":"Possible Impact"},{"location":"checks/elastic-search/enable-domain-encryption/#suggested-resolution","text":"<p>Enable ElasticSearch domain encryption</p>","title":"Suggested Resolution"},{"location":"checks/elastic-search/enable-domain-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0048 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      ElasticsearchVersion: '7.10'\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n</code></pre>","title":"Insecure Example"},{"location":"checks/elastic-search/enable-domain-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0048 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      ElasticsearchVersion: '7.10'\n      EncryptionAtRestOptions:\n        Enabled: true\n        KmsKeyId: alias/kmskey\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n</code></pre>","title":"Secure Example"},{"location":"checks/elastic-search/enable-domain-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html</li> </ul>","title":"Related Links"},{"location":"checks/elastic-search/enable-domain-logging/","text":"","title":"enable-domain-logging"},{"location":"checks/elastic-search/enable-domain-logging/#explanation","text":"<p>Amazon ES exposes four Elasticsearch logs through Amazon CloudWatch Logs: error logs, search slow logs, index slow logs, and audit logs. </p> <p>Search slow logs, index slow logs, and error logs are useful for troubleshooting performance and stability issues. </p> <p>Audit logs track user activity for compliance purposes. </p> <p>All the logs are disabled by default.</p>","title":"Explanation"},{"location":"checks/elastic-search/enable-domain-logging/#possible-impact","text":"<p>Logging provides vital information about access and usage</p>","title":"Possible Impact"},{"location":"checks/elastic-search/enable-domain-logging/#suggested-resolution","text":"<p>Enable logging for ElasticSearch domains</p>","title":"Suggested Resolution"},{"location":"checks/elastic-search/enable-domain-logging/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0042 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      ElasticsearchVersion: '7.10'\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n</code></pre>","title":"Insecure Example"},{"location":"checks/elastic-search/enable-domain-logging/#secure-example","text":"<p>The following example will pass the AVD-AWS-0042 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      ElasticsearchVersion: '7.10'\n      EncryptionAtRestOptions:\n        Enabled: true\n        KmsKeyId: alias/kmskey\n      LogPublishingOptions:\n        Enabled: true\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n</code></pre>","title":"Secure Example"},{"location":"checks/elastic-search/enable-domain-logging/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createdomain-configure-slow-logs.html</li> </ul>","title":"Related Links"},{"location":"checks/elastic-search/enable-in-transit-encryption/","text":"","title":"enable-in-transit-encryption"},{"location":"checks/elastic-search/enable-in-transit-encryption/#explanation","text":"<p>Traffic flowing between Elasticsearch nodes should be encrypted to ensure sensitive data is kept private.</p>","title":"Explanation"},{"location":"checks/elastic-search/enable-in-transit-encryption/#possible-impact","text":"<p>In transit data between nodes could be read if intercepted</p>","title":"Possible Impact"},{"location":"checks/elastic-search/enable-in-transit-encryption/#suggested-resolution","text":"<p>Enable encrypted node to node communication</p>","title":"Suggested Resolution"},{"location":"checks/elastic-search/enable-in-transit-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0043 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      ElasticsearchVersion: '7.10'\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n</code></pre>","title":"Insecure Example"},{"location":"checks/elastic-search/enable-in-transit-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0043 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      ElasticsearchVersion: '7.10'\n      EncryptionAtRestOptions:\n        Enabled: true\n        KmsKeyId: alias/kmskey\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n      NodeToNodeEncryptionOptions:\n        Enabled: true\n</code></pre>","title":"Secure Example"},{"location":"checks/elastic-search/enable-in-transit-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/ntn.html</li> </ul>","title":"Related Links"},{"location":"checks/elastic-search/enforce-https/","text":"","title":"enforce-https"},{"location":"checks/elastic-search/enforce-https/#explanation","text":"<p>Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth.</p> <p>You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.</p>","title":"Explanation"},{"location":"checks/elastic-search/enforce-https/#possible-impact","text":"<p>HTTP traffic can be intercepted and the contents read</p>","title":"Possible Impact"},{"location":"checks/elastic-search/enforce-https/#suggested-resolution","text":"<p>Enforce the use of HTTPS for ElasticSearch</p>","title":"Suggested Resolution"},{"location":"checks/elastic-search/enforce-https/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0046 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      ElasticsearchVersion: '7.10'\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n</code></pre>","title":"Insecure Example"},{"location":"checks/elastic-search/enforce-https/#secure-example","text":"<p>The following example will pass the AVD-AWS-0046 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      DomainEndpointOptions:\n        EnforceHTTPS: true\n\n      ElasticsearchVersion: '7.10'\n      EncryptionAtRestOptions:\n        Enabled: true\n        KmsKeyId: alias/kmskey\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n</code></pre>","title":"Secure Example"},{"location":"checks/elastic-search/enforce-https/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html</li> </ul>","title":"Related Links"},{"location":"checks/elastic-search/use-secure-tls-policy/","text":"","title":"use-secure-tls-policy"},{"location":"checks/elastic-search/use-secure-tls-policy/#explanation","text":"<p>You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.</p>","title":"Explanation"},{"location":"checks/elastic-search/use-secure-tls-policy/#possible-impact","text":"<p>Outdated SSL policies increase exposure to known vulnerabilities</p>","title":"Possible Impact"},{"location":"checks/elastic-search/use-secure-tls-policy/#suggested-resolution","text":"<p>Use the most modern TLS/SSL policies available</p>","title":"Suggested Resolution"},{"location":"checks/elastic-search/use-secure-tls-policy/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0047 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      ElasticsearchVersion: '7.10'\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n</code></pre>","title":"Insecure Example"},{"location":"checks/elastic-search/use-secure-tls-policy/#secure-example","text":"<p>The following example will pass the AVD-AWS-0047 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::Elasticsearch::Domain\n    Properties:\n      DomainName: 'test'\n      ElasticsearchVersion: '7.10'\n      DomainEndpointOptions:\n        TLSSecurityPolicy: Policy-Min-TLS-1-2-2019-07\n      EncryptionAtRestOptions:\n        Enabled: true\n        KmsKeyId: alias/kmskey\n      ElasticsearchClusterConfig:\n        DedicatedMasterEnabled: true\n        InstanceCount: '2'\n        ZoneAwarenessEnabled: true\n        InstanceType: 'm3.medium.elasticsearch'\n        DedicatedMasterType: 'm3.medium.elasticsearch'\n        DedicatedMasterCount: '3'\n      EBSOptions:\n        EBSEnabled: true\n        Iops: '0'\n        VolumeSize: '20'\n        VolumeType: 'gp2'\n</code></pre>","title":"Secure Example"},{"location":"checks/elastic-search/use-secure-tls-policy/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html</li> </ul>","title":"Related Links"},{"location":"checks/elasticache/add-description-for-security-group/","text":"","title":"add-description-for-security-group"},{"location":"checks/elasticache/add-description-for-security-group/#explanation","text":"<p>Security groups and security group rules should include a description for auditing purposes.</p> <p>Simplifies auditing, debugging, and managing security groups.</p>","title":"Explanation"},{"location":"checks/elasticache/add-description-for-security-group/#possible-impact","text":"<p>Descriptions provide context for the firewall rule reasons</p>","title":"Possible Impact"},{"location":"checks/elasticache/add-description-for-security-group/#suggested-resolution","text":"<p>Add descriptions for all security groups and rules</p>","title":"Suggested Resolution"},{"location":"checks/elasticache/add-description-for-security-group/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0049 check.</p> <pre><code>---\nResources:\n  BadExampleCacheGroup:\n    Type: AWS::ElastiCache::SecurityGroup\n    Properties:\n      Tags:\n      - Name: BadExample\n  BadExampleEc2SecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupName: BadExample\n      GroupDescription: Bad Elasticache Security Group\n  BadSecurityGroupIngress:\n    Type: AWS::ElastiCache::SecurityGroupIngress\n    Properties: \n      CacheSecurityGroupName: BadExampleCacheGroup\n      EC2SecurityGroupName: BadExampleEc2SecurityGroup\n</code></pre>","title":"Insecure Example"},{"location":"checks/elasticache/add-description-for-security-group/#secure-example","text":"<p>The following example will pass the AVD-AWS-0049 check.</p> <pre><code>---\nResources:\n  GoodExampleCacheGroup:\n    Type: AWS::ElastiCache::SecurityGroup\n    Properties:\n      Description: Some description\n  GoodExampleEc2SecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupName: GoodExample\n      GroupDescription: Good Elasticache Security Group\n  GoodSecurityGroupIngress:\n    Type: AWS::ElastiCache::SecurityGroupIngress\n    Properties: \n      CacheSecurityGroupName: GoodExampleCacheGroup\n      EC2SecurityGroupName: GoodExampleEc2SecurityGroup\n</code></pre>","title":"Secure Example"},{"location":"checks/elasticache/add-description-for-security-group/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonElastiCache/latest/mem-ug/SecurityGroups.Creating.html</li> </ul>","title":"Related Links"},{"location":"checks/elasticache/enable-backup-retention/","text":"","title":"enable-backup-retention"},{"location":"checks/elasticache/enable-backup-retention/#explanation","text":"<p>Redis clusters should have a snapshot retention time to ensure that they are backed up and can be restored if required.</p>","title":"Explanation"},{"location":"checks/elasticache/enable-backup-retention/#possible-impact","text":"<p>Without backups of the redis cluster recovery is made difficult</p>","title":"Possible Impact"},{"location":"checks/elasticache/enable-backup-retention/#suggested-resolution","text":"<p>Configure snapshot retention for redis cluster</p>","title":"Suggested Resolution"},{"location":"checks/elasticache/enable-backup-retention/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0050 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::ElastiCache::CacheCluster\n    Properties:\n      AZMode: cross-az\n      CacheNodeType: cache.m3.medium\n      Engine: redis\n      NumCacheNodes: '3'\n      PreferredAvailabilityZones:\n        - us-west-2a\n        - us-west-2a\n        - us-west-2b \n</code></pre>","title":"Insecure Example"},{"location":"checks/elasticache/enable-backup-retention/#secure-example","text":"<p>The following example will pass the AVD-AWS-0050 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::ElastiCache::CacheCluster\n    Properties:\n      AZMode: cross-az\n      CacheNodeType: cache.m3.medium\n      Engine: redis\n      NumCacheNodes: '3'\n      SnapshotRetentionLimit: 7\n      PreferredAvailabilityZones:\n        - us-west-2a\n        - us-west-2a\n        - us-west-2b \n</code></pre>","title":"Secure Example"},{"location":"checks/elasticache/enable-backup-retention/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/backups-automatic.html</li> </ul>","title":"Related Links"},{"location":"checks/elasticache/enable-in-transit-encryption/","text":"","title":"enable-in-transit-encryption"},{"location":"checks/elasticache/enable-in-transit-encryption/#explanation","text":"<p>Traffic flowing between Elasticache replication nodes should be encrypted to ensure sensitive data is kept private.</p>","title":"Explanation"},{"location":"checks/elasticache/enable-in-transit-encryption/#possible-impact","text":"<p>In transit data in the Replication Group could be read if intercepted</p>","title":"Possible Impact"},{"location":"checks/elasticache/enable-in-transit-encryption/#suggested-resolution","text":"<p>Enable in transit encryption for replication group</p>","title":"Suggested Resolution"},{"location":"checks/elasticache/enable-in-transit-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0051 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: 'AWS::ElastiCache::ReplicationGroup'\n    Properties:\n      AutomaticFailoverEnabled: true    \n      CacheNodeType: cache.r3.large\n      CacheSubnetGroupName: !Ref CacheSubnetGroup\n      Engine: redis\n      EngineVersion: '3.2'\n      NumNodeGroups: '2'\n      ReplicasPerNodeGroup: '3'\n      Port: 6379\n      PreferredMaintenanceWindow: 'sun:05:00-sun:09:00'\n      ReplicationGroupDescription: A sample replication group\n      SecurityGroupIds:\n      - !Ref ReplicationGroupSG\n      SnapshotRetentionLimit: 5\n      SnapshotWindow: '10:00-12:00'\n</code></pre>","title":"Insecure Example"},{"location":"checks/elasticache/enable-in-transit-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0051 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: 'AWS::ElastiCache::ReplicationGroup'\n    Properties:\n      AutomaticFailoverEnabled: true    \n      CacheNodeType: cache.r3.large\n      CacheSubnetGroupName: !Ref CacheSubnetGroup\n      Engine: redis\n      EngineVersion: '3.2'\n      NumNodeGroups: '2'\n      ReplicasPerNodeGroup: '3'\n      Port: 6379\n      PreferredMaintenanceWindow: 'sun:05:00-sun:09:00'\n      ReplicationGroupDescription: A sample replication group\n      SecurityGroupIds:\n      - !Ref ReplicationGroupSG\n      SnapshotRetentionLimit: 5\n      SnapshotWindow: '10:00-12:00'   \n      TransitEncryptionEnabled: true\n</code></pre>","title":"Secure Example"},{"location":"checks/elasticache/enable-in-transit-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/in-transit-encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/iam/no-policy-wildcards/","text":"","title":"no-policy-wildcards"},{"location":"checks/iam/no-policy-wildcards/#explanation","text":"<p>You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals.</p>","title":"Explanation"},{"location":"checks/iam/no-policy-wildcards/#possible-impact","text":"<p>Overly permissive policies may grant access to sensitive resources</p>","title":"Possible Impact"},{"location":"checks/iam/no-policy-wildcards/#suggested-resolution","text":"<p>Specify the exact permissions required, and to which resources they should apply instead of using wildcards.</p>","title":"Suggested Resolution"},{"location":"checks/iam/no-policy-wildcards/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0057 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of policy\nResources:\n  BadPolicy:\n    Type: 'AWS::IAM::Policy'\n    Properties:\n      PolicyName: CFNUsers\n      PolicyDocument:\n        Version: \"2012-10-17\"\n        Statement:\n          - Effect: Allow\n            Action:\n              - 'cloudformation:Describe*'\n              - 'cloudformation:List*'\n              - 'cloudformation:Get*'\n            Resource: '*'\n</code></pre>","title":"Insecure Example"},{"location":"checks/iam/no-policy-wildcards/#secure-example","text":"<p>The following example will pass the AVD-AWS-0057 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of policy\nResources:\n  GoodPolicy:\n    Type: 'AWS::IAM::Policy'\n    Properties:\n      PolicyName: CFNUsers\n      PolicyDocument:\n        Version: \"2012-10-17\"\n        Statement:\n          - Effect: Allow\n            Action:\n              - 's3:ListBuckets'\n            Resource: 'specific-bucket'\n</code></pre>","title":"Secure Example"},{"location":"checks/iam/no-policy-wildcards/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html</li> </ul>","title":"Related Links"},{"location":"checks/kinesis/enable-in-transit-encryption/","text":"","title":"enable-in-transit-encryption"},{"location":"checks/kinesis/enable-in-transit-encryption/#explanation","text":"<p>Kinesis streams should be encrypted to ensure sensitive data is kept private. Additionally, non-default KMS keys should be used so granularity of access control can be ensured.</p>","title":"Explanation"},{"location":"checks/kinesis/enable-in-transit-encryption/#possible-impact","text":"<p>Intercepted data can be read in transit</p>","title":"Possible Impact"},{"location":"checks/kinesis/enable-in-transit-encryption/#suggested-resolution","text":"<p>Enable in transit encryption</p>","title":"Suggested Resolution"},{"location":"checks/kinesis/enable-in-transit-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0064 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Kinesis::Stream\n    Properties:\n      Name: BadExample\n      RetentionPeriodHours: 168\n      ShardCount: 3\n      Tags:\n        -\n          Key: Environment \n          Value: Production\n</code></pre>","title":"Insecure Example"},{"location":"checks/kinesis/enable-in-transit-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0064 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::Kinesis::Stream\n    Properties:\n      Name: GoodExample\n      RetentionPeriodHours: 168\n      ShardCount: 3\n      StreamEncryption:\n        EncryptionType: KMS\n        KeyId: alis/key\n      Tags:\n        -\n          Key: Environment \n          Value: Production\n</code></pre>","title":"Secure Example"},{"location":"checks/kinesis/enable-in-transit-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/streams/latest/dev/server-side-encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/lambda/enable-tracing/","text":"","title":"enable-tracing"},{"location":"checks/lambda/enable-tracing/#explanation","text":"<p>X-Ray tracing enables end-to-end debugging and analysis of all function activity. This will allow for identifying bottlenecks, slow downs and timeouts.</p>","title":"Explanation"},{"location":"checks/lambda/enable-tracing/#possible-impact","text":"<p>WIthout full tracing enabled it is difficult to trace the flow of logs</p>","title":"Possible Impact"},{"location":"checks/lambda/enable-tracing/#suggested-resolution","text":"<p>Enable tracing</p>","title":"Suggested Resolution"},{"location":"checks/lambda/enable-tracing/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0066 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Lambda::Function\n    Properties:\n      Handler: index.handler\n      Role: arn:aws:iam::123456789012:role/lambda-role\n      Code:\n        S3Bucket: my-bucket\n        S3Key: function.zip\n      Runtime: nodejs12.x\n      Timeout: 5\n      VpcConfig:\n        SecurityGroupIds:\n          - sg-085912345678492fb\n        SubnetIds:\n          - subnet-071f712345678e7c8\n          - subnet-07fd123456788a036\n</code></pre>","title":"Insecure Example"},{"location":"checks/lambda/enable-tracing/#secure-example","text":"<p>The following example will pass the AVD-AWS-0066 check.</p> <pre><code>---\nResources:\n  Function:\n    Type: AWS::Lambda::Function\n    Properties:\n      Handler: index.handler\n      Role: arn:aws:iam::123456789012:role/lambda-role\n      Code:\n        S3Bucket: my-bucket\n        S3Key: function.zip\n      Runtime: nodejs12.x\n      Timeout: 5\n      TracingConfig:\n        Mode: Active\n      VpcConfig:\n        SecurityGroupIds:\n          - sg-085912345678492fb\n        SubnetIds:\n          - subnet-071f712345678e7c8\n          - subnet-07fd123456788a036\n</code></pre>","title":"Secure Example"},{"location":"checks/lambda/enable-tracing/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/lambda/latest/dg/services-xray.html</li> </ul>","title":"Related Links"},{"location":"checks/lambda/restrict-source-arn/","text":"","title":"restrict-source-arn"},{"location":"checks/lambda/restrict-source-arn/#explanation","text":"<p>When the principal is an AWS service, the ARN of the specific resource within that service to grant permission to. </p> <p>Without this, any resource from principal will be granted permission \u2013 even if that resource is from another account. </p> <p>For S3, this should be the ARN of the S3 Bucket. For CloudWatch Events, this should be the ARN of the CloudWatch Events Rule. For API Gateway, this should be the ARN of the API</p>","title":"Explanation"},{"location":"checks/lambda/restrict-source-arn/#possible-impact","text":"<p>Not providing the source ARN allows any resource from principal, even from other accounts</p>","title":"Possible Impact"},{"location":"checks/lambda/restrict-source-arn/#suggested-resolution","text":"<p>Always provide a source arn for Lambda permissions</p>","title":"Suggested Resolution"},{"location":"checks/lambda/restrict-source-arn/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0067 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::Lambda::Function\n    Properties:\n      Handler: index.handler\n      Role: arn:aws:iam::123456789012:role/lambda-role\n      Code:\n        S3Bucket: my-bucket\n        S3Key: function.zip\n      Runtime: nodejs12.x\n      Timeout: 5\n      TracingConfig:\n        Mode: Active\n      VpcConfig:\n        SecurityGroupIds:\n          - sg-085912345678492fb\n        SubnetIds:\n          - subnet-071f712345678e7c8\n          - subnet-07fd123456788a036\n  BadPermission:\n    Type: AWS::Lambda::Permission\n    Properties:\n      FunctionName: !Ref BadExample\n      Action: lambda:InvokeFunction\n      Principal: s3.amazonaws.com\n</code></pre>","title":"Insecure Example"},{"location":"checks/lambda/restrict-source-arn/#secure-example","text":"<p>The following example will pass the AVD-AWS-0067 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::Lambda::Function\n    Properties:\n      Handler: index.handler\n      Role: arn:aws:iam::123456789012:role/lambda-role\n      Code:\n        S3Bucket: my-bucket\n        S3Key: function.zip\n      Runtime: nodejs12.x\n      Timeout: 5\n      TracingConfig:\n        Mode: Active\n      VpcConfig:\n        SecurityGroupIds:\n          - sg-085912345678492fb\n        SubnetIds:\n          - subnet-071f712345678e7c8\n          - subnet-07fd123456788a036\n  GoodPermission:\n    Type: AWS::Lambda::Permission\n    Properties:\n      FunctionName: !Ref BadExample\n      Action: lambda:InvokeFunction\n      Principal: s3.amazonaws.com\n      SourceArn: \"lambda.amazonaws.com\"\n</code></pre>","title":"Secure Example"},{"location":"checks/lambda/restrict-source-arn/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html</li> </ul>","title":"Related Links"},{"location":"checks/mq/enable-audit-logging/","text":"","title":"enable-audit-logging"},{"location":"checks/mq/enable-audit-logging/#explanation","text":"<p>Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation</p>","title":"Explanation"},{"location":"checks/mq/enable-audit-logging/#possible-impact","text":"<p>Without audit logging it is difficult to trace activity in the MQ broker</p>","title":"Possible Impact"},{"location":"checks/mq/enable-audit-logging/#suggested-resolution","text":"<p>Enable audit logging</p>","title":"Suggested Resolution"},{"location":"checks/mq/enable-audit-logging/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0070 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Broker:\n    Type: AWS::AmazonMQ::Broker\n    Properties:\n      Logs:\n        Audit: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/mq/enable-audit-logging/#secure-example","text":"<p>The following example will pass the AVD-AWS-0070 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example\nResources:\n  Broker:\n    Type: AWS::AmazonMQ::Broker\n    Properties:\n      Logs:\n        Audit: true\n</code></pre>","title":"Secure Example"},{"location":"checks/mq/enable-audit-logging/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html</li> </ul>","title":"Related Links"},{"location":"checks/mq/enable-general-logging/","text":"","title":"enable-general-logging"},{"location":"checks/mq/enable-general-logging/#explanation","text":"<p>Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation</p>","title":"Explanation"},{"location":"checks/mq/enable-general-logging/#possible-impact","text":"<p>Without logging it is difficult to trace issues</p>","title":"Possible Impact"},{"location":"checks/mq/enable-general-logging/#suggested-resolution","text":"<p>Enable general logging</p>","title":"Suggested Resolution"},{"location":"checks/mq/enable-general-logging/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0071 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Broker:\n    Type: AWS::AmazonMQ::Broker\n    Properties:\n      Logs:\n        General: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/mq/enable-general-logging/#secure-example","text":"<p>The following example will pass the AVD-AWS-0071 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example\nResources:\n  Broker:\n    Type: AWS::AmazonMQ::Broker\n    Properties:\n      Logs:\n        General: true\n</code></pre>","title":"Secure Example"},{"location":"checks/mq/enable-general-logging/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html</li> </ul>","title":"Related Links"},{"location":"checks/mq/no-public-access/","text":"","title":"no-public-access"},{"location":"checks/mq/no-public-access/#explanation","text":"<p>Public access of the MQ broker should be disabled and only allow routes to applications that require access.</p>","title":"Explanation"},{"location":"checks/mq/no-public-access/#possible-impact","text":"<p>Publicly accessible MQ Broker may be vulnerable to compromise</p>","title":"Possible Impact"},{"location":"checks/mq/no-public-access/#suggested-resolution","text":"<p>Disable public access when not required</p>","title":"Suggested Resolution"},{"location":"checks/mq/no-public-access/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0072 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Broker:\n    Type: AWS::AmazonMQ::Broker\n    Properties:\n      PubliclyAccessible: true\n</code></pre>","title":"Insecure Example"},{"location":"checks/mq/no-public-access/#secure-example","text":"<p>The following example will pass the AVD-AWS-0072 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example\nResources:\n  Broker:\n    Type: AWS::AmazonMQ::Broker\n    Properties:\n      PubliclyAccessible: false\n</code></pre>","title":"Secure Example"},{"location":"checks/mq/no-public-access/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/using-amazon-mq-securely.html#prefer-brokers-without-public-accessibility</li> </ul>","title":"Related Links"},{"location":"checks/msk/enable-in-transit-encryption/","text":"","title":"enable-in-transit-encryption"},{"location":"checks/msk/enable-in-transit-encryption/#explanation","text":"<p>Encryption should be forced for Kafka clusters, including for communication between nodes. This ensure sensitive data is kept private.</p>","title":"Explanation"},{"location":"checks/msk/enable-in-transit-encryption/#possible-impact","text":"<p>Intercepted data can be read in transit</p>","title":"Possible Impact"},{"location":"checks/msk/enable-in-transit-encryption/#suggested-resolution","text":"<p>Enable in transit encryption</p>","title":"Suggested Resolution"},{"location":"checks/msk/enable-in-transit-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0073 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Cluster:\n    Type: AWS::MSK::Cluster\n    Properties:\n      EncryptionInfo:\n        EncryptionInTransit:\n          ClientBroker: \"TLS_PLAINTEXT\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/msk/enable-in-transit-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0073 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example\nResources:\n  Cluster:\n    Type: AWS::MSK::Cluster\n    Properties:\n      EncryptionInfo:\n        EncryptionInTransit:\n          ClientBroker: \"TLS\"\n</code></pre>","title":"Secure Example"},{"location":"checks/msk/enable-in-transit-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/msk/latest/developerguide/msk-encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/msk/enable-logging/","text":"","title":"enable-logging"},{"location":"checks/msk/enable-logging/#explanation","text":"<p>Managed streaming for Kafka can log to Cloud Watch, Kinesis Firehose and S3, at least one of these locations should be logged to</p>","title":"Explanation"},{"location":"checks/msk/enable-logging/#possible-impact","text":"<p>Without logging it is difficult to trace issues</p>","title":"Possible Impact"},{"location":"checks/msk/enable-logging/#suggested-resolution","text":"<p>Enable logging</p>","title":"Suggested Resolution"},{"location":"checks/msk/enable-logging/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0074 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Cluster:\n    Type: AWS::MSK::Cluster\n    Properties:\n      LoggingInfo:\n        BrokerLogs:\n          CloudWatchLogs:\n            Enabled: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/msk/enable-logging/#secure-example","text":"<p>The following example will pass the AVD-AWS-0074 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example\nResources:\n  Cluster:\n    Type: AWS::MSK::Cluster\n    Properties:\n      LoggingInfo:\n        BrokerLogs:\n          S3:\n            Enabled: true\n</code></pre>","title":"Secure Example"},{"location":"checks/msk/enable-logging/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/msk/latest/developerguide/msk-logging.html</li> </ul>","title":"Related Links"},{"location":"checks/neptune/enable-log-export/","text":"","title":"enable-log-export"},{"location":"checks/neptune/enable-log-export/#explanation","text":"<p>Neptune does not have auditing by default. To ensure that you are able to accurately audit the usage of your Neptune instance you should enable export logs.</p>","title":"Explanation"},{"location":"checks/neptune/enable-log-export/#possible-impact","text":"<p>Limited visibility of audit trail for changes to Neptune</p>","title":"Possible Impact"},{"location":"checks/neptune/enable-log-export/#suggested-resolution","text":"<p>Enable export logs</p>","title":"Suggested Resolution"},{"location":"checks/neptune/enable-log-export/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0075 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Cluster:\n    Type: AWS::Neptune::DBCluster\n    Properties:\n      EnableCloudwatchLogsExports:\n        - debug\n</code></pre>","title":"Insecure Example"},{"location":"checks/neptune/enable-log-export/#secure-example","text":"<p>The following example will pass the AVD-AWS-0075 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Cluster:\n    Type: AWS::Neptune::DBCluster\n    Properties:\n      EnableCloudwatchLogsExports:\n        - audit\n</code></pre>","title":"Secure Example"},{"location":"checks/neptune/enable-log-export/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/neptune/latest/userguide/auditing.html</li> </ul>","title":"Related Links"},{"location":"checks/neptune/enable-storage-encryption/","text":"","title":"enable-storage-encryption"},{"location":"checks/neptune/enable-storage-encryption/#explanation","text":"<p>Encryption of Neptune storage ensures that if their is compromise of the disks, the data is still protected.</p>","title":"Explanation"},{"location":"checks/neptune/enable-storage-encryption/#possible-impact","text":"<p>Unencrypted sensitive data is vulnerable to compromise.</p>","title":"Possible Impact"},{"location":"checks/neptune/enable-storage-encryption/#suggested-resolution","text":"<p>Enable encryption of Neptune storage</p>","title":"Suggested Resolution"},{"location":"checks/neptune/enable-storage-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0076 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Cluster:\n    Type: AWS::Neptune::DBCluster\n    Properties:\n      StorageEncrypted: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/neptune/enable-storage-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0076 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example\nResources:\n  Cluster:\n    Type: AWS::Neptune::DBCluster\n    Properties:\n      StorageEncrypted: true\n      KmsKeyId: \"something\"\n</code></pre>","title":"Secure Example"},{"location":"checks/neptune/enable-storage-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/neptune/latest/userguide/encrypt.html</li> </ul>","title":"Related Links"},{"location":"checks/rds/enable-performance-insights/","text":"","title":"enable-performance-insights"},{"location":"checks/rds/enable-performance-insights/#explanation","text":"<p>When enabling Performance Insights on an RDS cluster or RDS DB Instance, and encryption key should be provided.</p> <p>The encryption key specified in <code>performance_insights_kms_key_id</code> references a KMS ARN</p>","title":"Explanation"},{"location":"checks/rds/enable-performance-insights/#possible-impact","text":"<p>Data can be read from the RDS Performance Insights if it is compromised</p>","title":"Possible Impact"},{"location":"checks/rds/enable-performance-insights/#suggested-resolution","text":"<p>Enable encryption for RDS clusters and instances</p>","title":"Suggested Resolution"},{"location":"checks/rds/enable-performance-insights/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0078 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Queue:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      EnablePerformanceInsights: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/rds/enable-performance-insights/#secure-example","text":"<p>The following example will pass the AVD-AWS-0078 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example\nResources:\n  Queue:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      EnablePerformanceInsights: true\n      PerformanceInsightsKMSKeyId: \"something\"\n</code></pre>","title":"Secure Example"},{"location":"checks/rds/enable-performance-insights/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.htm</li> </ul>","title":"Related Links"},{"location":"checks/rds/encrypt-cluster-storage-data/","text":"","title":"encrypt-cluster-storage-data"},{"location":"checks/rds/encrypt-cluster-storage-data/#explanation","text":"<p>Encryption should be enabled for an RDS Aurora cluster. </p> <p>When enabling encryption by setting the kms_key_id, the storage_encrypted must also be set to true.</p>","title":"Explanation"},{"location":"checks/rds/encrypt-cluster-storage-data/#possible-impact","text":"<p>Data can be read from the RDS cluster if it is compromised</p>","title":"Possible Impact"},{"location":"checks/rds/encrypt-cluster-storage-data/#suggested-resolution","text":"<p>Enable encryption for RDS clusters</p>","title":"Suggested Resolution"},{"location":"checks/rds/encrypt-cluster-storage-data/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0079 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of rds sgr\nResources:\n  Cluster:\n    Type: AWS::RDS::DBCluster\n    Properties:\n      StorageEncrypted: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/rds/encrypt-cluster-storage-data/#secure-example","text":"<p>The following example will pass the AVD-AWS-0079 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of rds sgr\nResources:\n  Cluster:\n    Type: AWS::RDS::DBCluster\n    Properties:\n      StorageEncrypted: true\n      KmsKeyId: \"something\"\n</code></pre>","title":"Secure Example"},{"location":"checks/rds/encrypt-cluster-storage-data/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/rds/encrypt-instance-storage-data/","text":"","title":"encrypt-instance-storage-data"},{"location":"checks/rds/encrypt-instance-storage-data/#explanation","text":"<p>Encryption should be enabled for an RDS Database instances. </p> <p>When enabling encryption by setting the kms_key_id.</p>","title":"Explanation"},{"location":"checks/rds/encrypt-instance-storage-data/#possible-impact","text":"<p>Data can be read from RDS instances if compromised</p>","title":"Possible Impact"},{"location":"checks/rds/encrypt-instance-storage-data/#suggested-resolution","text":"<p>Enable encryption for RDS instances</p>","title":"Suggested Resolution"},{"location":"checks/rds/encrypt-instance-storage-data/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0080 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of rds sgr\nResources:\n  Instance:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      StorageEncrypted: false\n</code></pre>","title":"Insecure Example"},{"location":"checks/rds/encrypt-instance-storage-data/#secure-example","text":"<p>The following example will pass the AVD-AWS-0080 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of rds sgr\nResources:\n  Instance:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      StorageEncrypted: true\n      KmsKeyId: \"something\"\n</code></pre>","title":"Secure Example"},{"location":"checks/rds/encrypt-instance-storage-data/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/rds/no-classic-resources/","text":"","title":"no-classic-resources"},{"location":"checks/rds/no-classic-resources/#explanation","text":"<p>AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead.</p>","title":"Explanation"},{"location":"checks/rds/no-classic-resources/#possible-impact","text":"<p>Classic resources are running in a shared environment with other customers</p>","title":"Possible Impact"},{"location":"checks/rds/no-classic-resources/#suggested-resolution","text":"<p>Switch to VPC resources</p>","title":"Suggested Resolution"},{"location":"checks/rds/no-classic-resources/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0081 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of rds sgr\nResources:\n  Queue:\n    Type: AWS::RDS::DBSecurityGroup\n    Properties:\n      Description: \"\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/rds/no-classic-resources/#secure-example","text":"<p>The following example will pass the AVD-AWS-0081 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of rds sgr\nResources:\n</code></pre>","title":"Secure Example"},{"location":"checks/rds/no-classic-resources/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html</li> </ul>","title":"Related Links"},{"location":"checks/rds/no-public-db-access/","text":"","title":"no-public-db-access"},{"location":"checks/rds/no-public-db-access/#explanation","text":"<p>Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function.</p>","title":"Explanation"},{"location":"checks/rds/no-public-db-access/#possible-impact","text":"<p>The database instance is publicly accessible</p>","title":"Possible Impact"},{"location":"checks/rds/no-public-db-access/#suggested-resolution","text":"<p>Set the database to not be publicly accessible</p>","title":"Suggested Resolution"},{"location":"checks/rds/no-public-db-access/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0082 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Queue:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      PubliclyAccessible: true\n</code></pre>","title":"Insecure Example"},{"location":"checks/rds/no-public-db-access/#secure-example","text":"<p>The following example will pass the AVD-AWS-0082 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Queue:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      PubliclyAccessible: false\n</code></pre>","title":"Secure Example"},{"location":"checks/rds/no-public-db-access/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_VPC.WorkingWithRDSInstanceinaVPC.html#USER_VPC.Hiding</li> </ul>","title":"Related Links"},{"location":"checks/rds/specify-backup-retention/","text":"","title":"specify-backup-retention"},{"location":"checks/rds/specify-backup-retention/#explanation","text":"<p>RDS backup retention for clusters defaults to 1 day, this may not be enough to identify and respond to an issue. Backup retention periods should be set to a period that is a balance on cost and limiting risk.</p>","title":"Explanation"},{"location":"checks/rds/specify-backup-retention/#possible-impact","text":"<p>Potential loss of data and short opportunity for recovery</p>","title":"Possible Impact"},{"location":"checks/rds/specify-backup-retention/#suggested-resolution","text":"<p>Explicitly set the retention period to greater than the default</p>","title":"Suggested Resolution"},{"location":"checks/rds/specify-backup-retention/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0077 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example\nResources:\n  Queue:\n    Type: AWS::RDS::DBInstance\n    Properties:\n</code></pre>","title":"Insecure Example"},{"location":"checks/rds/specify-backup-retention/#secure-example","text":"<p>The following example will pass the AVD-AWS-0077 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example\nResources:\n  Queue:\n    Type: AWS::RDS::DBInstance\n    Properties:\n      BackupRetentionPeriod: 30\n</code></pre>","title":"Secure Example"},{"location":"checks/rds/specify-backup-retention/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html#USER_WorkingWithAutomatedBackups.BackupRetention</li> </ul>","title":"Related Links"},{"location":"checks/redshift/add-description-to-security-group/","text":"","title":"add-description-to-security-group"},{"location":"checks/redshift/add-description-to-security-group/#explanation","text":"<p>Security groups and security group rules should include a description for auditing purposes.</p> <p>Simplifies auditing, debugging, and managing security groups.</p>","title":"Explanation"},{"location":"checks/redshift/add-description-to-security-group/#possible-impact","text":"<p>Descriptions provide context for the firewall rule reasons</p>","title":"Possible Impact"},{"location":"checks/redshift/add-description-to-security-group/#suggested-resolution","text":"<p>Add descriptions for all security groups and rules</p>","title":"Suggested Resolution"},{"location":"checks/redshift/add-description-to-security-group/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0083 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of redshift sgr\nResources:\n  Queue:\n    Type: AWS::Redshift::ClusterSecurityGroup\n    Properties:\n      Description: \"\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/redshift/add-description-to-security-group/#secure-example","text":"<p>The following example will pass the AVD-AWS-0083 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of redshift sgr\nResources:\n  Queue:\n    Type: AWS::Redshift::ClusterSecurityGroup\n    Properties:\n      Description: \"Disallow bad stuff\"\n</code></pre>","title":"Secure Example"},{"location":"checks/redshift/add-description-to-security-group/#related-links","text":"<ul> <li>https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html</li> </ul>","title":"Related Links"},{"location":"checks/redshift/encryption-customer-key/","text":"","title":"encryption-customer-key"},{"location":"checks/redshift/encryption-customer-key/#explanation","text":"<p>Redshift clusters that contain sensitive data or are subject to regulation should be encrypted at rest to prevent data leakage should the infrastructure be compromised.</p>","title":"Explanation"},{"location":"checks/redshift/encryption-customer-key/#possible-impact","text":"<p>Data may be leaked if infrastructure is compromised</p>","title":"Possible Impact"},{"location":"checks/redshift/encryption-customer-key/#suggested-resolution","text":"<p>Enable encryption using CMK</p>","title":"Suggested Resolution"},{"location":"checks/redshift/encryption-customer-key/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0084 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of redshift cluster\nResources:\n  Queue:\n    Type: AWS::Redshift::Cluster\n    Properties:\n      Encrypted: true\n</code></pre>","title":"Insecure Example"},{"location":"checks/redshift/encryption-customer-key/#secure-example","text":"<p>The following example will pass the AVD-AWS-0084 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of redshift cluster\nResources:\n  Queue:\n    Type: AWS::Redshift::Cluster\n    Properties:\n      Encrypted: true\n      KmsKeyId: \"something\"\n</code></pre>","title":"Secure Example"},{"location":"checks/redshift/encryption-customer-key/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/redshift/no-classic-resources/","text":"","title":"no-classic-resources"},{"location":"checks/redshift/no-classic-resources/#explanation","text":"<p>AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead.</p>","title":"Explanation"},{"location":"checks/redshift/no-classic-resources/#possible-impact","text":"<p>Classic resources are running in a shared environment with other customers</p>","title":"Possible Impact"},{"location":"checks/redshift/no-classic-resources/#suggested-resolution","text":"<p>Switch to VPC resources</p>","title":"Suggested Resolution"},{"location":"checks/redshift/no-classic-resources/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0085 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of redshift sgr\nResources:\n  Queue:\n    Type: AWS::Redshift::ClusterSecurityGroup\n    Properties:\n      Description: \"\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/redshift/no-classic-resources/#secure-example","text":"<p>The following example will pass the AVD-AWS-0085 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of redshift sgr\nResources:\n</code></pre>","title":"Secure Example"},{"location":"checks/redshift/no-classic-resources/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html</li> </ul>","title":"Related Links"},{"location":"checks/redshift/use-vpc/","text":"","title":"use-vpc"},{"location":"checks/redshift/use-vpc/#explanation","text":"<p>Redshift clusters that are created without subnet details will be created in EC2 classic mode, meaning that they will be outside of a known VPC and running in tennant.</p> <p>In order to benefit from the additional security features achieved with using an owned VPC, the subnet should be set.</p>","title":"Explanation"},{"location":"checks/redshift/use-vpc/#possible-impact","text":"<p>Redshift cluster does not benefit from VPC security if it is deployed in EC2 classic mode</p>","title":"Possible Impact"},{"location":"checks/redshift/use-vpc/#suggested-resolution","text":"<p>Deploy Redshift cluster into a non default VPC</p>","title":"Suggested Resolution"},{"location":"checks/redshift/use-vpc/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0085 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of redshift cluster\nResources:\n  Queue:\n    Type: AWS::Redshift::Cluster\n    Properties:\n      ClusterSubnetGroupName: \"\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/redshift/use-vpc/#secure-example","text":"<p>The following example will pass the AVD-AWS-0085 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of redshift cluster\nResources:\n  Queue:\n    Type: AWS::Redshift::Cluster\n    Properties:\n      ClusterSubnetGroupName: \"my-subnet-group\"\n</code></pre>","title":"Secure Example"},{"location":"checks/redshift/use-vpc/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/redshift/latest/mgmt/managing-clusters-vpc.html</li> </ul>","title":"Related Links"},{"location":"checks/s3/block-public-acls/","text":"","title":"block-public-acls"},{"location":"checks/s3/block-public-acls/#explanation","text":"<p>S3 buckets should block public ACLs on buckets and any objects they contain. By blocking, PUTs with fail if the object has any public ACL a.</p>","title":"Explanation"},{"location":"checks/s3/block-public-acls/#possible-impact","text":"<p>PUT calls with public ACLs specified can make objects public</p>","title":"Possible Impact"},{"location":"checks/s3/block-public-acls/#suggested-resolution","text":"<p>Enable blocking any PUT calls with a public ACL specified</p>","title":"Suggested Resolution"},{"location":"checks/s3/block-public-acls/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0086 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      AccessControl: AuthenticatedRead\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Insecure Example"},{"location":"checks/s3/block-public-acls/#secure-example","text":"<p>The following example will pass the AVD-AWS-0086 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Secure Example"},{"location":"checks/s3/block-public-acls/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html</li> </ul>","title":"Related Links"},{"location":"checks/s3/block-public-policy/","text":"","title":"block-public-policy"},{"location":"checks/s3/block-public-policy/#explanation","text":"<p>S3 bucket policy should have block public policy to prevent users from putting a policy that enable public access.</p>","title":"Explanation"},{"location":"checks/s3/block-public-policy/#possible-impact","text":"<p>Users could put a policy that allows public access</p>","title":"Possible Impact"},{"location":"checks/s3/block-public-policy/#suggested-resolution","text":"<p>Prevent policies that allow public access being PUT</p>","title":"Suggested Resolution"},{"location":"checks/s3/block-public-policy/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0087 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      AccessControl: AuthenticatedRead\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Insecure Example"},{"location":"checks/s3/block-public-policy/#secure-example","text":"<p>The following example will pass the AVD-AWS-0087 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Secure Example"},{"location":"checks/s3/block-public-policy/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html</li> </ul>","title":"Related Links"},{"location":"checks/s3/enable-bucket-encryption/","text":"","title":"enable-bucket-encryption"},{"location":"checks/s3/enable-bucket-encryption/#explanation","text":"<p>S3 Buckets should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific buckets.</p>","title":"Explanation"},{"location":"checks/s3/enable-bucket-encryption/#possible-impact","text":"<p>The bucket objects could be read if compromised</p>","title":"Possible Impact"},{"location":"checks/s3/enable-bucket-encryption/#suggested-resolution","text":"<p>Configure bucket encryption</p>","title":"Suggested Resolution"},{"location":"checks/s3/enable-bucket-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0088 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - BucketKeyEnabled: false\n            ServerSideEncryptionByDefault:\n              KMSMasterKeyID: asdf\n              SSEAlgorithm: asdf\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Insecure Example"},{"location":"checks/s3/enable-bucket-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0088 check.</p> <pre><code>Resources:\n  GoodExample:\n    Properties:\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - BucketKeyEnabled: true\n            ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Secure Example"},{"location":"checks/s3/enable-bucket-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/s3/enable-bucket-logging/","text":"","title":"enable-bucket-logging"},{"location":"checks/s3/enable-bucket-logging/#explanation","text":"<p>Buckets should have logging enabled so that access can be audited.</p>","title":"Explanation"},{"location":"checks/s3/enable-bucket-logging/#possible-impact","text":"<p>There is no way to determine the access to this bucket</p>","title":"Possible Impact"},{"location":"checks/s3/enable-bucket-logging/#suggested-resolution","text":"<p>Add a logging block to the resource to enable access logging</p>","title":"Suggested Resolution"},{"location":"checks/s3/enable-bucket-logging/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0089 check.</p> <pre><code>---\nResources:\n  DisabledEncryptionBucket:\n    Properties:\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Insecure Example"},{"location":"checks/s3/enable-bucket-logging/#secure-example","text":"<p>The following example will pass the AVD-AWS-0089 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      LoggingConfiguration:\n        DestinationBucketName: logging-bucket\n        LogFilePrefix: accesslogs/\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Secure Example"},{"location":"checks/s3/enable-bucket-logging/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html</li> </ul>","title":"Related Links"},{"location":"checks/s3/enable-versioning/","text":"","title":"enable-versioning"},{"location":"checks/s3/enable-versioning/#explanation","text":"<p>Versioning in Amazon S3 is a means of keeping multiple variants of an object in the same bucket.  You can use the S3 Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets.  With versioning you can recover more easily from both unintended user actions and application failures.</p>","title":"Explanation"},{"location":"checks/s3/enable-versioning/#possible-impact","text":"<p>Deleted or modified data would not be recoverable</p>","title":"Possible Impact"},{"location":"checks/s3/enable-versioning/#suggested-resolution","text":"<p>Enable versioning to protect against accidental/malicious removal or modification</p>","title":"Suggested Resolution"},{"location":"checks/s3/enable-versioning/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0090 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Insecure Example"},{"location":"checks/s3/enable-versioning/#secure-example","text":"<p>The following example will pass the AVD-AWS-0090 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      VersioningConfiguration:\n        Status: Enabled\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Secure Example"},{"location":"checks/s3/enable-versioning/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html</li> </ul>","title":"Related Links"},{"location":"checks/s3/ignore-public-acls/","text":"","title":"ignore-public-acls"},{"location":"checks/s3/ignore-public-acls/#explanation","text":"<p>S3 buckets should ignore public ACLs on buckets and any objects they contain. By ignoring rather than blocking, PUT calls with public ACLs will still be applied but the ACL will be ignored.</p>","title":"Explanation"},{"location":"checks/s3/ignore-public-acls/#possible-impact","text":"<p>PUT calls with public ACLs specified can make objects public</p>","title":"Possible Impact"},{"location":"checks/s3/ignore-public-acls/#suggested-resolution","text":"<p>Enable ignoring the application of public ACLs in PUT calls</p>","title":"Suggested Resolution"},{"location":"checks/s3/ignore-public-acls/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0091 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      AccessControl: AuthenticatedRead\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Insecure Example"},{"location":"checks/s3/ignore-public-acls/#secure-example","text":"<p>The following example will pass the AVD-AWS-0091 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      AccessControl: Private\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Secure Example"},{"location":"checks/s3/ignore-public-acls/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html</li> </ul>","title":"Related Links"},{"location":"checks/s3/no-public-access-with-acl/","text":"","title":"no-public-access-with-acl"},{"location":"checks/s3/no-public-access-with-acl/#explanation","text":"<p>Buckets should have logging enabled so that access can be audited. </p>","title":"Explanation"},{"location":"checks/s3/no-public-access-with-acl/#possible-impact","text":"<p>There is no way to determine the access to this bucket</p>","title":"Possible Impact"},{"location":"checks/s3/no-public-access-with-acl/#suggested-resolution","text":"<p>Add a logging block to the resource to enable access logging</p>","title":"Suggested Resolution"},{"location":"checks/s3/no-public-access-with-acl/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0092 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      AccessControl: AuthenticatedRead\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Insecure Example"},{"location":"checks/s3/no-public-access-with-acl/#secure-example","text":"<p>The following example will pass the AVD-AWS-0092 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      AccessControl: Private\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Secure Example"},{"location":"checks/s3/no-public-access-with-acl/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html</li> </ul>","title":"Related Links"},{"location":"checks/s3/no-public-buckets/","text":"","title":"no-public-buckets"},{"location":"checks/s3/no-public-buckets/#explanation","text":"<p>S3 buckets should restrict public policies for the bucket. By enabling, the restrict_public_buckets, only the bucket owner and AWS Services can access if it has a public policy.</p>","title":"Explanation"},{"location":"checks/s3/no-public-buckets/#possible-impact","text":"<p>Public buckets can be accessed by anyone</p>","title":"Possible Impact"},{"location":"checks/s3/no-public-buckets/#suggested-resolution","text":"<p>Limit the access to public buckets to only the owner or AWS Services (eg; CloudFront)</p>","title":"Suggested Resolution"},{"location":"checks/s3/no-public-buckets/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0093 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      AccessControl: AuthenticatedRead\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Insecure Example"},{"location":"checks/s3/no-public-buckets/#secure-example","text":"<p>The following example will pass the AVD-AWS-0093 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Secure Example"},{"location":"checks/s3/no-public-buckets/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html</li> </ul>","title":"Related Links"},{"location":"checks/s3/specify-public-access-block/","text":"","title":"specify-public-access-block"},{"location":"checks/s3/specify-public-access-block/#explanation","text":"<p>The \"block public access\" settings in S3 override individual policies that apply to a given bucket, meaning that all public access can be controlled in one central types for that bucket. It is therefore good practice to define these settings for each bucket in order to clearly define the public access that can be allowed for it.</p>","title":"Explanation"},{"location":"checks/s3/specify-public-access-block/#possible-impact","text":"<p>Public access policies may be applied to sensitive data buckets</p>","title":"Possible Impact"},{"location":"checks/s3/specify-public-access-block/#suggested-resolution","text":"<p>Define a aws_s3_bucket_public_access_block for the given bucket to control public access policies</p>","title":"Suggested Resolution"},{"location":"checks/s3/specify-public-access-block/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0094 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Properties:\n      AccessControl: AuthenticatedRead\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Insecure Example"},{"location":"checks/s3/specify-public-access-block/#secure-example","text":"<p>The following example will pass the AVD-AWS-0094 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Properties:\n      AccessControl: Private\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: true\n        BlockPublicPolicy: true\n        IgnorePublicAcls: true\n        RestrictPublicBuckets: true\n    Type: AWS::S3::Bucket\n</code></pre>","title":"Secure Example"},{"location":"checks/s3/specify-public-access-block/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html</li> </ul>","title":"Related Links"},{"location":"checks/sns/enable-topic-encryption/","text":"","title":"enable-topic-encryption"},{"location":"checks/sns/enable-topic-encryption/#explanation","text":"<p>Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues.</p>","title":"Explanation"},{"location":"checks/sns/enable-topic-encryption/#possible-impact","text":"<p>The SNS topic messages could be read if compromised</p>","title":"Possible Impact"},{"location":"checks/sns/enable-topic-encryption/#suggested-resolution","text":"<p>Turn on SNS Topic encryption</p>","title":"Suggested Resolution"},{"location":"checks/sns/enable-topic-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0095 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of topic\nResources:\n  Queue:\n    Type: AWS::SNS::Topic\n    Properties:\n      TopicName: blah\n</code></pre>","title":"Insecure Example"},{"location":"checks/sns/enable-topic-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0095 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of topic\nResources:\n  Queue:\n    Type: AWS::SQS::Topic\n    Properties:\n      TopicName: blah\n      KmsMasterKeyId: some-key\n</code></pre>","title":"Secure Example"},{"location":"checks/sns/enable-topic-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/sqs/enable-queue-encryption/","text":"","title":"enable-queue-encryption"},{"location":"checks/sqs/enable-queue-encryption/#explanation","text":"<p>Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues.</p>","title":"Explanation"},{"location":"checks/sqs/enable-queue-encryption/#possible-impact","text":"<p>The SQS queue messages could be read if compromised</p>","title":"Possible Impact"},{"location":"checks/sqs/enable-queue-encryption/#suggested-resolution","text":"<p>Turn on SQS Queue encryption</p>","title":"Suggested Resolution"},{"location":"checks/sqs/enable-queue-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0096 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of queue\nResources:\n  Queue:\n    Type: AWS::SQS::Queue\n    Properties:\n      QueueName: my-queue\n</code></pre>","title":"Insecure Example"},{"location":"checks/sqs/enable-queue-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0096 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of queue\nResources:\n  Queue:\n    Type: AWS::SQS::Queue\n    Properties:\n      KmsMasterKeyId: some-key\n      QueueName: my-queue\n</code></pre>","title":"Secure Example"},{"location":"checks/sqs/enable-queue-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html</li> </ul>","title":"Related Links"},{"location":"checks/sqs/no-wildcards-in-policy-documents/","text":"","title":"no-wildcards-in-policy-documents"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#explanation","text":"<p>SQS Policy actions should always be restricted to a specific set.</p> <p>This ensures that the queue itself cannot be modified or deleted, and prevents possible future additions to queue actions to be implicitly allowed.</p>","title":"Explanation"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#possible-impact","text":"<p>SQS policies with wildcard actions allow more that is required</p>","title":"Possible Impact"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#suggested-resolution","text":"<p>Keep policy scope to the minimum that is required to be effective</p>","title":"Suggested Resolution"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0097 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of queue policy\nResources:\n  MyQueue:\n    Type: AWS::SQS::Queue\n    Properties:\n      Name: something\n  SampleSQSPolicy: \n    Type: AWS::SQS::QueuePolicy\n    Properties: \n      Queues: \n        - !Ref MyQueue\n      PolicyDocument: \n        Statement: \n          - \n            Action: \n              - \"*\" \n            Effect: \"Allow\"\n            Resource: \"arn:aws:sqs:us-east-2:444455556666:queue2\"\n            Principal:  \n              AWS: \n                - \"111122223333\"        \n</code></pre>","title":"Insecure Example"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#secure-example","text":"<p>The following example will pass the AVD-AWS-0097 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of queue policy\nResources:\n  MyQueue:\n    Type: AWS::SQS::Queue\n    Properties:\n      Name: something\n  SampleSQSPolicy: \n    Type: AWS::SQS::QueuePolicy\n    Properties: \n      Queues: \n        - Ref: MyQueue\n      PolicyDocument: \n        Statement: \n          - \n            Action: \n              - \"SQS:SendMessage\" \n              - \"SQS:ReceiveMessage\"\n            Effect: \"Allow\"\n            Resource: \"arn:aws:sqs:us-east-2:444455556666:queue2\"\n            Principal:  \n              AWS: \n                - \"111122223333\"        \n</code></pre>","title":"Secure Example"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-security-best-practices.html</li> </ul>","title":"Related Links"},{"location":"checks/ssm/secret-use-customer-key/","text":"","title":"secret-use-customer-key"},{"location":"checks/ssm/secret-use-customer-key/#explanation","text":"<p>Secrets Manager encrypts secrets by default using a default key created by AWS. To ensure control and granularity of secret encryption, CMK's should be used explicitly.</p>","title":"Explanation"},{"location":"checks/ssm/secret-use-customer-key/#possible-impact","text":"<p>Using AWS managed keys reduces the flexibility and control over the encryption key</p>","title":"Possible Impact"},{"location":"checks/ssm/secret-use-customer-key/#suggested-resolution","text":"<p>Use customer managed keys</p>","title":"Suggested Resolution"},{"location":"checks/ssm/secret-use-customer-key/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0098 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of secret\nResources:\n  BadSecret:\n    Type: AWS::SecretsManager::Secret\n    Properties:\n      Description: \"secret\"\n      Name: \"blah\"\n      SecretString: \"don't tell anyone\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/ssm/secret-use-customer-key/#secure-example","text":"<p>The following example will pass the AVD-AWS-0098 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of ingress rule\nResources:\n  Secret:\n    Type: AWS::SecretsManager::Secret\n    Properties:\n      Description: \"secret\"\n      KmsKeyId: \"my-key-id\"\n      Name: \"blah\"\n      SecretString: \"don't tell anyone\"\n</code></pre>","title":"Secure Example"},{"location":"checks/ssm/secret-use-customer-key/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/kms/latest/developerguide/services-secrets-manager.html#asm-encrypt</li> </ul>","title":"Related Links"},{"location":"checks/vpc/add-description-to-security-group-rule/","text":"","title":"add-description-to-security-group-rule"},{"location":"checks/vpc/add-description-to-security-group-rule/#explanation","text":"<p>Security group rules should include a description for auditing purposes.</p> <p>Simplifies auditing, debugging, and managing security groups.</p>","title":"Explanation"},{"location":"checks/vpc/add-description-to-security-group-rule/#possible-impact","text":"<p>Descriptions provide context for the firewall rule reasons</p>","title":"Possible Impact"},{"location":"checks/vpc/add-description-to-security-group-rule/#suggested-resolution","text":"<p>Add descriptions for all security groups rules</p>","title":"Suggested Resolution"},{"location":"checks/vpc/add-description-to-security-group-rule/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0099 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of SGR description\nResources:\n  BadSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Limits security group egress traffic\n      SecurityGroupEgress:\n      - CidrIp: 127.0.0.1/32\n        IpProtocol: \"-1\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/vpc/add-description-to-security-group-rule/#secure-example","text":"<p>The following example will pass the AVD-AWS-0099 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of SGR description\nResources:\n  GoodSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Limits security group egress traffic\n      SecurityGroupEgress:\n      - CidrIp: 127.0.0.1/32\n        Description: \"Can connect to loopback\"\n        IpProtocol: \"-1\"\n</code></pre>","title":"Secure Example"},{"location":"checks/vpc/add-description-to-security-group-rule/#related-links","text":"<ul> <li>https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html</li> </ul>","title":"Related Links"},{"location":"checks/vpc/add-description-to-security-group/","text":"","title":"add-description-to-security-group"},{"location":"checks/vpc/add-description-to-security-group/#explanation","text":"<p>Security groups should include a description for auditing purposes.</p> <p>Simplifies auditing, debugging, and managing security groups.</p>","title":"Explanation"},{"location":"checks/vpc/add-description-to-security-group/#possible-impact","text":"<p>Descriptions provide context for the firewall rule reasons</p>","title":"Possible Impact"},{"location":"checks/vpc/add-description-to-security-group/#suggested-resolution","text":"<p>Add descriptions for all security groups</p>","title":"Suggested Resolution"},{"location":"checks/vpc/add-description-to-security-group/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0099 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of group description\nResources:\n  BadSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      SecurityGroupEgress:\n      - CidrIp: 127.0.0.1/32\n        IpProtocol: \"-1\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/vpc/add-description-to-security-group/#secure-example","text":"<p>The following example will pass the AVD-AWS-0099 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of group description\nResources:\n  GoodSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Limits security group egress traffic\n      SecurityGroupEgress:\n      - CidrIp: 127.0.0.1/32\n        IpProtocol: \"-1\"\n</code></pre>","title":"Secure Example"},{"location":"checks/vpc/add-description-to-security-group/#related-links","text":"<ul> <li>https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html</li> </ul>","title":"Related Links"},{"location":"checks/vpc/no-excessive-port-access/","text":"","title":"no-excessive-port-access"},{"location":"checks/vpc/no-excessive-port-access/#explanation","text":"<p>Ensure access to specific required ports is allowed, and nothing else.</p>","title":"Explanation"},{"location":"checks/vpc/no-excessive-port-access/#possible-impact","text":"<p>All ports exposed for egressing data</p>","title":"Possible Impact"},{"location":"checks/vpc/no-excessive-port-access/#suggested-resolution","text":"<p>Set specific allowed ports</p>","title":"Suggested Resolution"},{"location":"checks/vpc/no-excessive-port-access/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0102 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of excessive ports\nResources:\n  NetworkACL:\n    Type: AWS::EC2::NetworkAcl\n    Properties:\n      VpcId: \"something\"\n  Rule:\n    Type: AWS::EC2::NetworkAclEntry\n    Properties:\n      NetworkAclId:\n        Ref: NetworkACL\n      Protocol: -1\n</code></pre>","title":"Insecure Example"},{"location":"checks/vpc/no-excessive-port-access/#secure-example","text":"<p>The following example will pass the AVD-AWS-0102 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Godd example of excessive ports\nResources: \n  NetworkACL:\n    Type: AWS::EC2::NetworkAcl\n    Properties:\n      VpcId: \"something\"\n  Rule:\n    Type: AWS::EC2::NetworkAclEntry\n    Properties:\n      NetworkAclId:\n        Ref: NetworkACL\n      Protocol: 6\n</code></pre>","title":"Secure Example"},{"location":"checks/vpc/no-excessive-port-access/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html</li> </ul>","title":"Related Links"},{"location":"checks/vpc/no-public-egress-sgr/","text":"","title":"no-public-egress-sgr"},{"location":"checks/vpc/no-public-egress-sgr/#explanation","text":"<p>Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible.</p>","title":"Explanation"},{"location":"checks/vpc/no-public-egress-sgr/#possible-impact","text":"<p>Your port is egressing data to the internet</p>","title":"Possible Impact"},{"location":"checks/vpc/no-public-egress-sgr/#suggested-resolution","text":"<p>Set a more restrictive cidr range</p>","title":"Suggested Resolution"},{"location":"checks/vpc/no-public-egress-sgr/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0104 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of egress rule\nResources:\n  BadSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Limits security group egress traffic\n      SecurityGroupEgress:\n      - CidrIp: 80.1.2.3/32\n        IpProtocol: \"6\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/vpc/no-public-egress-sgr/#secure-example","text":"<p>The following example will pass the AVD-AWS-0104 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of egress rule\nResources:\n  BadSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Limits security group egress traffic\n      SecurityGroupEgress:\n      - CidrIp: 127.0.0.1/32\n        IpProtocol: \"6\"\n</code></pre>","title":"Secure Example"},{"location":"checks/vpc/no-public-egress-sgr/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/whitepapers/latest/building-scalable-secure-multi-vpc-network-infrastructure/centralized-egress-to-internet.html</li> </ul>","title":"Related Links"},{"location":"checks/vpc/no-public-ingress-acl/","text":"","title":"no-public-ingress-acl"},{"location":"checks/vpc/no-public-ingress-acl/#explanation","text":"<p>Opening up ACLs to the public internet is potentially dangerous. You should restrict access to IP addresses or ranges that explicitly require it where possible.</p>","title":"Explanation"},{"location":"checks/vpc/no-public-ingress-acl/#possible-impact","text":"<p>The ports are exposed for ingressing data to the internet</p>","title":"Possible Impact"},{"location":"checks/vpc/no-public-ingress-acl/#suggested-resolution","text":"<p>Set a more restrictive cidr range</p>","title":"Suggested Resolution"},{"location":"checks/vpc/no-public-ingress-acl/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0105 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of excessive ports\nResources:\n  NetworkACL:\n    Type: AWS::EC2::NetworkAcl\n    Properties:\n      VpcId: \"something\"\n  Rule:\n    Type: AWS::EC2::NetworkAclEntry\n    Properties:\n      NetworkAclId:\n        Ref: NetworkACL\n      Protocol: 6\n      CidrBlock: 0.0.0.0/0\n      RuleAction: allow\n</code></pre>","title":"Insecure Example"},{"location":"checks/vpc/no-public-ingress-acl/#secure-example","text":"<p>The following example will pass the AVD-AWS-0105 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Godd example of excessive ports\nResources: \n  NetworkACL:\n    Type: AWS::EC2::NetworkAcl\n    Properties:\n      VpcId: \"something\"\n  Rule:\n    Type: AWS::EC2::NetworkAclEntry\n    Properties:\n      NetworkAclId:\n        Ref: NetworkACL\n      Protocol: 6\n      CidrBlock: 10.0.0.0/8\n      RuleAction: allow\n</code></pre>","title":"Secure Example"},{"location":"checks/vpc/no-public-ingress-acl/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html</li> </ul>","title":"Related Links"},{"location":"checks/vpc/no-public-ingress-sgr/","text":"","title":"no-public-ingress-sgr"},{"location":"checks/vpc/no-public-ingress-sgr/#explanation","text":"<p>Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.</p>","title":"Explanation"},{"location":"checks/vpc/no-public-ingress-sgr/#possible-impact","text":"<p>Your port exposed to the internet</p>","title":"Possible Impact"},{"location":"checks/vpc/no-public-ingress-sgr/#suggested-resolution","text":"<p>Set a more restrictive cidr range</p>","title":"Suggested Resolution"},{"location":"checks/vpc/no-public-ingress-sgr/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0107 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Bad example of ingress rule\nResources:\n  BadSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Limits security group egress traffic\n      SecurityGroupIngress:\n      - CidrIp: 80.1.2.3/32\n        IpProtocol: \"6\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/vpc/no-public-ingress-sgr/#secure-example","text":"<p>The following example will pass the AVD-AWS-0107 check.</p> <pre><code>---\nAWSTemplateFormatVersion: 2010-09-09\nDescription: Good example of ingress rule\nResources:\n  BadSecurityGroup:\n    Type: AWS::EC2::SecurityGroup\n    Properties:\n      GroupDescription: Limits security group egress traffic\n      SecurityGroupIngress:\n      - CidrIp: 127.0.0.1/32\n        IpProtocol: \"6\"\n</code></pre>","title":"Secure Example"},{"location":"checks/vpc/no-public-ingress-sgr/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html</li> </ul>","title":"Related Links"},{"location":"checks/workspaces/enable-disk-encryption/","text":"","title":"enable-disk-encryption"},{"location":"checks/workspaces/enable-disk-encryption/#explanation","text":"<p>Workspace volumes for both user and root should be encrypted to protect the data stored on them.</p>","title":"Explanation"},{"location":"checks/workspaces/enable-disk-encryption/#possible-impact","text":"<p>Data can be freely read if compromised</p>","title":"Possible Impact"},{"location":"checks/workspaces/enable-disk-encryption/#suggested-resolution","text":"<p>Root and user volume encryption should be enabled</p>","title":"Suggested Resolution"},{"location":"checks/workspaces/enable-disk-encryption/#insecure-example","text":"<p>The following example will fail the AVD-AWS-0109 check.</p> <pre><code>---\nResources:\n  BadExample:\n    Type: AWS::WorkSpaces::Workspace\n    Properties: \n      RootVolumeEncryptionEnabled: false\n      UserVolumeEncryptionEnabled: false\n      UserName: \"admin\"\n</code></pre>","title":"Insecure Example"},{"location":"checks/workspaces/enable-disk-encryption/#secure-example","text":"<p>The following example will pass the AVD-AWS-0109 check.</p> <pre><code>---\nResources:\n  GoodExample:\n    Type: AWS::WorkSpaces::Workspace\n    Properties:\n      RootVolumeEncryptionEnabled: true\n      UserVolumeEncryptionEnabled: true\n      UserName: \"admin\"\n</code></pre>","title":"Secure Example"},{"location":"checks/workspaces/enable-disk-encryption/#related-links","text":"<ul> <li>https://docs.aws.amazon.com/workspaces/latest/adminguide/encrypt-workspaces.html</li> </ul>","title":"Related Links"},{"location":"getting-started/credits/","text":"<ul> <li>Liam Galvin (liamg)</li> <li>Owen Rumney (owenrumney)</li> </ul>","title":"Authors"},{"location":"getting-started/installation/","text":"","title":"Installation"},{"location":"getting-started/installation/#install-with-brewlinuxbrew","text":"<pre><code>brew tap cfsec/cfsec\n</code></pre>","title":"Install with brew/linuxbrew:"},{"location":"getting-started/installation/#install-with-chocolatey","text":"<pre><code>choco install cfsec\n</code></pre> <p>You can grab the binary for your system from the releases page.</p>","title":"Install with Chocolatey:"},{"location":"getting-started/installation/#install-with-go","text":"<pre><code>go install github.com/aquasecurity/cfsec/cmd/cfsec@latest\n</code></pre>","title":"Install with Go:"},{"location":"getting-started/quickstart/","text":"","title":"Quick Start"},{"location":"getting-started/quickstart/#using-as-a-command-line-tool","text":"<p>The easiest way to run <code>cfsec</code> is to run it in the directory you want to scan.</p> <pre><code>cfsec\n</code></pre> <p><code>cfsec</code> will traverse the directory structure processing valid CloudFormation file.</p> <p>If you want to run on a specific location, this can be passed as an argument;</p> <pre><code>cfsec ./stacks/prod/bucket.yaml\n</code></pre> <p>The exit status will be non-zero if cfsec finds problems, otherwise the exit status will be zero.</p>","title":"Using as a command line tool"},{"location":"getting-started/quickstart/#use-with-docker","text":"<p>As an alternative to installing and running cfsec on your system, you may run cfsec in a Docker container.</p> <p>To run:</p> <pre><code>docker run --rm -it -v \"$(pwd):/src\" aquasec/cfsec /src\n</code></pre>","title":"Use with Docker"},{"location":"getting-started/quickstart/#using-in-ci","text":"<p><code>cfsec</code> can be added to any CI pipeline as a command with the exit code dictating if it breaks the build.</p> <p>We do provide a GitHub Action that will also upload the results to GitHub code scanning UI.</p>","title":"Using in CI"},{"location":"getting-started/quickstart/#passing-arguments","text":"<p>This page only covers the basics of what <code>cfsec</code> can do - much more is achievable using the arguments on the Parameters page.</p>","title":"Passing Arguments"},{"location":"getting-started/usage/","text":"<p>cfsec can by run with no arguments and will act on the current folder.</p> <p>For a richer experience, there are many additional command line arguments that you can make use of.</p>    Argument Short Code Description     --format [default,json,csv] -f Select output format: default, json, csv   --help -h help for cfsec   --no-color  Disable colored output (American style!)   --no-colour  Disable coloured output   --parameters -p Pass overrides for parameter values   --verbose  Enable verbose logging   --version -v Show version information and exit    <p>This list can also be found by running <code>cfsec --help</code></p>","title":"Parameters"},{"location":"getting-started/configuration/github-actions/github-action/","text":"","title":"GitHub Action"},{"location":"getting-started/configuration/github-actions/github-action/#what-is-it","text":"<p>Github security alerts sit on the <code>Security</code> tab in your github project and detail any security issues that have been found.</p> <p><code>cfsec</code> can enrich this information, annotating the exact areas in the code base for a given branch with the details of the failure and the severity.</p> <p>We have provided an action which can be used in your github repo with very little effort.</p>","title":"What is it?"},{"location":"getting-started/configuration/github-actions/github-action/#adding-the-action","text":"<p>Github Actions make it easy to add functionality; to add an action, go to the <code>Action</code> tab to create a new workflow and choose to Set up a workflow yourself.</p> <p></p> <p>Paste in the workflow content below (be sure to check you're using the latest version of the cfsec-sarif-action by checking here)</p> <pre><code>name: cfsec\non:\n  push:\n    branches:\n      - main\n  pull_request:\njobs:\n  cfsec:\n    name: cfsec sarif report\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Clone repo\n        uses: actions/checkout@master\n\n      - name: cfsec\n        uses: cfsec/cfsec-sarif-action@main\n        with:\n          sarif_file: cfsec.sarif         \n\n      - name: Upload SARIF file\n        uses: github/codeql-action/upload-sarif@v1\n        with:\n          # Path to SARIF file relative to the root of the repository\n          sarif_file: cfsec.sarif    \n</code></pre>","title":"Adding the action"},{"location":"getting-started/configuration/github-actions/github-action/#what-is-this-doing","text":"<p>Basically, this action is starting a new <code>ubuntu</code> github action container and checking out the code for either the pull request or the push to master/main.</p> <p>Once the code has been checked out, <code>cfsec</code> with process everything in the local path and generate a sarif report.</p> <p>Finally, the sarif report will be uploaded and the <code>Security</code> tab updated with the identified checks.</p> <p>It will look something like;</p> <p></p>","title":"What is this doing?"},{"location":"getting-started/configuration/github-actions/github-action/#anything-else-i-should-know","text":"<p>If you have code that is deeper in the github repo, you can use <code>working_directory</code> for the action;</p> <pre><code>- name: cfsec\n  uses: cfsec/cfsec-sarif-action@v0.0.3\n  with:\n    working_directory: stacks/prod\n    sarif_file: cfsec.sarif         \n    github_token: ${{ secrets.GITHUB_TOKEN }}\n</code></pre> <p>This will target the checks to all folders under <code>stacks/prod</code></p>","title":"Anything else I should know?"}]}