{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"cfsec is a static analysis security scanner for your yaml and json CloudFormation templates. Designed to run locally and in your CI pipelines, developer-friendly output and fully documented checks mean detection and remediation can take place as quickly and efficiently as possible cfsec takes a developer-first approach to scanning your CloudFormation templates; using static analysis and deep integration with the official HCL parser it ensures thatsecurity issues can be detected before your infrastructure changes take effect. Demo: Misconfiguration Detection cfsec is an Aqua Security open source project. Learn about our open source work and portfolio here . Contact us about any matter by opening a GitHub Discussion here","title":"HOME"},{"location":"checks/api-gateway/enable-access-logging/","text":"Explanation API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages. Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for API Gateway stages Insecure Example The following example will fail the AVD-AWS-0001 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of ApiGateway Resources : BadApi : Type : AWS::ApiGatewayV2::Api BadApiStage : Type : AWS::ApiGatewayV2::Stage Properties : AccessLogSettings : Format : json ApiId : !Ref BadApi StageName : BadApiStage Secure Example The following example will pass the AVD-AWS-0001 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of ApiGateway Resources : GoodApi : Type : AWS::ApiGatewayV2::Api GoodApiStage : Type : AWS::ApiGatewayV2::Stage Properties : AccessLogSettings : DestinationArn : gateway-logging Format : json ApiId : !Ref GoodApi StageName : GoodApiStage Related Links https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-logging.html","title":"enable-access-logging"},{"location":"checks/api-gateway/enable-access-logging/#explanation","text":"API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages.","title":"Explanation"},{"location":"checks/api-gateway/enable-access-logging/#possible-impact","text":"Logging provides vital information about access and usage","title":"Possible Impact"},{"location":"checks/api-gateway/enable-access-logging/#suggested-resolution","text":"Enable logging for API Gateway stages","title":"Suggested Resolution"},{"location":"checks/api-gateway/enable-access-logging/#insecure-example","text":"The following example will fail the AVD-AWS-0001 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of ApiGateway Resources : BadApi : Type : AWS::ApiGatewayV2::Api BadApiStage : Type : AWS::ApiGatewayV2::Stage Properties : AccessLogSettings : Format : json ApiId : !Ref BadApi StageName : BadApiStage","title":"Insecure Example"},{"location":"checks/api-gateway/enable-access-logging/#secure-example","text":"The following example will pass the AVD-AWS-0001 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of ApiGateway Resources : GoodApi : Type : AWS::ApiGatewayV2::Api GoodApiStage : Type : AWS::ApiGatewayV2::Stage Properties : AccessLogSettings : DestinationArn : gateway-logging Format : json ApiId : !Ref GoodApi StageName : GoodApiStage","title":"Secure Example"},{"location":"checks/api-gateway/enable-access-logging/#related-links","text":"https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-logging.html","title":"Related Links"},{"location":"checks/athena/enable-at-rest-encryption/","text":"Explanation Athena databases and workspace result sets should be encrypted at rests. These databases and query sets are generally derived from data in S3 buckets and should have the same level of at rest protection. Possible Impact Data can be read if the Athena Database is compromised Suggested Resolution Enable encryption at rest for Athena databases and workgroup configurations Insecure Example The following example will fail the AVD-AWS-0006 check. --- Resources : BadExample : Properties : Name : badExample WorkGroupConfiguration : ResultConfiguration : Type : AWS::Athena::WorkGroup Secure Example The following example will pass the AVD-AWS-0006 check. --- Resources : GoodExample : Properties : Name : goodExample WorkGroupConfiguration : ResultConfiguration : EncryptionConfiguration : EncryptionOption : SSE_KMS Type : AWS::Athena::WorkGroup Related Links https://docs.aws.amazon.com/athena/latest/ug/encryption.html","title":"enable-at-rest-encryption"},{"location":"checks/athena/enable-at-rest-encryption/#explanation","text":"Athena databases and workspace result sets should be encrypted at rests. These databases and query sets are generally derived from data in S3 buckets and should have the same level of at rest protection.","title":"Explanation"},{"location":"checks/athena/enable-at-rest-encryption/#possible-impact","text":"Data can be read if the Athena Database is compromised","title":"Possible Impact"},{"location":"checks/athena/enable-at-rest-encryption/#suggested-resolution","text":"Enable encryption at rest for Athena databases and workgroup configurations","title":"Suggested Resolution"},{"location":"checks/athena/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0006 check. --- Resources : BadExample : Properties : Name : badExample WorkGroupConfiguration : ResultConfiguration : Type : AWS::Athena::WorkGroup","title":"Insecure Example"},{"location":"checks/athena/enable-at-rest-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0006 check. --- Resources : GoodExample : Properties : Name : goodExample WorkGroupConfiguration : ResultConfiguration : EncryptionConfiguration : EncryptionOption : SSE_KMS Type : AWS::Athena::WorkGroup","title":"Secure Example"},{"location":"checks/athena/enable-at-rest-encryption/#related-links","text":"https://docs.aws.amazon.com/athena/latest/ug/encryption.html","title":"Related Links"},{"location":"checks/athena/no-encryption-override/","text":"Explanation Athena workgroup configuration should be enforced to prevent client side changes to disable encryption settings. Possible Impact Clients can ignore encryption requirements Suggested Resolution Enforce the configuration to prevent client overrides Insecure Example The following example will fail the AVD-AWS-0007 check. --- Resources : BadExample : Properties : Name : badExample WorkGroupConfiguration : EnforceWorkGroupConfiguration : false ResultConfiguration : EncryptionConfiguration : EncryptionOption : SSE_KMS Type : AWS::Athena::WorkGroup Secure Example The following example will pass the AVD-AWS-0007 check. --- Resources : GoodExample : Properties : Name : goodExample WorkGroupConfiguration : EnforceWorkGroupConfiguration : true ResultConfiguration : EncryptionConfiguration : EncryptionOption : SSE_KMS Type : AWS::Athena::WorkGroup Related Links https://docs.aws.amazon.com/athena/latest/ug/manage-queries-control-costs-with-workgroups.html","title":"no-encryption-override"},{"location":"checks/athena/no-encryption-override/#explanation","text":"Athena workgroup configuration should be enforced to prevent client side changes to disable encryption settings.","title":"Explanation"},{"location":"checks/athena/no-encryption-override/#possible-impact","text":"Clients can ignore encryption requirements","title":"Possible Impact"},{"location":"checks/athena/no-encryption-override/#suggested-resolution","text":"Enforce the configuration to prevent client overrides","title":"Suggested Resolution"},{"location":"checks/athena/no-encryption-override/#insecure-example","text":"The following example will fail the AVD-AWS-0007 check. --- Resources : BadExample : Properties : Name : badExample WorkGroupConfiguration : EnforceWorkGroupConfiguration : false ResultConfiguration : EncryptionConfiguration : EncryptionOption : SSE_KMS Type : AWS::Athena::WorkGroup","title":"Insecure Example"},{"location":"checks/athena/no-encryption-override/#secure-example","text":"The following example will pass the AVD-AWS-0007 check. --- Resources : GoodExample : Properties : Name : goodExample WorkGroupConfiguration : EnforceWorkGroupConfiguration : true ResultConfiguration : EncryptionConfiguration : EncryptionOption : SSE_KMS Type : AWS::Athena::WorkGroup","title":"Secure Example"},{"location":"checks/athena/no-encryption-override/#related-links","text":"https://docs.aws.amazon.com/athena/latest/ug/manage-queries-control-costs-with-workgroups.html","title":"Related Links"},{"location":"checks/autoscaling/enable-at-rest-encryption/","text":"Explanation Block devices should be encrypted to ensure sensitive data is held securely at rest. Possible Impact The block device could be compromised and read from Suggested Resolution Turn on encryption for all block devices Insecure Example The following example will fail the AVD-AWS-0008 check. --- Resources : BadExample : Properties : BlockDeviceMappings : - DeviceName : root Ebs : Encrypted : true - DeviceName : data Ebs : Encrypted : false ImageId : ami-123456 InstanceType : t2.small Type : AWS::AutoScaling::LaunchConfiguration Secure Example The following example will pass the AVD-AWS-0008 check. --- Resources : GoodExample : Properties : BlockDeviceMappings : - DeviceName : root Ebs : Encrypted : true ImageId : ami-123456 InstanceType : t2.small Type : AWS::AutoScaling::LaunchConfiguration Related Links https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html","title":"enable-at-rest-encryption"},{"location":"checks/autoscaling/enable-at-rest-encryption/#explanation","text":"Block devices should be encrypted to ensure sensitive data is held securely at rest.","title":"Explanation"},{"location":"checks/autoscaling/enable-at-rest-encryption/#possible-impact","text":"The block device could be compromised and read from","title":"Possible Impact"},{"location":"checks/autoscaling/enable-at-rest-encryption/#suggested-resolution","text":"Turn on encryption for all block devices","title":"Suggested Resolution"},{"location":"checks/autoscaling/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0008 check. --- Resources : BadExample : Properties : BlockDeviceMappings : - DeviceName : root Ebs : Encrypted : true - DeviceName : data Ebs : Encrypted : false ImageId : ami-123456 InstanceType : t2.small Type : AWS::AutoScaling::LaunchConfiguration","title":"Insecure Example"},{"location":"checks/autoscaling/enable-at-rest-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0008 check. --- Resources : GoodExample : Properties : BlockDeviceMappings : - DeviceName : root Ebs : Encrypted : true ImageId : ami-123456 InstanceType : t2.small Type : AWS::AutoScaling::LaunchConfiguration","title":"Secure Example"},{"location":"checks/autoscaling/enable-at-rest-encryption/#related-links","text":"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/RootDeviceStorage.html","title":"Related Links"},{"location":"checks/autoscaling/no-public-ip/","text":"Explanation You should limit the provision of public IP addresses for resources. Resources should not be exposed on the public internet, but should have access limited to consumers required for the function of your application. Possible Impact The instance or configuration is publicly accessible Suggested Resolution Set the instance to not be publicly accessible Insecure Example The following example will fail the AVD-AWS-0009 check. --- Resources : BadExample : Properties : AssociatePublicIpAddress : true ImageId : ami-123456 InstanceType : t2.small Type : AWS::AutoScaling::LaunchConfiguration Secure Example The following example will pass the AVD-AWS-0009 check. --- Resources : GoodExample : Properties : ImageId : ami-123456 InstanceType : t2.small Type : AWS::AutoScaling::LaunchConfiguration Related Links https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html","title":"no-public-ip"},{"location":"checks/autoscaling/no-public-ip/#explanation","text":"You should limit the provision of public IP addresses for resources. Resources should not be exposed on the public internet, but should have access limited to consumers required for the function of your application.","title":"Explanation"},{"location":"checks/autoscaling/no-public-ip/#possible-impact","text":"The instance or configuration is publicly accessible","title":"Possible Impact"},{"location":"checks/autoscaling/no-public-ip/#suggested-resolution","text":"Set the instance to not be publicly accessible","title":"Suggested Resolution"},{"location":"checks/autoscaling/no-public-ip/#insecure-example","text":"The following example will fail the AVD-AWS-0009 check. --- Resources : BadExample : Properties : AssociatePublicIpAddress : true ImageId : ami-123456 InstanceType : t2.small Type : AWS::AutoScaling::LaunchConfiguration","title":"Insecure Example"},{"location":"checks/autoscaling/no-public-ip/#secure-example","text":"The following example will pass the AVD-AWS-0009 check. --- Resources : GoodExample : Properties : ImageId : ami-123456 InstanceType : t2.small Type : AWS::AutoScaling::LaunchConfiguration","title":"Secure Example"},{"location":"checks/autoscaling/no-public-ip/#related-links","text":"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html","title":"Related Links"},{"location":"checks/cloudfront/enable-logging/","text":"Explanation You should configure CloudFront Access Logging to create log files that contain detailed information about every user request that CloudFront receives Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for CloudFront distributions Insecure Example The following example will fail the AVD-AWS-0010 check. --- Resources : BadExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Origins : - DomainName : https://some.domain Id : somedomain1 Type : AWS::CloudFront::Distribution Secure Example The following example will pass the AVD-AWS-0010 check. --- Resources : GoodExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 Type : AWS::CloudFront::Distribution Related Links https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html","title":"enable-logging"},{"location":"checks/cloudfront/enable-logging/#explanation","text":"You should configure CloudFront Access Logging to create log files that contain detailed information about every user request that CloudFront receives","title":"Explanation"},{"location":"checks/cloudfront/enable-logging/#possible-impact","text":"Logging provides vital information about access and usage","title":"Possible Impact"},{"location":"checks/cloudfront/enable-logging/#suggested-resolution","text":"Enable logging for CloudFront distributions","title":"Suggested Resolution"},{"location":"checks/cloudfront/enable-logging/#insecure-example","text":"The following example will fail the AVD-AWS-0010 check. --- Resources : BadExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Origins : - DomainName : https://some.domain Id : somedomain1 Type : AWS::CloudFront::Distribution","title":"Insecure Example"},{"location":"checks/cloudfront/enable-logging/#secure-example","text":"The following example will pass the AVD-AWS-0010 check. --- Resources : GoodExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 Type : AWS::CloudFront::Distribution","title":"Secure Example"},{"location":"checks/cloudfront/enable-logging/#related-links","text":"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html","title":"Related Links"},{"location":"checks/cloudfront/enable-waf/","text":"Explanation You should configure a Web Application Firewall in front of your CloudFront distribution. This will mitigate many types of attacks on your web application. Possible Impact Complex web application attacks can more easily be performed without a WAF Suggested Resolution Enable WAF for the CloudFront distribution Insecure Example The following example will fail the AVD-AWS-0011 check. --- Resources : BadExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 Type : AWS::CloudFront::Distribution Secure Example The following example will pass the AVD-AWS-0011 check. --- Resources : GoodExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 WebACLId : waf_id Type : AWS::CloudFront::Distribution Related Links https://docs.aws.amazon.com/waf/latest/developerguide/cloudfront-features.html","title":"enable-waf"},{"location":"checks/cloudfront/enable-waf/#explanation","text":"You should configure a Web Application Firewall in front of your CloudFront distribution. This will mitigate many types of attacks on your web application.","title":"Explanation"},{"location":"checks/cloudfront/enable-waf/#possible-impact","text":"Complex web application attacks can more easily be performed without a WAF","title":"Possible Impact"},{"location":"checks/cloudfront/enable-waf/#suggested-resolution","text":"Enable WAF for the CloudFront distribution","title":"Suggested Resolution"},{"location":"checks/cloudfront/enable-waf/#insecure-example","text":"The following example will fail the AVD-AWS-0011 check. --- Resources : BadExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 Type : AWS::CloudFront::Distribution","title":"Insecure Example"},{"location":"checks/cloudfront/enable-waf/#secure-example","text":"The following example will pass the AVD-AWS-0011 check. --- Resources : GoodExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 WebACLId : waf_id Type : AWS::CloudFront::Distribution","title":"Secure Example"},{"location":"checks/cloudfront/enable-waf/#related-links","text":"https://docs.aws.amazon.com/waf/latest/developerguide/cloudfront-features.html","title":"Related Links"},{"location":"checks/cloudfront/enforce-https/","text":"Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact CloudFront is available through an unencrypted connection Suggested Resolution Only allow HTTPS for CloudFront distribution communication Insecure Example The following example will fail the AVD-AWS-0012 check. --- Resources : BadExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : allow-all Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 WebACLId : waf_id Type : AWS::CloudFront::Distribution Secure Example The following example will pass the AVD-AWS-0012 check. --- Resources : GoodExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 WebACLId : waf_id Type : AWS::CloudFront::Distribution Related Links https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-cloudfront-to-s3-origin.html","title":"enforce-https"},{"location":"checks/cloudfront/enforce-https/#explanation","text":"Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.","title":"Explanation"},{"location":"checks/cloudfront/enforce-https/#possible-impact","text":"CloudFront is available through an unencrypted connection","title":"Possible Impact"},{"location":"checks/cloudfront/enforce-https/#suggested-resolution","text":"Only allow HTTPS for CloudFront distribution communication","title":"Suggested Resolution"},{"location":"checks/cloudfront/enforce-https/#insecure-example","text":"The following example will fail the AVD-AWS-0012 check. --- Resources : BadExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : allow-all Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 WebACLId : waf_id Type : AWS::CloudFront::Distribution","title":"Insecure Example"},{"location":"checks/cloudfront/enforce-https/#secure-example","text":"The following example will pass the AVD-AWS-0012 check. --- Resources : GoodExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 WebACLId : waf_id Type : AWS::CloudFront::Distribution","title":"Secure Example"},{"location":"checks/cloudfront/enforce-https/#related-links","text":"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/using-https-cloudfront-to-s3-origin.html","title":"Related Links"},{"location":"checks/cloudfront/use-secure-tls-policy/","text":"Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated SSL policies increase exposure to known vulnerabilities Suggested Resolution Use the most modern TLS/SSL policies available Insecure Example The following example will fail the AVD-AWS-0013 check. --- Resources : BadExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 ViewerCertificate : MinimumProtocolVersion : TLSv1.0 Type : AWS::CloudFront::Distribution Secure Example The following example will pass the AVD-AWS-0013 check. --- Resources : GoodExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 ViewerCertificate : MinimumProtocolVersion : TLSv1.2_2021 Type : AWS::CloudFront::Distribution Related Links https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html","title":"use-secure-tls-policy"},{"location":"checks/cloudfront/use-secure-tls-policy/#explanation","text":"You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.","title":"Explanation"},{"location":"checks/cloudfront/use-secure-tls-policy/#possible-impact","text":"Outdated SSL policies increase exposure to known vulnerabilities","title":"Possible Impact"},{"location":"checks/cloudfront/use-secure-tls-policy/#suggested-resolution","text":"Use the most modern TLS/SSL policies available","title":"Suggested Resolution"},{"location":"checks/cloudfront/use-secure-tls-policy/#insecure-example","text":"The following example will fail the AVD-AWS-0013 check. --- Resources : BadExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 ViewerCertificate : MinimumProtocolVersion : TLSv1.0 Type : AWS::CloudFront::Distribution","title":"Insecure Example"},{"location":"checks/cloudfront/use-secure-tls-policy/#secure-example","text":"The following example will pass the AVD-AWS-0013 check. --- Resources : GoodExample : Properties : DistributionConfig : DefaultCacheBehavior : TargetOriginId : target ViewerProtocolPolicy : https-only Enabled : true Logging : Bucket : logging-bucket Origins : - DomainName : https://some.domain Id : somedomain1 ViewerCertificate : MinimumProtocolVersion : TLSv1.2_2021 Type : AWS::CloudFront::Distribution","title":"Secure Example"},{"location":"checks/cloudfront/use-secure-tls-policy/#related-links","text":"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/secure-connections-supported-viewer-protocols-ciphers.html","title":"Related Links"},{"location":"checks/cloudtrail/enable-all-regions/","text":"Explanation When creating Cloudtrail in the AWS Management Console the trail is configured by default to be multi-region, this isn't the case with the Terraform resource. Cloudtrail should cover the full AWS account to ensure you can track changes in regions you are not actively operting in. Possible Impact Activity could be happening in your account in a different region Suggested Resolution Enable Cloudtrail in all regions Insecure Example The following example will fail the AVD-AWS-0014 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : false S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\" Secure Example The following example will pass the AVD-AWS-0014 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : true S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\" Related Links https://docs.aws.amazon.com/awscloudtrail/latest/userguide/receive-cloudtrail-log-files-from-multiple-regions.html","title":"enable-all-regions"},{"location":"checks/cloudtrail/enable-all-regions/#explanation","text":"When creating Cloudtrail in the AWS Management Console the trail is configured by default to be multi-region, this isn't the case with the Terraform resource. Cloudtrail should cover the full AWS account to ensure you can track changes in regions you are not actively operting in.","title":"Explanation"},{"location":"checks/cloudtrail/enable-all-regions/#possible-impact","text":"Activity could be happening in your account in a different region","title":"Possible Impact"},{"location":"checks/cloudtrail/enable-all-regions/#suggested-resolution","text":"Enable Cloudtrail in all regions","title":"Suggested Resolution"},{"location":"checks/cloudtrail/enable-all-regions/#insecure-example","text":"The following example will fail the AVD-AWS-0014 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : false S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\"","title":"Insecure Example"},{"location":"checks/cloudtrail/enable-all-regions/#secure-example","text":"The following example will pass the AVD-AWS-0014 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : true S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\"","title":"Secure Example"},{"location":"checks/cloudtrail/enable-all-regions/#related-links","text":"https://docs.aws.amazon.com/awscloudtrail/latest/userguide/receive-cloudtrail-log-files-from-multiple-regions.html","title":"Related Links"},{"location":"checks/cloudtrail/enable-at-rest-encryption/","text":"Explanation Cloudtrail logs should be encrypted at rest to secure the sensitive data. Cloudtrail logs record all activity that occurs in the the account through API calls and would be one of the first places to look when reacting to a breach. Possible Impact Data can be freely read if compromised Suggested Resolution Enable encryption at rest Insecure Example The following example will fail the AVD-AWS-0015 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : false S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\" Secure Example The following example will pass the AVD-AWS-0015 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : true KmsKeyId : \"alias/CloudtrailKey\" S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\" Related Links https://docs.aws.amazon.com/awscloudtrail/latest/userguide/encrypting-cloudtrail-log-files-with-aws-kms.html","title":"enable-at-rest-encryption"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#explanation","text":"Cloudtrail logs should be encrypted at rest to secure the sensitive data. Cloudtrail logs record all activity that occurs in the the account through API calls and would be one of the first places to look when reacting to a breach.","title":"Explanation"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#possible-impact","text":"Data can be freely read if compromised","title":"Possible Impact"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#suggested-resolution","text":"Enable encryption at rest","title":"Suggested Resolution"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0015 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : false S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\"","title":"Insecure Example"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0015 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : true KmsKeyId : \"alias/CloudtrailKey\" S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\"","title":"Secure Example"},{"location":"checks/cloudtrail/enable-at-rest-encryption/#related-links","text":"https://docs.aws.amazon.com/awscloudtrail/latest/userguide/encrypting-cloudtrail-log-files-with-aws-kms.html","title":"Related Links"},{"location":"checks/cloudtrail/enable-log-validation/","text":"Explanation Log validation should be activated on Cloudtrail logs to prevent the tampering of the underlying data in the S3 bucket. It is feasible that a rogue actor compromising an AWS account might want to modify the log data to remove trace of their actions. Possible Impact Illicit activity could be removed from the logs Suggested Resolution Turn on log validation for Cloudtrail Insecure Example The following example will fail the AVD-AWS-0016 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : false S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\" Secure Example The following example will pass the AVD-AWS-0016 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : true EnableLogFileValidation : true S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\" Related Links https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-log-file-validation-intro.html","title":"enable-log-validation"},{"location":"checks/cloudtrail/enable-log-validation/#explanation","text":"Log validation should be activated on Cloudtrail logs to prevent the tampering of the underlying data in the S3 bucket. It is feasible that a rogue actor compromising an AWS account might want to modify the log data to remove trace of their actions.","title":"Explanation"},{"location":"checks/cloudtrail/enable-log-validation/#possible-impact","text":"Illicit activity could be removed from the logs","title":"Possible Impact"},{"location":"checks/cloudtrail/enable-log-validation/#suggested-resolution","text":"Turn on log validation for Cloudtrail","title":"Suggested Resolution"},{"location":"checks/cloudtrail/enable-log-validation/#insecure-example","text":"The following example will fail the AVD-AWS-0016 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : false S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\"","title":"Insecure Example"},{"location":"checks/cloudtrail/enable-log-validation/#secure-example","text":"The following example will pass the AVD-AWS-0016 check. --- Resources : BadExample : Type : AWS::CloudTrail::Trail Properties : IsLogging : true IsMultiRegionTrail : true EnableLogFileValidation : true S3BucketName : \"CloudtrailBucket\" S3KeyPrefix : \"/trailing\" TrailName : \"Cloudtrail\"","title":"Secure Example"},{"location":"checks/cloudtrail/enable-log-validation/#related-links","text":"https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-log-file-validation-intro.html","title":"Related Links"},{"location":"checks/cloudwatch/log-group-customer-key/","text":"Explanation CloudWatch log groups are encrypted by default, however, to get the full benefit of controlling key rotation and other KMS aspects a KMS CMK should be used. Possible Impact Log data may be leaked if the logs are compromised. No auditing of who have viewed the logs. Suggested Resolution Enable CMK encryption of CloudWatch Log Groups Insecure Example The following example will fail the AVD-AWS-0017 check. --- Resources : BadExample : Type : AWS::Logs::LogGroup Properties : KmsKeyId : \"\" LogGroupName : \"aws/lambda/badExample\" RetentionInDays : 30 Secure Example The following example will pass the AVD-AWS-0017 check. --- Resources : GoodExample : Type : AWS::Logs::LogGroup Properties : KmsKeyId : \"arn:aws:kms:us-west-2:111122223333:key/lambdalogging\" LogGroupName : \"aws/lambda/goodExample\" RetentionInDays : 30 Related Links https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/encrypt-log-data-kms.html","title":"log-group-customer-key"},{"location":"checks/cloudwatch/log-group-customer-key/#explanation","text":"CloudWatch log groups are encrypted by default, however, to get the full benefit of controlling key rotation and other KMS aspects a KMS CMK should be used.","title":"Explanation"},{"location":"checks/cloudwatch/log-group-customer-key/#possible-impact","text":"Log data may be leaked if the logs are compromised. No auditing of who have viewed the logs.","title":"Possible Impact"},{"location":"checks/cloudwatch/log-group-customer-key/#suggested-resolution","text":"Enable CMK encryption of CloudWatch Log Groups","title":"Suggested Resolution"},{"location":"checks/cloudwatch/log-group-customer-key/#insecure-example","text":"The following example will fail the AVD-AWS-0017 check. --- Resources : BadExample : Type : AWS::Logs::LogGroup Properties : KmsKeyId : \"\" LogGroupName : \"aws/lambda/badExample\" RetentionInDays : 30","title":"Insecure Example"},{"location":"checks/cloudwatch/log-group-customer-key/#secure-example","text":"The following example will pass the AVD-AWS-0017 check. --- Resources : GoodExample : Type : AWS::Logs::LogGroup Properties : KmsKeyId : \"arn:aws:kms:us-west-2:111122223333:key/lambdalogging\" LogGroupName : \"aws/lambda/goodExample\" RetentionInDays : 30","title":"Secure Example"},{"location":"checks/cloudwatch/log-group-customer-key/#related-links","text":"https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/encrypt-log-data-kms.html","title":"Related Links"},{"location":"checks/codebuild/enable-encryption/","text":"Explanation All artifacts produced by your CodeBuild project pipeline should always be encrypted Possible Impact CodeBuild project artifacts are unencrypted Suggested Resolution Enable encryption for CodeBuild project artifacts Insecure Example The following example will fail the AVD-AWS-0018 check. --- Resources : GoodProject : Type : AWS::CodeBuild::Project Properties : Artifacts : ArtifactIdentifier : \"String\" EncryptionDisabled : true Location : \"String\" Name : \"String\" NamespaceType : \"String\" OverrideArtifactName : false Packaging : \"String\" Path : \"String\" Type : \"String\" SecondaryArtifacts : - ArtifactIdentifier : \"String\" EncryptionDisabled : false Location : \"String\" Name : \"String\" NamespaceType : \"String\" OverrideArtifactName : false Packaging : \"String\" Path : \"String\" Type : \"String\" Secure Example The following example will pass the AVD-AWS-0018 check. --- Resources : GoodProject : Type : AWS::CodeBuild::Project Properties : Artifacts : ArtifactIdentifier : \"String\" EncryptionDisabled : false Location : \"String\" Name : \"String\" NamespaceType : \"String\" OverrideArtifactName : false Packaging : \"String\" Path : \"String\" Type : \"String\" SecondaryArtifacts : - ArtifactIdentifier : \"String\" EncryptionDisabled : false Location : \"String\" Name : \"String\" NamespaceType : \"String\" OverrideArtifactName : false Packaging : \"String\" Path : \"String\" Type : \"String\" Related Links https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-codebuild-project-artifacts.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codebuild-project.html","title":"enable-encryption"},{"location":"checks/codebuild/enable-encryption/#explanation","text":"All artifacts produced by your CodeBuild project pipeline should always be encrypted","title":"Explanation"},{"location":"checks/codebuild/enable-encryption/#possible-impact","text":"CodeBuild project artifacts are unencrypted","title":"Possible Impact"},{"location":"checks/codebuild/enable-encryption/#suggested-resolution","text":"Enable encryption for CodeBuild project artifacts","title":"Suggested Resolution"},{"location":"checks/codebuild/enable-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0018 check. --- Resources : GoodProject : Type : AWS::CodeBuild::Project Properties : Artifacts : ArtifactIdentifier : \"String\" EncryptionDisabled : true Location : \"String\" Name : \"String\" NamespaceType : \"String\" OverrideArtifactName : false Packaging : \"String\" Path : \"String\" Type : \"String\" SecondaryArtifacts : - ArtifactIdentifier : \"String\" EncryptionDisabled : false Location : \"String\" Name : \"String\" NamespaceType : \"String\" OverrideArtifactName : false Packaging : \"String\" Path : \"String\" Type : \"String\"","title":"Insecure Example"},{"location":"checks/codebuild/enable-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0018 check. --- Resources : GoodProject : Type : AWS::CodeBuild::Project Properties : Artifacts : ArtifactIdentifier : \"String\" EncryptionDisabled : false Location : \"String\" Name : \"String\" NamespaceType : \"String\" OverrideArtifactName : false Packaging : \"String\" Path : \"String\" Type : \"String\" SecondaryArtifacts : - ArtifactIdentifier : \"String\" EncryptionDisabled : false Location : \"String\" Name : \"String\" NamespaceType : \"String\" OverrideArtifactName : false Packaging : \"String\" Path : \"String\" Type : \"String\"","title":"Secure Example"},{"location":"checks/codebuild/enable-encryption/#related-links","text":"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-codebuild-project-artifacts.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-codebuild-project.html","title":"Related Links"},{"location":"checks/config/aggregate-all-regions/","text":"Explanation The configuration aggregator should be configured with all_regions for the source. This will help limit the risk of any unmonitored configuration in regions that are thought to be unused. Possible Impact Sources that aren't covered by the aggregator are not include in the configuration Suggested Resolution Set the aggregator to cover all regions Insecure Example The following example will fail the AVD-AWS-0019 check. --- Resources : BadExample : Type : AWS::Config::ConfigurationAggregator Properties : ConfigurationAggregatorName : \"BadAccountLevelAggregation\" Secure Example The following example will pass the AVD-AWS-0019 check. --- Resources : GoodExample : Type : AWS::Config::ConfigurationAggregator Properties : AccountAggregationSources : - AllAwsRegions : true ConfigurationAggregatorName : \"GoodAccountLevelAggregation\" Related Links https://docs.aws.amazon.com/config/latest/developerguide/aggregate-data.html","title":"aggregate-all-regions"},{"location":"checks/config/aggregate-all-regions/#explanation","text":"The configuration aggregator should be configured with all_regions for the source. This will help limit the risk of any unmonitored configuration in regions that are thought to be unused.","title":"Explanation"},{"location":"checks/config/aggregate-all-regions/#possible-impact","text":"Sources that aren't covered by the aggregator are not include in the configuration","title":"Possible Impact"},{"location":"checks/config/aggregate-all-regions/#suggested-resolution","text":"Set the aggregator to cover all regions","title":"Suggested Resolution"},{"location":"checks/config/aggregate-all-regions/#insecure-example","text":"The following example will fail the AVD-AWS-0019 check. --- Resources : BadExample : Type : AWS::Config::ConfigurationAggregator Properties : ConfigurationAggregatorName : \"BadAccountLevelAggregation\"","title":"Insecure Example"},{"location":"checks/config/aggregate-all-regions/#secure-example","text":"The following example will pass the AVD-AWS-0019 check. --- Resources : GoodExample : Type : AWS::Config::ConfigurationAggregator Properties : AccountAggregationSources : - AllAwsRegions : true ConfigurationAggregatorName : \"GoodAccountLevelAggregation\"","title":"Secure Example"},{"location":"checks/config/aggregate-all-regions/#related-links","text":"https://docs.aws.amazon.com/config/latest/developerguide/aggregate-data.html","title":"Related Links"},{"location":"checks/documentdb/enable-log-export/","text":"Explanation Document DB does not have auditing by default. To ensure that you are able to accurately audit the usage of your DocumentDB cluster you should enable export logs. Possible Impact Limited visibility of audit trail for changes to the DocumentDB Suggested Resolution Enable export logs Insecure Example The following example will fail the AVD-AWS-0020 check. --- Resources : BadExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : sample-cluster DBClusterParameterGroupName : default.docdb3.6 BadInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : us-east-1c DBClusterIdentifier : sample-cluster DBInstanceClass : db.r5.large DBInstanceIdentifier : sample-cluster-instance-0 PreferredMaintenanceWindow : 'sat:06:54-sat:07:24' Secure Example The following example will pass the AVD-AWS-0020 check. --- Resources : GoodExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : \"sample-cluster\" DBClusterParameterGroupName : \"default.docdb3.6\" KmsKeyId : \"your-kms-key-id\" EnableCloudwatchLogsExports : - audit - profiler InstanceInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : \"us-east-1c\" DBClusterIdentifier : \"sample-cluster\" DBInstanceClass : \"db.r5.large\" DBInstanceIdentifier : \"sample-cluster-instance-0\" PreferredMaintenanceWindow : \"sat:06:54-sat:07:24\" Related Links https://docs.aws.amazon.com/documentdb/latest/developerguide/event-auditing.html","title":"enable-log-export"},{"location":"checks/documentdb/enable-log-export/#explanation","text":"Document DB does not have auditing by default. To ensure that you are able to accurately audit the usage of your DocumentDB cluster you should enable export logs.","title":"Explanation"},{"location":"checks/documentdb/enable-log-export/#possible-impact","text":"Limited visibility of audit trail for changes to the DocumentDB","title":"Possible Impact"},{"location":"checks/documentdb/enable-log-export/#suggested-resolution","text":"Enable export logs","title":"Suggested Resolution"},{"location":"checks/documentdb/enable-log-export/#insecure-example","text":"The following example will fail the AVD-AWS-0020 check. --- Resources : BadExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : sample-cluster DBClusterParameterGroupName : default.docdb3.6 BadInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : us-east-1c DBClusterIdentifier : sample-cluster DBInstanceClass : db.r5.large DBInstanceIdentifier : sample-cluster-instance-0 PreferredMaintenanceWindow : 'sat:06:54-sat:07:24'","title":"Insecure Example"},{"location":"checks/documentdb/enable-log-export/#secure-example","text":"The following example will pass the AVD-AWS-0020 check. --- Resources : GoodExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : \"sample-cluster\" DBClusterParameterGroupName : \"default.docdb3.6\" KmsKeyId : \"your-kms-key-id\" EnableCloudwatchLogsExports : - audit - profiler InstanceInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : \"us-east-1c\" DBClusterIdentifier : \"sample-cluster\" DBInstanceClass : \"db.r5.large\" DBInstanceIdentifier : \"sample-cluster-instance-0\" PreferredMaintenanceWindow : \"sat:06:54-sat:07:24\"","title":"Secure Example"},{"location":"checks/documentdb/enable-log-export/#related-links","text":"https://docs.aws.amazon.com/documentdb/latest/developerguide/event-auditing.html","title":"Related Links"},{"location":"checks/documentdb/enable-storage-encryption/","text":"Explanation Encryption of the underlying storage used by DocumentDB ensures that if their is compromise of the disks, the data is still protected. Possible Impact Unencrypted sensitive data is vulnerable to compromise. Suggested Resolution Enable storage encryption Insecure Example The following example will fail the AVD-AWS-0021 check. --- Resources : BadExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : sample-cluster DBClusterParameterGroupName : default.docdb3.6 BadInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : us-east-1c DBClusterIdentifier : sample-cluster DBInstanceClass : db.r5.large DBInstanceIdentifier : sample-cluster-instance-0 PreferredMaintenanceWindow : 'sat:06:54-sat:07:24' Secure Example The following example will pass the AVD-AWS-0021 check. --- Resources : GoodExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : \"sample-cluster\" DBClusterParameterGroupName : \"default.docdb3.6\" KmsKeyId : \"your-kms-key-id\" StorageEncrypted : true EnableCloudwatchLogsExports : - audit - profiler InstanceInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : \"us-east-1c\" DBClusterIdentifier : \"sample-cluster\" DBInstanceClass : \"db.r5.large\" DBInstanceIdentifier : \"sample-cluster-instance-0\" PreferredMaintenanceWindow : \"sat:06:54-sat:07:24\" Related Links https://docs.aws.amazon.com/documentdb/latest/developerguide/encryption-at-rest.html","title":"enable-storage-encryption"},{"location":"checks/documentdb/enable-storage-encryption/#explanation","text":"Encryption of the underlying storage used by DocumentDB ensures that if their is compromise of the disks, the data is still protected.","title":"Explanation"},{"location":"checks/documentdb/enable-storage-encryption/#possible-impact","text":"Unencrypted sensitive data is vulnerable to compromise.","title":"Possible Impact"},{"location":"checks/documentdb/enable-storage-encryption/#suggested-resolution","text":"Enable storage encryption","title":"Suggested Resolution"},{"location":"checks/documentdb/enable-storage-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0021 check. --- Resources : BadExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : sample-cluster DBClusterParameterGroupName : default.docdb3.6 BadInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : us-east-1c DBClusterIdentifier : sample-cluster DBInstanceClass : db.r5.large DBInstanceIdentifier : sample-cluster-instance-0 PreferredMaintenanceWindow : 'sat:06:54-sat:07:24'","title":"Insecure Example"},{"location":"checks/documentdb/enable-storage-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0021 check. --- Resources : GoodExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : \"sample-cluster\" DBClusterParameterGroupName : \"default.docdb3.6\" KmsKeyId : \"your-kms-key-id\" StorageEncrypted : true EnableCloudwatchLogsExports : - audit - profiler InstanceInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : \"us-east-1c\" DBClusterIdentifier : \"sample-cluster\" DBInstanceClass : \"db.r5.large\" DBInstanceIdentifier : \"sample-cluster-instance-0\" PreferredMaintenanceWindow : \"sat:06:54-sat:07:24\"","title":"Secure Example"},{"location":"checks/documentdb/enable-storage-encryption/#related-links","text":"https://docs.aws.amazon.com/documentdb/latest/developerguide/encryption-at-rest.html","title":"Related Links"},{"location":"checks/documentdb/encryption-customer-key/","text":"Explanation Encryption using AWS keys provides protection for your DocumentDB underlying storage. To increase control of the encryption and manage factors like rotation use customer managed keys. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Enable encryption using customer managed keys Insecure Example The following example will fail the AVD-AWS-0022 check. --- Resources : BadExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : sample-cluster DBClusterParameterGroupName : default.docdb3.6 BadInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : us-east-1c DBClusterIdentifier : sample-cluster DBInstanceClass : db.r5.large DBInstanceIdentifier : sample-cluster-instance-0 PreferredMaintenanceWindow : 'sat:06:54-sat:07:24' Secure Example The following example will pass the AVD-AWS-0022 check. --- Resources : GoodExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : \"sample-cluster\" DBClusterParameterGroupName : \"default.docdb3.6\" KmsKeyId : \"your-kms-key-id\" EnableCloudwatchLogsExports : - audit - profiler InstanceInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : \"us-east-1c\" DBClusterIdentifier : \"sample-cluster\" DBInstanceClass : \"db.r5.large\" DBInstanceIdentifier : \"sample-cluster-instance-0\" PreferredMaintenanceWindow : \"sat:06:54-sat:07:24\" Related Links https://docs.aws.amazon.com/documentdb/latest/developerguide/security.encryption.ssl.public-key.html","title":"encryption-customer-key"},{"location":"checks/documentdb/encryption-customer-key/#explanation","text":"Encryption using AWS keys provides protection for your DocumentDB underlying storage. To increase control of the encryption and manage factors like rotation use customer managed keys.","title":"Explanation"},{"location":"checks/documentdb/encryption-customer-key/#possible-impact","text":"Using AWS managed keys does not allow for fine grained control","title":"Possible Impact"},{"location":"checks/documentdb/encryption-customer-key/#suggested-resolution","text":"Enable encryption using customer managed keys","title":"Suggested Resolution"},{"location":"checks/documentdb/encryption-customer-key/#insecure-example","text":"The following example will fail the AVD-AWS-0022 check. --- Resources : BadExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : sample-cluster DBClusterParameterGroupName : default.docdb3.6 BadInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : us-east-1c DBClusterIdentifier : sample-cluster DBInstanceClass : db.r5.large DBInstanceIdentifier : sample-cluster-instance-0 PreferredMaintenanceWindow : 'sat:06:54-sat:07:24'","title":"Insecure Example"},{"location":"checks/documentdb/encryption-customer-key/#secure-example","text":"The following example will pass the AVD-AWS-0022 check. --- Resources : GoodExample : Type : \"AWS::DocDB::DBCluster\" Properties : BackupRetentionPeriod : 8 DBClusterIdentifier : \"sample-cluster\" DBClusterParameterGroupName : \"default.docdb3.6\" KmsKeyId : \"your-kms-key-id\" EnableCloudwatchLogsExports : - audit - profiler InstanceInstanceExample : Type : \"AWS::DocDB::DBInstance\" Properties : AutoMinorVersionUpgrade : true AvailabilityZone : \"us-east-1c\" DBClusterIdentifier : \"sample-cluster\" DBInstanceClass : \"db.r5.large\" DBInstanceIdentifier : \"sample-cluster-instance-0\" PreferredMaintenanceWindow : \"sat:06:54-sat:07:24\"","title":"Secure Example"},{"location":"checks/documentdb/encryption-customer-key/#related-links","text":"https://docs.aws.amazon.com/documentdb/latest/developerguide/security.encryption.ssl.public-key.html","title":"Related Links"},{"location":"checks/dynamodb/enable-at-rest-encryption/","text":"Explanation Amazon DynamoDB Accelerator (DAX) encryption at rest provides an additional layer of data protection by helping secure your data from unauthorized access to the underlying storage. Possible Impact Data can be freely read if compromised Suggested Resolution Enable encryption at rest for DAX Cluster Insecure Example The following example will fail the AVD-AWS-0023 check. --- Resources : daxCluster : Type : AWS::DAX::Cluster Properties : ClusterName : \"MyDAXCluster\" NodeType : \"dax.r3.large\" ReplicationFactor : 1 IAMRoleARN : \"arn:aws:iam::111122223333:role/DaxAccess\" Description : \"DAX cluster created with CloudFormation\" SubnetGroupName : !Ref subnetGroupClu Secure Example The following example will pass the AVD-AWS-0023 check. --- Resources : daxCluster : Type : AWS::DAX::Cluster Properties : ClusterName : \"MyDAXCluster\" NodeType : \"dax.r3.large\" ReplicationFactor : 1 IAMRoleARN : \"arn:aws:iam::111122223333:role/DaxAccess\" Description : \"DAX cluster created with CloudFormation\" SSESpecification : SSEEnabled : true Related Links https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAXEncryptionAtRest.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dax-cluster.html","title":"enable-at-rest-encryption"},{"location":"checks/dynamodb/enable-at-rest-encryption/#explanation","text":"Amazon DynamoDB Accelerator (DAX) encryption at rest provides an additional layer of data protection by helping secure your data from unauthorized access to the underlying storage.","title":"Explanation"},{"location":"checks/dynamodb/enable-at-rest-encryption/#possible-impact","text":"Data can be freely read if compromised","title":"Possible Impact"},{"location":"checks/dynamodb/enable-at-rest-encryption/#suggested-resolution","text":"Enable encryption at rest for DAX Cluster","title":"Suggested Resolution"},{"location":"checks/dynamodb/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0023 check. --- Resources : daxCluster : Type : AWS::DAX::Cluster Properties : ClusterName : \"MyDAXCluster\" NodeType : \"dax.r3.large\" ReplicationFactor : 1 IAMRoleARN : \"arn:aws:iam::111122223333:role/DaxAccess\" Description : \"DAX cluster created with CloudFormation\" SubnetGroupName : !Ref subnetGroupClu","title":"Insecure Example"},{"location":"checks/dynamodb/enable-at-rest-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0023 check. --- Resources : daxCluster : Type : AWS::DAX::Cluster Properties : ClusterName : \"MyDAXCluster\" NodeType : \"dax.r3.large\" ReplicationFactor : 1 IAMRoleARN : \"arn:aws:iam::111122223333:role/DaxAccess\" Description : \"DAX cluster created with CloudFormation\" SSESpecification : SSEEnabled : true","title":"Secure Example"},{"location":"checks/dynamodb/enable-at-rest-encryption/#related-links","text":"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DAXEncryptionAtRest.html https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-dax-cluster.html","title":"Related Links"},{"location":"checks/ebs/enable-volume-encryption/","text":"Explanation By enabling encryption on EBS volumes you protect the volume, the disk I/O and any derived snapshots from compromise if intercepted. Possible Impact Unencrypted sensitive data is vulnerable to compromise. Suggested Resolution Enable encryption of EBS volumes Insecure Example The following example will fail the AVD-AWS-0026 check. --- Resources : BadExample : Type : AWS::EC2::Volume Properties : Size : 100 AvailabilityZone : !GetAtt Ec2Instance.AvailabilityZone DeletionPolicy : Snapshot Secure Example The following example will pass the AVD-AWS-0026 check. --- Resources : GoodExample : Type : AWS::EC2::Volume Properties : Size : 100 Encrypted : true KmsKeyId : \"alias/volumeEncrypt\" DeletionPolicy : Snapshot Related Links https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","title":"enable-volume-encryption"},{"location":"checks/ebs/enable-volume-encryption/#explanation","text":"By enabling encryption on EBS volumes you protect the volume, the disk I/O and any derived snapshots from compromise if intercepted.","title":"Explanation"},{"location":"checks/ebs/enable-volume-encryption/#possible-impact","text":"Unencrypted sensitive data is vulnerable to compromise.","title":"Possible Impact"},{"location":"checks/ebs/enable-volume-encryption/#suggested-resolution","text":"Enable encryption of EBS volumes","title":"Suggested Resolution"},{"location":"checks/ebs/enable-volume-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0026 check. --- Resources : BadExample : Type : AWS::EC2::Volume Properties : Size : 100 AvailabilityZone : !GetAtt Ec2Instance.AvailabilityZone DeletionPolicy : Snapshot","title":"Insecure Example"},{"location":"checks/ebs/enable-volume-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0026 check. --- Resources : GoodExample : Type : AWS::EC2::Volume Properties : Size : 100 Encrypted : true KmsKeyId : \"alias/volumeEncrypt\" DeletionPolicy : Snapshot","title":"Secure Example"},{"location":"checks/ebs/enable-volume-encryption/#related-links","text":"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","title":"Related Links"},{"location":"checks/ebs/encryption-customer-key/","text":"Explanation Encryption using AWS keys provides protection for your EBS volume. To increase control of the encryption and manage factors like rotation use customer managed keys. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Enable encryption using customer managed keys Insecure Example The following example will fail the AVD-AWS-0027 check. --- Resources : BadExample : Type : AWS::EC2::Volume Properties : Size : 100 AvailabilityZone : !GetAtt Ec2Instance.AvailabilityZone DeletionPolicy : Snapshot Secure Example The following example will pass the AVD-AWS-0027 check. --- Resources : GoodExample : Type : AWS::EC2::Volume Properties : Size : 100 Encrypted : true KmsKeyId : \"alias/volumeEncrypt\" DeletionPolicy : Snapshot Related Links https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","title":"encryption-customer-key"},{"location":"checks/ebs/encryption-customer-key/#explanation","text":"Encryption using AWS keys provides protection for your EBS volume. To increase control of the encryption and manage factors like rotation use customer managed keys.","title":"Explanation"},{"location":"checks/ebs/encryption-customer-key/#possible-impact","text":"Using AWS managed keys does not allow for fine grained control","title":"Possible Impact"},{"location":"checks/ebs/encryption-customer-key/#suggested-resolution","text":"Enable encryption using customer managed keys","title":"Suggested Resolution"},{"location":"checks/ebs/encryption-customer-key/#insecure-example","text":"The following example will fail the AVD-AWS-0027 check. --- Resources : BadExample : Type : AWS::EC2::Volume Properties : Size : 100 AvailabilityZone : !GetAtt Ec2Instance.AvailabilityZone DeletionPolicy : Snapshot","title":"Insecure Example"},{"location":"checks/ebs/encryption-customer-key/#secure-example","text":"The following example will pass the AVD-AWS-0027 check. --- Resources : GoodExample : Type : AWS::EC2::Volume Properties : Size : 100 Encrypted : true KmsKeyId : \"alias/volumeEncrypt\" DeletionPolicy : Snapshot","title":"Secure Example"},{"location":"checks/ebs/encryption-customer-key/#related-links","text":"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSEncryption.html","title":"Related Links"},{"location":"checks/ec2/no-secrets-in-user-data/","text":"Explanation EC2 instance data is used to pass start up information into the EC2 instance. This userdata must not contain access key credentials. Instead use an IAM Instance Profile assigned to the instance to grant access to other AWS Services. Possible Impact User data is visible through the AWS Management console Suggested Resolution Remove sensitive data from the EC2 instance user-data Insecure Example The following example will fail the AVD-AWS-0029 check. --- Resources : BadExample : Type : AWS::EC2::Instance Properties : ImageId : \"ami-79fd7eee\" KeyName : \"testkey\" UserData : export DATABASE_PASSWORD=password1234 BlockDeviceMappings : - DeviceName : \"/dev/sdm\" Ebs : VolumeType : \"io1\" Iops : \"200\" DeleteOnTermination : \"false\" VolumeSize : \"20\" - DeviceName : \"/dev/sdk\" Secure Example The following example will pass the AVD-AWS-0029 check. --- Resources : GoodExample : Type : AWS::EC2::Instance Properties : ImageId : \"ami-79fd7eee\" KeyName : \"testkey\" UserData : export SSM_PATH=/database/creds BlockDeviceMappings : - DeviceName : \"/dev/sdm\" Ebs : VolumeType : \"io1\" Iops : \"200\" DeleteOnTermination : \"false\" VolumeSize : \"20\" - DeviceName : \"/dev/sdk\" Related Links https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-add-user-data.html","title":"no-secrets-in-user-data"},{"location":"checks/ec2/no-secrets-in-user-data/#explanation","text":"EC2 instance data is used to pass start up information into the EC2 instance. This userdata must not contain access key credentials. Instead use an IAM Instance Profile assigned to the instance to grant access to other AWS Services.","title":"Explanation"},{"location":"checks/ec2/no-secrets-in-user-data/#possible-impact","text":"User data is visible through the AWS Management console","title":"Possible Impact"},{"location":"checks/ec2/no-secrets-in-user-data/#suggested-resolution","text":"Remove sensitive data from the EC2 instance user-data","title":"Suggested Resolution"},{"location":"checks/ec2/no-secrets-in-user-data/#insecure-example","text":"The following example will fail the AVD-AWS-0029 check. --- Resources : BadExample : Type : AWS::EC2::Instance Properties : ImageId : \"ami-79fd7eee\" KeyName : \"testkey\" UserData : export DATABASE_PASSWORD=password1234 BlockDeviceMappings : - DeviceName : \"/dev/sdm\" Ebs : VolumeType : \"io1\" Iops : \"200\" DeleteOnTermination : \"false\" VolumeSize : \"20\" - DeviceName : \"/dev/sdk\"","title":"Insecure Example"},{"location":"checks/ec2/no-secrets-in-user-data/#secure-example","text":"The following example will pass the AVD-AWS-0029 check. --- Resources : GoodExample : Type : AWS::EC2::Instance Properties : ImageId : \"ami-79fd7eee\" KeyName : \"testkey\" UserData : export SSM_PATH=/database/creds BlockDeviceMappings : - DeviceName : \"/dev/sdm\" Ebs : VolumeType : \"io1\" Iops : \"200\" DeleteOnTermination : \"false\" VolumeSize : \"20\" - DeviceName : \"/dev/sdk\"","title":"Secure Example"},{"location":"checks/ec2/no-secrets-in-user-data/#related-links","text":"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-add-user-data.html","title":"Related Links"},{"location":"checks/ecr/enable-image-scans/","text":"Explanation Repository image scans should be enabled to ensure vulnerable software can be discovered and remediated as soon as possible. Possible Impact The ability to scan images is not being used and vulnerabilities will not be highlighted Suggested Resolution Enable ECR image scanning Insecure Example The following example will fail the AVD-AWS-0030 check. --- Resources : BadExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageScanningConfiguration : ScanOnPush : false Secure Example The following example will pass the AVD-AWS-0030 check. --- Resources : GoodExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageTagImmutability : IMMUTABLE ImageScanningConfiguration : ScanOnPush : true EncryptionConfiguration : EncryptionType : KMS KmsKey : \"alias/ecr-key\" Related Links https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html","title":"enable-image-scans"},{"location":"checks/ecr/enable-image-scans/#explanation","text":"Repository image scans should be enabled to ensure vulnerable software can be discovered and remediated as soon as possible.","title":"Explanation"},{"location":"checks/ecr/enable-image-scans/#possible-impact","text":"The ability to scan images is not being used and vulnerabilities will not be highlighted","title":"Possible Impact"},{"location":"checks/ecr/enable-image-scans/#suggested-resolution","text":"Enable ECR image scanning","title":"Suggested Resolution"},{"location":"checks/ecr/enable-image-scans/#insecure-example","text":"The following example will fail the AVD-AWS-0030 check. --- Resources : BadExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageScanningConfiguration : ScanOnPush : false","title":"Insecure Example"},{"location":"checks/ecr/enable-image-scans/#secure-example","text":"The following example will pass the AVD-AWS-0030 check. --- Resources : GoodExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageTagImmutability : IMMUTABLE ImageScanningConfiguration : ScanOnPush : true EncryptionConfiguration : EncryptionType : KMS KmsKey : \"alias/ecr-key\"","title":"Secure Example"},{"location":"checks/ecr/enable-image-scans/#related-links","text":"https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html","title":"Related Links"},{"location":"checks/ecr/enforce-immutable-repository/","text":"Explanation ECR images should be set to IMMUTABLE to prevent code injection through image mutation. This can be done by setting image_tab_mutability to IMMUTABLE Possible Impact Image tags could be overwritten with compromised images Suggested Resolution Only use immutable images in ECR Insecure Example The following example will fail the AVD-AWS-0031 check. --- Resources : BadExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageScanningConfiguration : ScanOnPush : false Secure Example The following example will pass the AVD-AWS-0031 check. --- Resources : GoodExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageTagMutability : IMMUTABLE ImageScanningConfiguration : ScanOnPush : false EncryptionConfiguration : EncryptionType : KMS KmsKey : \"alias/ecr-key\" Related Links https://sysdig.com/blog/toctou-tag-mutability/","title":"enforce-immutable-repository"},{"location":"checks/ecr/enforce-immutable-repository/#explanation","text":"ECR images should be set to IMMUTABLE to prevent code injection through image mutation. This can be done by setting image_tab_mutability to IMMUTABLE","title":"Explanation"},{"location":"checks/ecr/enforce-immutable-repository/#possible-impact","text":"Image tags could be overwritten with compromised images","title":"Possible Impact"},{"location":"checks/ecr/enforce-immutable-repository/#suggested-resolution","text":"Only use immutable images in ECR","title":"Suggested Resolution"},{"location":"checks/ecr/enforce-immutable-repository/#insecure-example","text":"The following example will fail the AVD-AWS-0031 check. --- Resources : BadExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageScanningConfiguration : ScanOnPush : false","title":"Insecure Example"},{"location":"checks/ecr/enforce-immutable-repository/#secure-example","text":"The following example will pass the AVD-AWS-0031 check. --- Resources : GoodExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageTagMutability : IMMUTABLE ImageScanningConfiguration : ScanOnPush : false EncryptionConfiguration : EncryptionType : KMS KmsKey : \"alias/ecr-key\"","title":"Secure Example"},{"location":"checks/ecr/enforce-immutable-repository/#related-links","text":"https://sysdig.com/blog/toctou-tag-mutability/","title":"Related Links"},{"location":"checks/ecr/no-public-access/","text":"Explanation Allowing public access to the ECR repository risks leaking sensitive of abusable information Possible Impact Risk of potential data leakage of sensitive artifacts Suggested Resolution Do not allow public access in the policy Insecure Example The following example will fail the AVD-AWS-0032 check. --- Resources : BadExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageScanningConfiguration : ScanOnPush : false RepositoryPolicyText : Version : \"2012-10-17\" Statement : - Sid : AllowPushPull Effect : Allow Principal : AWS : - \"*\" Action : - \"ecr:GetDownloadUrlForLayer\" - \"ecr:BatchGetImage\" - \"ecr:BatchCheckLayerAvailability\" - \"ecr:PutImage\" - \"ecr:InitiateLayerUpload\" - \"ecr:UploadLayerPart\" - \"ecr:CompleteLayerUpload\" Secure Example The following example will pass the AVD-AWS-0032 check. --- Resources : GoodExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageTagImmutability : IMMUTABLE ImageScanningConfiguration : ScanOnPush : false EncryptionConfiguration : EncryptionType : KMS KmsKey : \"alias/ecr-key\" RepositoryPolicyText : Version : \"2012-10-17\" Statement : - Sid : AllowPushPull Effect : Allow Principal : AWS : - \"arn:aws:iam::123456789012:user/Alice\" Action : - \"ecr:GetDownloadUrlForLayer\" - \"ecr:BatchGetImage\" - \"ecr:BatchCheckLayerAvailability\" - \"ecr:PutImage\" - \"ecr:InitiateLayerUpload\" - \"ecr:UploadLayerPart\" - \"ecr:CompleteLayerUpload\" Related Links https://docs.aws.amazon.com/AmazonECR/latest/public/public-repository-policies.html","title":"no-public-access"},{"location":"checks/ecr/no-public-access/#explanation","text":"Allowing public access to the ECR repository risks leaking sensitive of abusable information","title":"Explanation"},{"location":"checks/ecr/no-public-access/#possible-impact","text":"Risk of potential data leakage of sensitive artifacts","title":"Possible Impact"},{"location":"checks/ecr/no-public-access/#suggested-resolution","text":"Do not allow public access in the policy","title":"Suggested Resolution"},{"location":"checks/ecr/no-public-access/#insecure-example","text":"The following example will fail the AVD-AWS-0032 check. --- Resources : BadExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageScanningConfiguration : ScanOnPush : false RepositoryPolicyText : Version : \"2012-10-17\" Statement : - Sid : AllowPushPull Effect : Allow Principal : AWS : - \"*\" Action : - \"ecr:GetDownloadUrlForLayer\" - \"ecr:BatchGetImage\" - \"ecr:BatchCheckLayerAvailability\" - \"ecr:PutImage\" - \"ecr:InitiateLayerUpload\" - \"ecr:UploadLayerPart\" - \"ecr:CompleteLayerUpload\"","title":"Insecure Example"},{"location":"checks/ecr/no-public-access/#secure-example","text":"The following example will pass the AVD-AWS-0032 check. --- Resources : GoodExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageTagImmutability : IMMUTABLE ImageScanningConfiguration : ScanOnPush : false EncryptionConfiguration : EncryptionType : KMS KmsKey : \"alias/ecr-key\" RepositoryPolicyText : Version : \"2012-10-17\" Statement : - Sid : AllowPushPull Effect : Allow Principal : AWS : - \"arn:aws:iam::123456789012:user/Alice\" Action : - \"ecr:GetDownloadUrlForLayer\" - \"ecr:BatchGetImage\" - \"ecr:BatchCheckLayerAvailability\" - \"ecr:PutImage\" - \"ecr:InitiateLayerUpload\" - \"ecr:UploadLayerPart\" - \"ecr:CompleteLayerUpload\"","title":"Secure Example"},{"location":"checks/ecr/no-public-access/#related-links","text":"https://docs.aws.amazon.com/AmazonECR/latest/public/public-repository-policies.html","title":"Related Links"},{"location":"checks/ecr/repository-customer-key/","text":"Explanation Images in the ECR repository are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key. Possible Impact Using AWS managed keys does not allow for fine grained control Suggested Resolution Use customer managed keys Insecure Example The following example will fail the AVD-AWS-0033 check. --- Resources : BadExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageScanningConfiguration : ScanOnPush : false Secure Example The following example will pass the AVD-AWS-0033 check. --- Resources : GoodExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageTagImmutability : IMMUTABLE ImageScanningConfiguration : ScanOnPush : false EncryptionConfiguration : EncryptionType : KMS KmsKey : \"alias/ecr-key\" Related Links https://docs.aws.amazon.com/AmazonECR/latest/userguide/encryption-at-rest.html","title":"repository-customer-key"},{"location":"checks/ecr/repository-customer-key/#explanation","text":"Images in the ECR repository are encrypted by default using AWS managed encryption keys. To increase control of the encryption and control the management of factors like key rotation, use a Customer Managed Key.","title":"Explanation"},{"location":"checks/ecr/repository-customer-key/#possible-impact","text":"Using AWS managed keys does not allow for fine grained control","title":"Possible Impact"},{"location":"checks/ecr/repository-customer-key/#suggested-resolution","text":"Use customer managed keys","title":"Suggested Resolution"},{"location":"checks/ecr/repository-customer-key/#insecure-example","text":"The following example will fail the AVD-AWS-0033 check. --- Resources : BadExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageScanningConfiguration : ScanOnPush : false","title":"Insecure Example"},{"location":"checks/ecr/repository-customer-key/#secure-example","text":"The following example will pass the AVD-AWS-0033 check. --- Resources : GoodExample : Type : AWS::ECR::Repository Properties : RepositoryName : \"test-repository\" ImageTagImmutability : IMMUTABLE ImageScanningConfiguration : ScanOnPush : false EncryptionConfiguration : EncryptionType : KMS KmsKey : \"alias/ecr-key\"","title":"Secure Example"},{"location":"checks/ecr/repository-customer-key/#related-links","text":"https://docs.aws.amazon.com/AmazonECR/latest/userguide/encryption-at-rest.html","title":"Related Links"},{"location":"checks/ecs/enable-container-insight/","text":"Explanation Cloudwatch Container Insights provide more metrics and logs for container based applications and micro services. Possible Impact Not all metrics and logs may be gathered for containers when Container Insights isn't enabled Suggested Resolution Enable Container Insights Insecure Example The following example will fail the AVD-AWS-0034 check. --- Resources : BadExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster Secure Example The following example will pass the AVD-AWS-0034 check. --- Resources : GoodExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled Related Links https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html","title":"enable-container-insight"},{"location":"checks/ecs/enable-container-insight/#explanation","text":"Cloudwatch Container Insights provide more metrics and logs for container based applications and micro services.","title":"Explanation"},{"location":"checks/ecs/enable-container-insight/#possible-impact","text":"Not all metrics and logs may be gathered for containers when Container Insights isn't enabled","title":"Possible Impact"},{"location":"checks/ecs/enable-container-insight/#suggested-resolution","text":"Enable Container Insights","title":"Suggested Resolution"},{"location":"checks/ecs/enable-container-insight/#insecure-example","text":"The following example will fail the AVD-AWS-0034 check. --- Resources : BadExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster","title":"Insecure Example"},{"location":"checks/ecs/enable-container-insight/#secure-example","text":"The following example will pass the AVD-AWS-0034 check. --- Resources : GoodExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled","title":"Secure Example"},{"location":"checks/ecs/enable-container-insight/#related-links","text":"https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ContainerInsights.html","title":"Related Links"},{"location":"checks/ecs/enable-in-transit-encryption/","text":"Explanation ECS task definitions that have volumes using EFS configuration should explicitly enable in transit encryption to prevent the risk of data loss due to interception. Possible Impact Intercepted traffic to and from EFS may lead to data loss Suggested Resolution Enable in transit encryption when using efs Insecure Example The following example will fail the AVD-AWS-0035 check. --- Resources : BadExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled BadTask : Type : AWS::ECS::TaskDefinition Properties : Family : \"CFSec scan\" Cpu : 512 Memory : 1024 NetworkMode : awsvpc RequiresCompatibilities : - FARGATE - EC2 ContainerDefinitions : - Name : cfsec Image : cfsec/cfsec:latest MountPoints : - SourceVolume : src ContainerPath : /src LogConfiguration : LogDriver : awslogs Options : awslogs-group : \"cfsec-logs\" awslogs-region : !Ref AWS::Region awslogs-stream-prefix : \"cfsec\" Volumes : - Name : jenkins-home EFSVolumeConfiguration : FilesystemId : \"fs1\" TransitEncryption : DISABLED Secure Example The following example will pass the AVD-AWS-0035 check. --- Resources : GoodExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled GoodTask : Type : AWS::ECS::TaskDefinition Properties : Family : \"CFSec scan\" Cpu : 512 Memory : 1024 NetworkMode : awsvpc RequiresCompatibilities : - FARGATE - EC2 ContainerDefinitions : - Name : cfsec Image : cfsec/cfsec:latest MountPoints : - SourceVolume : src ContainerPath : /src LogConfiguration : LogDriver : awslogs Options : awslogs-group : \"cfsec-logs\" awslogs-region : !Ref AWS::Region awslogs-stream-prefix : \"cfsec\" Volumes : - Name : jenkins-home EFSVolumeConfiguration : FilesystemId : \"fs1\" TransitEncryption : ENABLED Related Links https://docs.aws.amazon.com/AmazonECS/latest/userguide/efs-volumes.html https://docs.aws.amazon.com/efs/latest/ug/encryption-in-transit.html","title":"enable-in-transit-encryption"},{"location":"checks/ecs/enable-in-transit-encryption/#explanation","text":"ECS task definitions that have volumes using EFS configuration should explicitly enable in transit encryption to prevent the risk of data loss due to interception.","title":"Explanation"},{"location":"checks/ecs/enable-in-transit-encryption/#possible-impact","text":"Intercepted traffic to and from EFS may lead to data loss","title":"Possible Impact"},{"location":"checks/ecs/enable-in-transit-encryption/#suggested-resolution","text":"Enable in transit encryption when using efs","title":"Suggested Resolution"},{"location":"checks/ecs/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0035 check. --- Resources : BadExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled BadTask : Type : AWS::ECS::TaskDefinition Properties : Family : \"CFSec scan\" Cpu : 512 Memory : 1024 NetworkMode : awsvpc RequiresCompatibilities : - FARGATE - EC2 ContainerDefinitions : - Name : cfsec Image : cfsec/cfsec:latest MountPoints : - SourceVolume : src ContainerPath : /src LogConfiguration : LogDriver : awslogs Options : awslogs-group : \"cfsec-logs\" awslogs-region : !Ref AWS::Region awslogs-stream-prefix : \"cfsec\" Volumes : - Name : jenkins-home EFSVolumeConfiguration : FilesystemId : \"fs1\" TransitEncryption : DISABLED","title":"Insecure Example"},{"location":"checks/ecs/enable-in-transit-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0035 check. --- Resources : GoodExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled GoodTask : Type : AWS::ECS::TaskDefinition Properties : Family : \"CFSec scan\" Cpu : 512 Memory : 1024 NetworkMode : awsvpc RequiresCompatibilities : - FARGATE - EC2 ContainerDefinitions : - Name : cfsec Image : cfsec/cfsec:latest MountPoints : - SourceVolume : src ContainerPath : /src LogConfiguration : LogDriver : awslogs Options : awslogs-group : \"cfsec-logs\" awslogs-region : !Ref AWS::Region awslogs-stream-prefix : \"cfsec\" Volumes : - Name : jenkins-home EFSVolumeConfiguration : FilesystemId : \"fs1\" TransitEncryption : ENABLED","title":"Secure Example"},{"location":"checks/ecs/enable-in-transit-encryption/#related-links","text":"https://docs.aws.amazon.com/AmazonECS/latest/userguide/efs-volumes.html https://docs.aws.amazon.com/efs/latest/ug/encryption-in-transit.html","title":"Related Links"},{"location":"checks/ecs/no-plaintext-secrets/","text":"Explanation You should not make secrets available to a user in plaintext in any scenario. Secrets can instead be pulled from a secure secret storage system by the service requiring them. Possible Impact Sensitive data could be exposed in the AWS Management Console Suggested Resolution Use secrets for the task definition Insecure Example The following example will fail the AVD-AWS-0036 check. --- Resources : BadExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled BadTask : Type : AWS::ECS::TaskDefinition Properties : Family : \"CFSec scan\" Cpu : 512 Memory : 1024 NetworkMode : awsvpc RequiresCompatibilities : - FARGATE - EC2 ContainerDefinitions : - Name : cfsec Image : cfsec/cfsec:latest Environment : - Name : AWS_ACCESS_KEY_ID Value : AIPA8YOHGIS58IBFDU3E MountPoints : - SourceVolume : src ContainerPath : /src LogConfiguration : LogDriver : awslogs Options : awslogs-group : \"cfsec-logs\" awslogs-region : !Ref AWS::Region awslogs-stream-prefix : \"cfsec\" Volumes : - Name : jenkins-home EFSVolumeConfiguration : FilesystemId : \"fs1\" TransitEncryption : DISABLED Secure Example The following example will pass the AVD-AWS-0036 check. --- Resources : GoodExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled GoodTask : Type : AWS::ECS::TaskDefinition Properties : Family : \"CFSec scan\" Cpu : 512 Memory : 1024 NetworkMode : awsvpc RequiresCompatibilities : - FARGATE - EC2 ContainerDefinitions : - Name : cfsec Image : cfsec/cfsec:latest MountPoints : - SourceVolume : src ContainerPath : /src LogConfiguration : LogDriver : awslogs Options : awslogs-group : \"cfsec-logs\" awslogs-region : !Ref AWS::Region awslogs-stream-prefix : \"cfsec\" Volumes : - Name : jenkins-home EFSVolumeConfiguration : FilesystemId : \"fs1\" TransitEncryption : ENABLED Related Links https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-ps-secretsmanager.html https://www.vaultproject.io/","title":"no-plaintext-secrets"},{"location":"checks/ecs/no-plaintext-secrets/#explanation","text":"You should not make secrets available to a user in plaintext in any scenario. Secrets can instead be pulled from a secure secret storage system by the service requiring them.","title":"Explanation"},{"location":"checks/ecs/no-plaintext-secrets/#possible-impact","text":"Sensitive data could be exposed in the AWS Management Console","title":"Possible Impact"},{"location":"checks/ecs/no-plaintext-secrets/#suggested-resolution","text":"Use secrets for the task definition","title":"Suggested Resolution"},{"location":"checks/ecs/no-plaintext-secrets/#insecure-example","text":"The following example will fail the AVD-AWS-0036 check. --- Resources : BadExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled BadTask : Type : AWS::ECS::TaskDefinition Properties : Family : \"CFSec scan\" Cpu : 512 Memory : 1024 NetworkMode : awsvpc RequiresCompatibilities : - FARGATE - EC2 ContainerDefinitions : - Name : cfsec Image : cfsec/cfsec:latest Environment : - Name : AWS_ACCESS_KEY_ID Value : AIPA8YOHGIS58IBFDU3E MountPoints : - SourceVolume : src ContainerPath : /src LogConfiguration : LogDriver : awslogs Options : awslogs-group : \"cfsec-logs\" awslogs-region : !Ref AWS::Region awslogs-stream-prefix : \"cfsec\" Volumes : - Name : jenkins-home EFSVolumeConfiguration : FilesystemId : \"fs1\" TransitEncryption : DISABLED","title":"Insecure Example"},{"location":"checks/ecs/no-plaintext-secrets/#secure-example","text":"The following example will pass the AVD-AWS-0036 check. --- Resources : GoodExample : Type : 'AWS::ECS::Cluster' Properties : ClusterName : MyCluster ClusterSettings : - Name : containerInsights Value : enabled GoodTask : Type : AWS::ECS::TaskDefinition Properties : Family : \"CFSec scan\" Cpu : 512 Memory : 1024 NetworkMode : awsvpc RequiresCompatibilities : - FARGATE - EC2 ContainerDefinitions : - Name : cfsec Image : cfsec/cfsec:latest MountPoints : - SourceVolume : src ContainerPath : /src LogConfiguration : LogDriver : awslogs Options : awslogs-group : \"cfsec-logs\" awslogs-region : !Ref AWS::Region awslogs-stream-prefix : \"cfsec\" Volumes : - Name : jenkins-home EFSVolumeConfiguration : FilesystemId : \"fs1\" TransitEncryption : ENABLED","title":"Secure Example"},{"location":"checks/ecs/no-plaintext-secrets/#related-links","text":"https://docs.aws.amazon.com/systems-manager/latest/userguide/integration-ps-secretsmanager.html https://www.vaultproject.io/","title":"Related Links"},{"location":"checks/efs/enable-at-rest-encryption/","text":"Explanation If your organization is subject to corporate or regulatory policies that require encryption of data and metadata at rest, we recommend creating a file system that is encrypted at rest, and mounting your file system using encryption of data in transit. Possible Impact Data can be read from the EFS if compromised Suggested Resolution Enable encryption for EFS Insecure Example The following example will fail the AVD-AWS-0037 check. --- Resources : BadExample : Type : AWS::EFS::FileSystem Properties : BackupPolicy : Status : ENABLED LifecyclePolicies : - TransitionToIA : AFTER_60_DAYS PerformanceMode : generalPurpose Encrypted : false ThroughputMode : bursting Secure Example The following example will pass the AVD-AWS-0037 check. --- Resources : GoodExample : Type : AWS::EFS::FileSystem Properties : BackupPolicy : Status : ENABLED LifecyclePolicies : - TransitionToIA : AFTER_60_DAYS PerformanceMode : generalPurpose Encrypted : true ThroughputMode : bursting Related Links https://docs.aws.amazon.com/efs/latest/ug/encryption.html","title":"enable-at-rest-encryption"},{"location":"checks/efs/enable-at-rest-encryption/#explanation","text":"If your organization is subject to corporate or regulatory policies that require encryption of data and metadata at rest, we recommend creating a file system that is encrypted at rest, and mounting your file system using encryption of data in transit.","title":"Explanation"},{"location":"checks/efs/enable-at-rest-encryption/#possible-impact","text":"Data can be read from the EFS if compromised","title":"Possible Impact"},{"location":"checks/efs/enable-at-rest-encryption/#suggested-resolution","text":"Enable encryption for EFS","title":"Suggested Resolution"},{"location":"checks/efs/enable-at-rest-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0037 check. --- Resources : BadExample : Type : AWS::EFS::FileSystem Properties : BackupPolicy : Status : ENABLED LifecyclePolicies : - TransitionToIA : AFTER_60_DAYS PerformanceMode : generalPurpose Encrypted : false ThroughputMode : bursting","title":"Insecure Example"},{"location":"checks/efs/enable-at-rest-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0037 check. --- Resources : GoodExample : Type : AWS::EFS::FileSystem Properties : BackupPolicy : Status : ENABLED LifecyclePolicies : - TransitionToIA : AFTER_60_DAYS PerformanceMode : generalPurpose Encrypted : true ThroughputMode : bursting","title":"Secure Example"},{"location":"checks/efs/enable-at-rest-encryption/#related-links","text":"https://docs.aws.amazon.com/efs/latest/ug/encryption.html","title":"Related Links"},{"location":"checks/eks/encrypt-secrets/","text":"Explanation EKS cluster resources should have the encryption_config block set with protection of the secrets resource. Possible Impact EKS secrets could be read if compromised Suggested Resolution Enable encryption of EKS secrets Insecure Example The following example will fail the AVD-AWS-0039 check. --- Resources : BadExample : Type : 'AWS::EKS::Cluster' Properties : Name : badExample Version : '1.14' RoleArn : >- arn:aws:iam::012345678910:role/eks-service-role-bad-example ResourcesVpcConfig : SecurityGroupIds : - sg-6979fe18 SubnetIds : - subnet-6782e71e - subnet-e7e761ac Secure Example The following example will pass the AVD-AWS-0039 check. --- Resources : GoodExample : Type : 'AWS::EKS::Cluster' Properties : Name : goodExample Version : '1.14' RoleArn : >- arn:aws:iam::012345678910:role/eks-service-role-good-example EncryptionConfig : Provider : KeyArn : alias/eks-kms Resources : - secrets ResourcesVpcConfig : SecurityGroupIds : - sg-6979fe18 SubnetIds : - subnet-6782e71e - subnet-e7e761ac Related Links https://aws.amazon.com/about-aws/whats-new/2020/03/amazon-eks-adds-envelope-encryption-for-secrets-with-aws-kms/","title":"encrypt-secrets"},{"location":"checks/eks/encrypt-secrets/#explanation","text":"EKS cluster resources should have the encryption_config block set with protection of the secrets resource.","title":"Explanation"},{"location":"checks/eks/encrypt-secrets/#possible-impact","text":"EKS secrets could be read if compromised","title":"Possible Impact"},{"location":"checks/eks/encrypt-secrets/#suggested-resolution","text":"Enable encryption of EKS secrets","title":"Suggested Resolution"},{"location":"checks/eks/encrypt-secrets/#insecure-example","text":"The following example will fail the AVD-AWS-0039 check. --- Resources : BadExample : Type : 'AWS::EKS::Cluster' Properties : Name : badExample Version : '1.14' RoleArn : >- arn:aws:iam::012345678910:role/eks-service-role-bad-example ResourcesVpcConfig : SecurityGroupIds : - sg-6979fe18 SubnetIds : - subnet-6782e71e - subnet-e7e761ac","title":"Insecure Example"},{"location":"checks/eks/encrypt-secrets/#secure-example","text":"The following example will pass the AVD-AWS-0039 check. --- Resources : GoodExample : Type : 'AWS::EKS::Cluster' Properties : Name : goodExample Version : '1.14' RoleArn : >- arn:aws:iam::012345678910:role/eks-service-role-good-example EncryptionConfig : Provider : KeyArn : alias/eks-kms Resources : - secrets ResourcesVpcConfig : SecurityGroupIds : - sg-6979fe18 SubnetIds : - subnet-6782e71e - subnet-e7e761ac","title":"Secure Example"},{"location":"checks/eks/encrypt-secrets/#related-links","text":"https://aws.amazon.com/about-aws/whats-new/2020/03/amazon-eks-adds-envelope-encryption-for-secrets-with-aws-kms/","title":"Related Links"},{"location":"checks/elastic-search/enable-domain-encryption/","text":"Explanation You should ensure your Elasticsearch data is encrypted at rest to help prevent sensitive information from being read by unauthorised users. Possible Impact Data will be readable if compromised Suggested Resolution Enable ElasticSearch domain encryption Insecure Example The following example will fail the AVD-AWS-0048 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' Secure Example The following example will pass the AVD-AWS-0048 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' Related Links https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html","title":"enable-domain-encryption"},{"location":"checks/elastic-search/enable-domain-encryption/#explanation","text":"You should ensure your Elasticsearch data is encrypted at rest to help prevent sensitive information from being read by unauthorised users.","title":"Explanation"},{"location":"checks/elastic-search/enable-domain-encryption/#possible-impact","text":"Data will be readable if compromised","title":"Possible Impact"},{"location":"checks/elastic-search/enable-domain-encryption/#suggested-resolution","text":"Enable ElasticSearch domain encryption","title":"Suggested Resolution"},{"location":"checks/elastic-search/enable-domain-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0048 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2'","title":"Insecure Example"},{"location":"checks/elastic-search/enable-domain-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0048 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2'","title":"Secure Example"},{"location":"checks/elastic-search/enable-domain-encryption/#related-links","text":"https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/encryption-at-rest.html","title":"Related Links"},{"location":"checks/elastic-search/enable-domain-logging/","text":"Explanation Amazon ES exposes four Elasticsearch logs through Amazon CloudWatch Logs: error logs, search slow logs, index slow logs, and audit logs. Search slow logs, index slow logs, and error logs are useful for troubleshooting performance and stability issues. Audit logs track user activity for compliance purposes. All the logs are disabled by default. Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for ElasticSearch domains Insecure Example The following example will fail the AVD-AWS-0042 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' Secure Example The following example will pass the AVD-AWS-0042 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey LogPublishingOptions : Enabled : true ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' Related Links https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createdomain-configure-slow-logs.html","title":"enable-domain-logging"},{"location":"checks/elastic-search/enable-domain-logging/#explanation","text":"Amazon ES exposes four Elasticsearch logs through Amazon CloudWatch Logs: error logs, search slow logs, index slow logs, and audit logs. Search slow logs, index slow logs, and error logs are useful for troubleshooting performance and stability issues. Audit logs track user activity for compliance purposes. All the logs are disabled by default.","title":"Explanation"},{"location":"checks/elastic-search/enable-domain-logging/#possible-impact","text":"Logging provides vital information about access and usage","title":"Possible Impact"},{"location":"checks/elastic-search/enable-domain-logging/#suggested-resolution","text":"Enable logging for ElasticSearch domains","title":"Suggested Resolution"},{"location":"checks/elastic-search/enable-domain-logging/#insecure-example","text":"The following example will fail the AVD-AWS-0042 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2'","title":"Insecure Example"},{"location":"checks/elastic-search/enable-domain-logging/#secure-example","text":"The following example will pass the AVD-AWS-0042 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey LogPublishingOptions : Enabled : true ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2'","title":"Secure Example"},{"location":"checks/elastic-search/enable-domain-logging/#related-links","text":"https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-createdomain-configure-slow-logs.html","title":"Related Links"},{"location":"checks/elastic-search/enable-in-transit-encryption/","text":"Explanation Traffic flowing between Elasticsearch nodes should be encrypted to ensure sensitive data is kept private. Possible Impact In transit data between nodes could be read if intercepted Suggested Resolution Enable encrypted node to node communication Insecure Example The following example will fail the AVD-AWS-0043 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' Secure Example The following example will pass the AVD-AWS-0043 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' NodeToNodeEncryptionOptions : Enabled : true Related Links https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/ntn.html","title":"enable-in-transit-encryption"},{"location":"checks/elastic-search/enable-in-transit-encryption/#explanation","text":"Traffic flowing between Elasticsearch nodes should be encrypted to ensure sensitive data is kept private.","title":"Explanation"},{"location":"checks/elastic-search/enable-in-transit-encryption/#possible-impact","text":"In transit data between nodes could be read if intercepted","title":"Possible Impact"},{"location":"checks/elastic-search/enable-in-transit-encryption/#suggested-resolution","text":"Enable encrypted node to node communication","title":"Suggested Resolution"},{"location":"checks/elastic-search/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0043 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2'","title":"Insecure Example"},{"location":"checks/elastic-search/enable-in-transit-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0043 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' NodeToNodeEncryptionOptions : Enabled : true","title":"Secure Example"},{"location":"checks/elastic-search/enable-in-transit-encryption/#related-links","text":"https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/ntn.html","title":"Related Links"},{"location":"checks/elastic-search/enforce-https/","text":"Explanation Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic. Possible Impact HTTP traffic can be intercepted and the contents read Suggested Resolution Enforce the use of HTTPS for ElasticSearch Insecure Example The following example will fail the AVD-AWS-0046 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' Secure Example The following example will pass the AVD-AWS-0046 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' DomainEndpointOptions : EnforceHTTPS : true ElasticsearchVersion : '7.10' EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' Related Links https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html","title":"enforce-https"},{"location":"checks/elastic-search/enforce-https/#explanation","text":"Plain HTTP is unencrypted and human-readable. This means that if a malicious actor was to eavesdrop on your connection, they would be able to see all of your data flowing back and forth. You should use HTTPS, which is HTTP over an encrypted (TLS) connection, meaning eavesdroppers cannot read your traffic.","title":"Explanation"},{"location":"checks/elastic-search/enforce-https/#possible-impact","text":"HTTP traffic can be intercepted and the contents read","title":"Possible Impact"},{"location":"checks/elastic-search/enforce-https/#suggested-resolution","text":"Enforce the use of HTTPS for ElasticSearch","title":"Suggested Resolution"},{"location":"checks/elastic-search/enforce-https/#insecure-example","text":"The following example will fail the AVD-AWS-0046 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2'","title":"Insecure Example"},{"location":"checks/elastic-search/enforce-https/#secure-example","text":"The following example will pass the AVD-AWS-0046 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' DomainEndpointOptions : EnforceHTTPS : true ElasticsearchVersion : '7.10' EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2'","title":"Secure Example"},{"location":"checks/elastic-search/enforce-https/#related-links","text":"https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html","title":"Related Links"},{"location":"checks/elastic-search/use-secure-tls-policy/","text":"Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated SSL policies increase exposure to known vulnerabilities Suggested Resolution Use the most modern TLS/SSL policies available Insecure Example The following example will fail the AVD-AWS-0047 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' Secure Example The following example will pass the AVD-AWS-0047 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' DomainEndpointOptions : TLSSecurityPolicy : Policy-Min-TLS-1-2-2019-07 EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2' Related Links https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html","title":"use-secure-tls-policy"},{"location":"checks/elastic-search/use-secure-tls-policy/#explanation","text":"You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.","title":"Explanation"},{"location":"checks/elastic-search/use-secure-tls-policy/#possible-impact","text":"Outdated SSL policies increase exposure to known vulnerabilities","title":"Possible Impact"},{"location":"checks/elastic-search/use-secure-tls-policy/#suggested-resolution","text":"Use the most modern TLS/SSL policies available","title":"Suggested Resolution"},{"location":"checks/elastic-search/use-secure-tls-policy/#insecure-example","text":"The following example will fail the AVD-AWS-0047 check. --- Resources : BadExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2'","title":"Insecure Example"},{"location":"checks/elastic-search/use-secure-tls-policy/#secure-example","text":"The following example will pass the AVD-AWS-0047 check. --- Resources : GoodExample : Type : AWS::Elasticsearch::Domain Properties : DomainName : 'test' ElasticsearchVersion : '7.10' DomainEndpointOptions : TLSSecurityPolicy : Policy-Min-TLS-1-2-2019-07 EncryptionAtRestOptions : Enabled : true KmsKeyId : alias/kmskey ElasticsearchClusterConfig : DedicatedMasterEnabled : true InstanceCount : '2' ZoneAwarenessEnabled : true InstanceType : 'm3.medium.elasticsearch' DedicatedMasterType : 'm3.medium.elasticsearch' DedicatedMasterCount : '3' EBSOptions : EBSEnabled : true Iops : '0' VolumeSize : '20' VolumeType : 'gp2'","title":"Secure Example"},{"location":"checks/elastic-search/use-secure-tls-policy/#related-links","text":"https://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/es-data-protection.html","title":"Related Links"},{"location":"checks/elasticache/add-description-for-security-group/","text":"Explanation Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups and rules Insecure Example The following example will fail the AVD-AWS-0049 check. --- Resources : BadExampleCacheGroup : Type : AWS::ElastiCache::SecurityGroup Properties : Tags : - Name : BadExample BadExampleEc2SecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupName : BadExample GroupDescription : Bad Elasticache Security Group BadSecurityGroupIngress : Type : AWS::ElastiCache::SecurityGroupIngress Properties : CacheSecurityGroupName : BadExampleCacheGroup EC2SecurityGroupName : BadExampleEc2SecurityGroup Secure Example The following example will pass the AVD-AWS-0049 check. --- Resources : GoodExampleCacheGroup : Type : AWS::ElastiCache::SecurityGroup Properties : Description : Some description GoodExampleEc2SecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupName : GoodExample GroupDescription : Good Elasticache Security Group GoodSecurityGroupIngress : Type : AWS::ElastiCache::SecurityGroupIngress Properties : CacheSecurityGroupName : GoodExampleCacheGroup EC2SecurityGroupName : GoodExampleEc2SecurityGroup Related Links https://docs.aws.amazon.com/AmazonElastiCache/latest/mem-ug/SecurityGroups.Creating.html","title":"add-description-for-security-group"},{"location":"checks/elasticache/add-description-for-security-group/#explanation","text":"Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.","title":"Explanation"},{"location":"checks/elasticache/add-description-for-security-group/#possible-impact","text":"Descriptions provide context for the firewall rule reasons","title":"Possible Impact"},{"location":"checks/elasticache/add-description-for-security-group/#suggested-resolution","text":"Add descriptions for all security groups and rules","title":"Suggested Resolution"},{"location":"checks/elasticache/add-description-for-security-group/#insecure-example","text":"The following example will fail the AVD-AWS-0049 check. --- Resources : BadExampleCacheGroup : Type : AWS::ElastiCache::SecurityGroup Properties : Tags : - Name : BadExample BadExampleEc2SecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupName : BadExample GroupDescription : Bad Elasticache Security Group BadSecurityGroupIngress : Type : AWS::ElastiCache::SecurityGroupIngress Properties : CacheSecurityGroupName : BadExampleCacheGroup EC2SecurityGroupName : BadExampleEc2SecurityGroup","title":"Insecure Example"},{"location":"checks/elasticache/add-description-for-security-group/#secure-example","text":"The following example will pass the AVD-AWS-0049 check. --- Resources : GoodExampleCacheGroup : Type : AWS::ElastiCache::SecurityGroup Properties : Description : Some description GoodExampleEc2SecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupName : GoodExample GroupDescription : Good Elasticache Security Group GoodSecurityGroupIngress : Type : AWS::ElastiCache::SecurityGroupIngress Properties : CacheSecurityGroupName : GoodExampleCacheGroup EC2SecurityGroupName : GoodExampleEc2SecurityGroup","title":"Secure Example"},{"location":"checks/elasticache/add-description-for-security-group/#related-links","text":"https://docs.aws.amazon.com/AmazonElastiCache/latest/mem-ug/SecurityGroups.Creating.html","title":"Related Links"},{"location":"checks/elasticache/enable-backup-retention/","text":"Explanation Redis clusters should have a snapshot retention time to ensure that they are backed up and can be restored if required. Possible Impact Without backups of the redis cluster recovery is made difficult Suggested Resolution Configure snapshot retention for redis cluster Insecure Example The following example will fail the AVD-AWS-0050 check. --- Resources : BadExample : Type : AWS::ElastiCache::CacheCluster Properties : AZMode : cross-az CacheNodeType : cache.m3.medium Engine : redis NumCacheNodes : '3' PreferredAvailabilityZones : - us-west-2a - us-west-2a - us-west-2b Secure Example The following example will pass the AVD-AWS-0050 check. --- Resources : GoodExample : Type : AWS::ElastiCache::CacheCluster Properties : AZMode : cross-az CacheNodeType : cache.m3.medium Engine : redis NumCacheNodes : '3' SnapshotRetentionLimit : 7 PreferredAvailabilityZones : - us-west-2a - us-west-2a - us-west-2b Related Links https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/backups-automatic.html","title":"enable-backup-retention"},{"location":"checks/elasticache/enable-backup-retention/#explanation","text":"Redis clusters should have a snapshot retention time to ensure that they are backed up and can be restored if required.","title":"Explanation"},{"location":"checks/elasticache/enable-backup-retention/#possible-impact","text":"Without backups of the redis cluster recovery is made difficult","title":"Possible Impact"},{"location":"checks/elasticache/enable-backup-retention/#suggested-resolution","text":"Configure snapshot retention for redis cluster","title":"Suggested Resolution"},{"location":"checks/elasticache/enable-backup-retention/#insecure-example","text":"The following example will fail the AVD-AWS-0050 check. --- Resources : BadExample : Type : AWS::ElastiCache::CacheCluster Properties : AZMode : cross-az CacheNodeType : cache.m3.medium Engine : redis NumCacheNodes : '3' PreferredAvailabilityZones : - us-west-2a - us-west-2a - us-west-2b","title":"Insecure Example"},{"location":"checks/elasticache/enable-backup-retention/#secure-example","text":"The following example will pass the AVD-AWS-0050 check. --- Resources : GoodExample : Type : AWS::ElastiCache::CacheCluster Properties : AZMode : cross-az CacheNodeType : cache.m3.medium Engine : redis NumCacheNodes : '3' SnapshotRetentionLimit : 7 PreferredAvailabilityZones : - us-west-2a - us-west-2a - us-west-2b","title":"Secure Example"},{"location":"checks/elasticache/enable-backup-retention/#related-links","text":"https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/backups-automatic.html","title":"Related Links"},{"location":"checks/elasticache/enable-in-transit-encryption/","text":"Explanation Traffic flowing between Elasticache replication nodes should be encrypted to ensure sensitive data is kept private. Possible Impact In transit data in the Replication Group could be read if intercepted Suggested Resolution Enable in transit encryption for replication group Insecure Example The following example will fail the AVD-AWS-0051 check. --- Resources : BadExample : Type : 'AWS::ElastiCache::ReplicationGroup' Properties : AutomaticFailoverEnabled : true CacheNodeType : cache.r3.large CacheSubnetGroupName : !Ref CacheSubnetGroup Engine : redis EngineVersion : '3.2' NumNodeGroups : '2' ReplicasPerNodeGroup : '3' Port : 6379 PreferredMaintenanceWindow : 'sun:05:00-sun:09:00' ReplicationGroupDescription : A sample replication group SecurityGroupIds : - !Ref ReplicationGroupSG SnapshotRetentionLimit : 5 SnapshotWindow : '10:00-12:00' Secure Example The following example will pass the AVD-AWS-0051 check. --- Resources : GoodExample : Type : 'AWS::ElastiCache::ReplicationGroup' Properties : AutomaticFailoverEnabled : true CacheNodeType : cache.r3.large CacheSubnetGroupName : !Ref CacheSubnetGroup Engine : redis EngineVersion : '3.2' NumNodeGroups : '2' ReplicasPerNodeGroup : '3' Port : 6379 PreferredMaintenanceWindow : 'sun:05:00-sun:09:00' ReplicationGroupDescription : A sample replication group SecurityGroupIds : - !Ref ReplicationGroupSG SnapshotRetentionLimit : 5 SnapshotWindow : '10:00-12:00' TransitEncryptionEnabled : true Related Links https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/in-transit-encryption.html","title":"enable-in-transit-encryption"},{"location":"checks/elasticache/enable-in-transit-encryption/#explanation","text":"Traffic flowing between Elasticache replication nodes should be encrypted to ensure sensitive data is kept private.","title":"Explanation"},{"location":"checks/elasticache/enable-in-transit-encryption/#possible-impact","text":"In transit data in the Replication Group could be read if intercepted","title":"Possible Impact"},{"location":"checks/elasticache/enable-in-transit-encryption/#suggested-resolution","text":"Enable in transit encryption for replication group","title":"Suggested Resolution"},{"location":"checks/elasticache/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0051 check. --- Resources : BadExample : Type : 'AWS::ElastiCache::ReplicationGroup' Properties : AutomaticFailoverEnabled : true CacheNodeType : cache.r3.large CacheSubnetGroupName : !Ref CacheSubnetGroup Engine : redis EngineVersion : '3.2' NumNodeGroups : '2' ReplicasPerNodeGroup : '3' Port : 6379 PreferredMaintenanceWindow : 'sun:05:00-sun:09:00' ReplicationGroupDescription : A sample replication group SecurityGroupIds : - !Ref ReplicationGroupSG SnapshotRetentionLimit : 5 SnapshotWindow : '10:00-12:00'","title":"Insecure Example"},{"location":"checks/elasticache/enable-in-transit-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0051 check. --- Resources : GoodExample : Type : 'AWS::ElastiCache::ReplicationGroup' Properties : AutomaticFailoverEnabled : true CacheNodeType : cache.r3.large CacheSubnetGroupName : !Ref CacheSubnetGroup Engine : redis EngineVersion : '3.2' NumNodeGroups : '2' ReplicasPerNodeGroup : '3' Port : 6379 PreferredMaintenanceWindow : 'sun:05:00-sun:09:00' ReplicationGroupDescription : A sample replication group SecurityGroupIds : - !Ref ReplicationGroupSG SnapshotRetentionLimit : 5 SnapshotWindow : '10:00-12:00' TransitEncryptionEnabled : true","title":"Secure Example"},{"location":"checks/elasticache/enable-in-transit-encryption/#related-links","text":"https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/in-transit-encryption.html","title":"Related Links"},{"location":"checks/iam/no-policy-wildcards/","text":"Explanation You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals. Possible Impact Overly permissive policies may grant access to sensitive resources Suggested Resolution Specify the exact permissions required, and to which resources they should apply instead of using wildcards. Insecure Example The following example will fail the AVD-AWS-0057 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of policy Resources : BadPolicy : Type : 'AWS::IAM::Policy' Properties : PolicyName : CFNUsers PolicyDocument : Version : \"2012-10-17\" Statement : - Effect : Allow Action : - 'cloudformation:Describe*' - 'cloudformation:List*' - 'cloudformation:Get*' Resource : '*' Secure Example The following example will pass the AVD-AWS-0057 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of policy Resources : GoodPolicy : Type : 'AWS::IAM::Policy' Properties : PolicyName : CFNUsers PolicyDocument : Version : \"2012-10-17\" Statement : - Effect : Allow Action : - 's3:ListBuckets' Resource : 'specific-bucket' Related Links https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html","title":"no-policy-wildcards"},{"location":"checks/iam/no-policy-wildcards/#explanation","text":"You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals.","title":"Explanation"},{"location":"checks/iam/no-policy-wildcards/#possible-impact","text":"Overly permissive policies may grant access to sensitive resources","title":"Possible Impact"},{"location":"checks/iam/no-policy-wildcards/#suggested-resolution","text":"Specify the exact permissions required, and to which resources they should apply instead of using wildcards.","title":"Suggested Resolution"},{"location":"checks/iam/no-policy-wildcards/#insecure-example","text":"The following example will fail the AVD-AWS-0057 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of policy Resources : BadPolicy : Type : 'AWS::IAM::Policy' Properties : PolicyName : CFNUsers PolicyDocument : Version : \"2012-10-17\" Statement : - Effect : Allow Action : - 'cloudformation:Describe*' - 'cloudformation:List*' - 'cloudformation:Get*' Resource : '*'","title":"Insecure Example"},{"location":"checks/iam/no-policy-wildcards/#secure-example","text":"The following example will pass the AVD-AWS-0057 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of policy Resources : GoodPolicy : Type : 'AWS::IAM::Policy' Properties : PolicyName : CFNUsers PolicyDocument : Version : \"2012-10-17\" Statement : - Effect : Allow Action : - 's3:ListBuckets' Resource : 'specific-bucket'","title":"Secure Example"},{"location":"checks/iam/no-policy-wildcards/#related-links","text":"https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html","title":"Related Links"},{"location":"checks/kinesis/enable-in-transit-encryption/","text":"Explanation Kinesis streams should be encrypted to ensure sensitive data is kept private. Additionally, non-default KMS keys should be used so granularity of access control can be ensured. Possible Impact Intercepted data can be read in transit Suggested Resolution Enable in transit encryption Insecure Example The following example will fail the AVD-AWS-0064 check. --- Resources : BadExample : Type : AWS::Kinesis::Stream Properties : Name : BadExample RetentionPeriodHours : 168 ShardCount : 3 Tags : - Key : Environment Value : Production Secure Example The following example will pass the AVD-AWS-0064 check. --- Resources : GoodExample : Type : AWS::Kinesis::Stream Properties : Name : GoodExample RetentionPeriodHours : 168 ShardCount : 3 StreamEncryption : EncryptionType : KMS KeyId : alis/key Tags : - Key : Environment Value : Production Related Links https://docs.aws.amazon.com/streams/latest/dev/server-side-encryption.html","title":"enable-in-transit-encryption"},{"location":"checks/kinesis/enable-in-transit-encryption/#explanation","text":"Kinesis streams should be encrypted to ensure sensitive data is kept private. Additionally, non-default KMS keys should be used so granularity of access control can be ensured.","title":"Explanation"},{"location":"checks/kinesis/enable-in-transit-encryption/#possible-impact","text":"Intercepted data can be read in transit","title":"Possible Impact"},{"location":"checks/kinesis/enable-in-transit-encryption/#suggested-resolution","text":"Enable in transit encryption","title":"Suggested Resolution"},{"location":"checks/kinesis/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0064 check. --- Resources : BadExample : Type : AWS::Kinesis::Stream Properties : Name : BadExample RetentionPeriodHours : 168 ShardCount : 3 Tags : - Key : Environment Value : Production","title":"Insecure Example"},{"location":"checks/kinesis/enable-in-transit-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0064 check. --- Resources : GoodExample : Type : AWS::Kinesis::Stream Properties : Name : GoodExample RetentionPeriodHours : 168 ShardCount : 3 StreamEncryption : EncryptionType : KMS KeyId : alis/key Tags : - Key : Environment Value : Production","title":"Secure Example"},{"location":"checks/kinesis/enable-in-transit-encryption/#related-links","text":"https://docs.aws.amazon.com/streams/latest/dev/server-side-encryption.html","title":"Related Links"},{"location":"checks/lambda/enable-tracing/","text":"Explanation X-Ray tracing enables end-to-end debugging and analysis of all function activity. This will allow for identifying bottlenecks, slow downs and timeouts. Possible Impact WIthout full tracing enabled it is difficult to trace the flow of logs Suggested Resolution Enable tracing Insecure Example The following example will fail the AVD-AWS-0066 check. --- Resources : BadExample : Type : AWS::Lambda::Function Properties : Handler : index.handler Role : arn:aws:iam::123456789012:role/lambda-role Code : S3Bucket : my-bucket S3Key : function.zip Runtime : nodejs12.x Timeout : 5 VpcConfig : SecurityGroupIds : - sg-085912345678492fb SubnetIds : - subnet-071f712345678e7c8 - subnet-07fd123456788a036 Secure Example The following example will pass the AVD-AWS-0066 check. --- Resources : Function : Type : AWS::Lambda::Function Properties : Handler : index.handler Role : arn:aws:iam::123456789012:role/lambda-role Code : S3Bucket : my-bucket S3Key : function.zip Runtime : nodejs12.x Timeout : 5 TracingConfig : Mode : Active VpcConfig : SecurityGroupIds : - sg-085912345678492fb SubnetIds : - subnet-071f712345678e7c8 - subnet-07fd123456788a036 Related Links https://docs.aws.amazon.com/lambda/latest/dg/services-xray.html","title":"enable-tracing"},{"location":"checks/lambda/enable-tracing/#explanation","text":"X-Ray tracing enables end-to-end debugging and analysis of all function activity. This will allow for identifying bottlenecks, slow downs and timeouts.","title":"Explanation"},{"location":"checks/lambda/enable-tracing/#possible-impact","text":"WIthout full tracing enabled it is difficult to trace the flow of logs","title":"Possible Impact"},{"location":"checks/lambda/enable-tracing/#suggested-resolution","text":"Enable tracing","title":"Suggested Resolution"},{"location":"checks/lambda/enable-tracing/#insecure-example","text":"The following example will fail the AVD-AWS-0066 check. --- Resources : BadExample : Type : AWS::Lambda::Function Properties : Handler : index.handler Role : arn:aws:iam::123456789012:role/lambda-role Code : S3Bucket : my-bucket S3Key : function.zip Runtime : nodejs12.x Timeout : 5 VpcConfig : SecurityGroupIds : - sg-085912345678492fb SubnetIds : - subnet-071f712345678e7c8 - subnet-07fd123456788a036","title":"Insecure Example"},{"location":"checks/lambda/enable-tracing/#secure-example","text":"The following example will pass the AVD-AWS-0066 check. --- Resources : Function : Type : AWS::Lambda::Function Properties : Handler : index.handler Role : arn:aws:iam::123456789012:role/lambda-role Code : S3Bucket : my-bucket S3Key : function.zip Runtime : nodejs12.x Timeout : 5 TracingConfig : Mode : Active VpcConfig : SecurityGroupIds : - sg-085912345678492fb SubnetIds : - subnet-071f712345678e7c8 - subnet-07fd123456788a036","title":"Secure Example"},{"location":"checks/lambda/enable-tracing/#related-links","text":"https://docs.aws.amazon.com/lambda/latest/dg/services-xray.html","title":"Related Links"},{"location":"checks/lambda/restrict-source-arn/","text":"Explanation When the principal is an AWS service, the ARN of the specific resource within that service to grant permission to. Without this, any resource from principal will be granted permission \u2013 even if that resource is from another account. For S3, this should be the ARN of the S3 Bucket. For CloudWatch Events, this should be the ARN of the CloudWatch Events Rule. For API Gateway, this should be the ARN of the API Possible Impact Not providing the source ARN allows any resource from principal, even from other accounts Suggested Resolution Always provide a source arn for Lambda permissions Insecure Example The following example will fail the AVD-AWS-0067 check. --- Resources : BadExample : Type : AWS::Lambda::Function Properties : Handler : index.handler Role : arn:aws:iam::123456789012:role/lambda-role Code : S3Bucket : my-bucket S3Key : function.zip Runtime : nodejs12.x Timeout : 5 TracingConfig : Mode : Active VpcConfig : SecurityGroupIds : - sg-085912345678492fb SubnetIds : - subnet-071f712345678e7c8 - subnet-07fd123456788a036 BadPermission : Type : AWS::Lambda::Permission Properties : FunctionName : !Ref BadExample Action : lambda:InvokeFunction Principal : s3.amazonaws.com Secure Example The following example will pass the AVD-AWS-0067 check. --- Resources : GoodExample : Type : AWS::Lambda::Function Properties : Handler : index.handler Role : arn:aws:iam::123456789012:role/lambda-role Code : S3Bucket : my-bucket S3Key : function.zip Runtime : nodejs12.x Timeout : 5 TracingConfig : Mode : Active VpcConfig : SecurityGroupIds : - sg-085912345678492fb SubnetIds : - subnet-071f712345678e7c8 - subnet-07fd123456788a036 GoodPermission : Type : AWS::Lambda::Permission Properties : FunctionName : !Ref BadExample Action : lambda:InvokeFunction Principal : s3.amazonaws.com SourceArn : \"lambda.amazonaws.com\" Related Links https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html","title":"restrict-source-arn"},{"location":"checks/lambda/restrict-source-arn/#explanation","text":"When the principal is an AWS service, the ARN of the specific resource within that service to grant permission to. Without this, any resource from principal will be granted permission \u2013 even if that resource is from another account. For S3, this should be the ARN of the S3 Bucket. For CloudWatch Events, this should be the ARN of the CloudWatch Events Rule. For API Gateway, this should be the ARN of the API","title":"Explanation"},{"location":"checks/lambda/restrict-source-arn/#possible-impact","text":"Not providing the source ARN allows any resource from principal, even from other accounts","title":"Possible Impact"},{"location":"checks/lambda/restrict-source-arn/#suggested-resolution","text":"Always provide a source arn for Lambda permissions","title":"Suggested Resolution"},{"location":"checks/lambda/restrict-source-arn/#insecure-example","text":"The following example will fail the AVD-AWS-0067 check. --- Resources : BadExample : Type : AWS::Lambda::Function Properties : Handler : index.handler Role : arn:aws:iam::123456789012:role/lambda-role Code : S3Bucket : my-bucket S3Key : function.zip Runtime : nodejs12.x Timeout : 5 TracingConfig : Mode : Active VpcConfig : SecurityGroupIds : - sg-085912345678492fb SubnetIds : - subnet-071f712345678e7c8 - subnet-07fd123456788a036 BadPermission : Type : AWS::Lambda::Permission Properties : FunctionName : !Ref BadExample Action : lambda:InvokeFunction Principal : s3.amazonaws.com","title":"Insecure Example"},{"location":"checks/lambda/restrict-source-arn/#secure-example","text":"The following example will pass the AVD-AWS-0067 check. --- Resources : GoodExample : Type : AWS::Lambda::Function Properties : Handler : index.handler Role : arn:aws:iam::123456789012:role/lambda-role Code : S3Bucket : my-bucket S3Key : function.zip Runtime : nodejs12.x Timeout : 5 TracingConfig : Mode : Active VpcConfig : SecurityGroupIds : - sg-085912345678492fb SubnetIds : - subnet-071f712345678e7c8 - subnet-07fd123456788a036 GoodPermission : Type : AWS::Lambda::Permission Properties : FunctionName : !Ref BadExample Action : lambda:InvokeFunction Principal : s3.amazonaws.com SourceArn : \"lambda.amazonaws.com\"","title":"Secure Example"},{"location":"checks/lambda/restrict-source-arn/#related-links","text":"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-permission.html","title":"Related Links"},{"location":"checks/mq/enable-audit-logging/","text":"Explanation Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation Possible Impact Without audit logging it is difficult to trace activity in the MQ broker Suggested Resolution Enable audit logging Insecure Example The following example will fail the AVD-AWS-0070 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : Logs : Audit : false Secure Example The following example will pass the AVD-AWS-0070 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : Logs : Audit : true Related Links https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html","title":"enable-audit-logging"},{"location":"checks/mq/enable-audit-logging/#explanation","text":"Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation","title":"Explanation"},{"location":"checks/mq/enable-audit-logging/#possible-impact","text":"Without audit logging it is difficult to trace activity in the MQ broker","title":"Possible Impact"},{"location":"checks/mq/enable-audit-logging/#suggested-resolution","text":"Enable audit logging","title":"Suggested Resolution"},{"location":"checks/mq/enable-audit-logging/#insecure-example","text":"The following example will fail the AVD-AWS-0070 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : Logs : Audit : false","title":"Insecure Example"},{"location":"checks/mq/enable-audit-logging/#secure-example","text":"The following example will pass the AVD-AWS-0070 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : Logs : Audit : true","title":"Secure Example"},{"location":"checks/mq/enable-audit-logging/#related-links","text":"https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html","title":"Related Links"},{"location":"checks/mq/enable-general-logging/","text":"Explanation Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation Possible Impact Without logging it is difficult to trace issues Suggested Resolution Enable general logging Insecure Example The following example will fail the AVD-AWS-0071 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : Logs : General : false Secure Example The following example will pass the AVD-AWS-0071 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : Logs : General : true Related Links https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html","title":"enable-general-logging"},{"location":"checks/mq/enable-general-logging/#explanation","text":"Logging should be enabled to allow tracing of issues and activity to be investigated more fully. Logs provide additional information and context which is often invalauble during investigation","title":"Explanation"},{"location":"checks/mq/enable-general-logging/#possible-impact","text":"Without logging it is difficult to trace issues","title":"Possible Impact"},{"location":"checks/mq/enable-general-logging/#suggested-resolution","text":"Enable general logging","title":"Suggested Resolution"},{"location":"checks/mq/enable-general-logging/#insecure-example","text":"The following example will fail the AVD-AWS-0071 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : Logs : General : false","title":"Insecure Example"},{"location":"checks/mq/enable-general-logging/#secure-example","text":"The following example will pass the AVD-AWS-0071 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : Logs : General : true","title":"Secure Example"},{"location":"checks/mq/enable-general-logging/#related-links","text":"https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/configure-logging-monitoring-activemq.html","title":"Related Links"},{"location":"checks/mq/no-public-access/","text":"Explanation Public access of the MQ broker should be disabled and only allow routes to applications that require access. Possible Impact Publicly accessible MQ Broker may be vulnerable to compromise Suggested Resolution Disable public access when not required Insecure Example The following example will fail the AVD-AWS-0072 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : PubliclyAccessible : true Secure Example The following example will pass the AVD-AWS-0072 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : PubliclyAccessible : false Related Links https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/using-amazon-mq-securely.html#prefer-brokers-without-public-accessibility","title":"no-public-access"},{"location":"checks/mq/no-public-access/#explanation","text":"Public access of the MQ broker should be disabled and only allow routes to applications that require access.","title":"Explanation"},{"location":"checks/mq/no-public-access/#possible-impact","text":"Publicly accessible MQ Broker may be vulnerable to compromise","title":"Possible Impact"},{"location":"checks/mq/no-public-access/#suggested-resolution","text":"Disable public access when not required","title":"Suggested Resolution"},{"location":"checks/mq/no-public-access/#insecure-example","text":"The following example will fail the AVD-AWS-0072 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : PubliclyAccessible : true","title":"Insecure Example"},{"location":"checks/mq/no-public-access/#secure-example","text":"The following example will pass the AVD-AWS-0072 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Broker : Type : AWS::AmazonMQ::Broker Properties : PubliclyAccessible : false","title":"Secure Example"},{"location":"checks/mq/no-public-access/#related-links","text":"https://docs.aws.amazon.com/amazon-mq/latest/developer-guide/using-amazon-mq-securely.html#prefer-brokers-without-public-accessibility","title":"Related Links"},{"location":"checks/msk/enable-in-transit-encryption/","text":"Explanation Encryption should be forced for Kafka clusters, including for communication between nodes. This ensure sensitive data is kept private. Possible Impact Intercepted data can be read in transit Suggested Resolution Enable in transit encryption Insecure Example The following example will fail the AVD-AWS-0073 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::MSK::Cluster Properties : EncryptionInfo : EncryptionInTransit : ClientBroker : \"TLS_PLAINTEXT\" Secure Example The following example will pass the AVD-AWS-0073 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Cluster : Type : AWS::MSK::Cluster Properties : EncryptionInfo : EncryptionInTransit : ClientBroker : \"TLS\" Related Links https://docs.aws.amazon.com/msk/latest/developerguide/msk-encryption.html","title":"enable-in-transit-encryption"},{"location":"checks/msk/enable-in-transit-encryption/#explanation","text":"Encryption should be forced for Kafka clusters, including for communication between nodes. This ensure sensitive data is kept private.","title":"Explanation"},{"location":"checks/msk/enable-in-transit-encryption/#possible-impact","text":"Intercepted data can be read in transit","title":"Possible Impact"},{"location":"checks/msk/enable-in-transit-encryption/#suggested-resolution","text":"Enable in transit encryption","title":"Suggested Resolution"},{"location":"checks/msk/enable-in-transit-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0073 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::MSK::Cluster Properties : EncryptionInfo : EncryptionInTransit : ClientBroker : \"TLS_PLAINTEXT\"","title":"Insecure Example"},{"location":"checks/msk/enable-in-transit-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0073 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Cluster : Type : AWS::MSK::Cluster Properties : EncryptionInfo : EncryptionInTransit : ClientBroker : \"TLS\"","title":"Secure Example"},{"location":"checks/msk/enable-in-transit-encryption/#related-links","text":"https://docs.aws.amazon.com/msk/latest/developerguide/msk-encryption.html","title":"Related Links"},{"location":"checks/msk/enable-logging/","text":"Explanation Managed streaming for Kafka can log to Cloud Watch, Kinesis Firehose and S3, at least one of these locations should be logged to Possible Impact Without logging it is difficult to trace issues Suggested Resolution Enable logging Insecure Example The following example will fail the AVD-AWS-0074 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::MSK::Cluster Properties : LoggingInfo : BrokerLogs : CloudWatchLogs : Enabled : false Secure Example The following example will pass the AVD-AWS-0074 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Cluster : Type : AWS::MSK::Cluster Properties : LoggingInfo : BrokerLogs : S3 : Enabled : true Related Links https://docs.aws.amazon.com/msk/latest/developerguide/msk-logging.html","title":"enable-logging"},{"location":"checks/msk/enable-logging/#explanation","text":"Managed streaming for Kafka can log to Cloud Watch, Kinesis Firehose and S3, at least one of these locations should be logged to","title":"Explanation"},{"location":"checks/msk/enable-logging/#possible-impact","text":"Without logging it is difficult to trace issues","title":"Possible Impact"},{"location":"checks/msk/enable-logging/#suggested-resolution","text":"Enable logging","title":"Suggested Resolution"},{"location":"checks/msk/enable-logging/#insecure-example","text":"The following example will fail the AVD-AWS-0074 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::MSK::Cluster Properties : LoggingInfo : BrokerLogs : CloudWatchLogs : Enabled : false","title":"Insecure Example"},{"location":"checks/msk/enable-logging/#secure-example","text":"The following example will pass the AVD-AWS-0074 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Cluster : Type : AWS::MSK::Cluster Properties : LoggingInfo : BrokerLogs : S3 : Enabled : true","title":"Secure Example"},{"location":"checks/msk/enable-logging/#related-links","text":"https://docs.aws.amazon.com/msk/latest/developerguide/msk-logging.html","title":"Related Links"},{"location":"checks/neptune/enable-log-export/","text":"Explanation Neptune does not have auditing by default. To ensure that you are able to accurately audit the usage of your Neptune instance you should enable export logs. Possible Impact Limited visibility of audit trail for changes to Neptune Suggested Resolution Enable export logs Insecure Example The following example will fail the AVD-AWS-0075 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::Neptune::DBCluster Properties : EnableCloudwatchLogsExports : - debug Secure Example The following example will pass the AVD-AWS-0075 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::Neptune::DBCluster Properties : EnableCloudwatchLogsExports : - audit Related Links https://docs.aws.amazon.com/neptune/latest/userguide/auditing.html","title":"enable-log-export"},{"location":"checks/neptune/enable-log-export/#explanation","text":"Neptune does not have auditing by default. To ensure that you are able to accurately audit the usage of your Neptune instance you should enable export logs.","title":"Explanation"},{"location":"checks/neptune/enable-log-export/#possible-impact","text":"Limited visibility of audit trail for changes to Neptune","title":"Possible Impact"},{"location":"checks/neptune/enable-log-export/#suggested-resolution","text":"Enable export logs","title":"Suggested Resolution"},{"location":"checks/neptune/enable-log-export/#insecure-example","text":"The following example will fail the AVD-AWS-0075 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::Neptune::DBCluster Properties : EnableCloudwatchLogsExports : - debug","title":"Insecure Example"},{"location":"checks/neptune/enable-log-export/#secure-example","text":"The following example will pass the AVD-AWS-0075 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::Neptune::DBCluster Properties : EnableCloudwatchLogsExports : - audit","title":"Secure Example"},{"location":"checks/neptune/enable-log-export/#related-links","text":"https://docs.aws.amazon.com/neptune/latest/userguide/auditing.html","title":"Related Links"},{"location":"checks/neptune/enable-storage-encryption/","text":"Explanation Encryption of Neptune storage ensures that if their is compromise of the disks, the data is still protected. Possible Impact Unencrypted sensitive data is vulnerable to compromise. Suggested Resolution Enable encryption of Neptune storage Insecure Example The following example will fail the AVD-AWS-0076 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::Neptune::DBCluster Properties : StorageEncrypted : false Secure Example The following example will pass the AVD-AWS-0076 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Cluster : Type : AWS::Neptune::DBCluster Properties : StorageEncrypted : true KmsKeyId : \"something\" Related Links https://docs.aws.amazon.com/neptune/latest/userguide/encrypt.html","title":"enable-storage-encryption"},{"location":"checks/neptune/enable-storage-encryption/#explanation","text":"Encryption of Neptune storage ensures that if their is compromise of the disks, the data is still protected.","title":"Explanation"},{"location":"checks/neptune/enable-storage-encryption/#possible-impact","text":"Unencrypted sensitive data is vulnerable to compromise.","title":"Possible Impact"},{"location":"checks/neptune/enable-storage-encryption/#suggested-resolution","text":"Enable encryption of Neptune storage","title":"Suggested Resolution"},{"location":"checks/neptune/enable-storage-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0076 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Cluster : Type : AWS::Neptune::DBCluster Properties : StorageEncrypted : false","title":"Insecure Example"},{"location":"checks/neptune/enable-storage-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0076 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Cluster : Type : AWS::Neptune::DBCluster Properties : StorageEncrypted : true KmsKeyId : \"something\"","title":"Secure Example"},{"location":"checks/neptune/enable-storage-encryption/#related-links","text":"https://docs.aws.amazon.com/neptune/latest/userguide/encrypt.html","title":"Related Links"},{"location":"checks/rds/enable-performance-insights/","text":"Explanation When enabling Performance Insights on an RDS cluster or RDS DB Instance, and encryption key should be provided. The encryption key specified in performance_insights_kms_key_id references a KMS ARN Possible Impact Data can be read from the RDS Performance Insights if it is compromised Suggested Resolution Enable encryption for RDS clusters and instances Insecure Example The following example will fail the AVD-AWS-0078 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Queue : Type : AWS::RDS::DBInstance Properties : EnablePerformanceInsights : false Secure Example The following example will pass the AVD-AWS-0078 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Queue : Type : AWS::RDS::DBInstance Properties : EnablePerformanceInsights : true PerformanceInsightsKMSKeyId : \"something\" Related Links https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.htm","title":"enable-performance-insights"},{"location":"checks/rds/enable-performance-insights/#explanation","text":"When enabling Performance Insights on an RDS cluster or RDS DB Instance, and encryption key should be provided. The encryption key specified in performance_insights_kms_key_id references a KMS ARN","title":"Explanation"},{"location":"checks/rds/enable-performance-insights/#possible-impact","text":"Data can be read from the RDS Performance Insights if it is compromised","title":"Possible Impact"},{"location":"checks/rds/enable-performance-insights/#suggested-resolution","text":"Enable encryption for RDS clusters and instances","title":"Suggested Resolution"},{"location":"checks/rds/enable-performance-insights/#insecure-example","text":"The following example will fail the AVD-AWS-0078 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Queue : Type : AWS::RDS::DBInstance Properties : EnablePerformanceInsights : false","title":"Insecure Example"},{"location":"checks/rds/enable-performance-insights/#secure-example","text":"The following example will pass the AVD-AWS-0078 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Queue : Type : AWS::RDS::DBInstance Properties : EnablePerformanceInsights : true PerformanceInsightsKMSKeyId : \"something\"","title":"Secure Example"},{"location":"checks/rds/enable-performance-insights/#related-links","text":"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.htm","title":"Related Links"},{"location":"checks/rds/encrypt-cluster-storage-data/","text":"Explanation Encryption should be enabled for an RDS Aurora cluster. When enabling encryption by setting the kms_key_id, the storage_encrypted must also be set to true. Possible Impact Data can be read from the RDS cluster if it is compromised Suggested Resolution Enable encryption for RDS clusters Insecure Example The following example will fail the AVD-AWS-0079 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of rds sgr Resources : Cluster : Type : AWS::RDS::DBCluster Properties : StorageEncrypted : false Secure Example The following example will pass the AVD-AWS-0079 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of rds sgr Resources : Cluster : Type : AWS::RDS::DBCluster Properties : StorageEncrypted : true KmsKeyId : \"something\" Related Links https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html","title":"encrypt-cluster-storage-data"},{"location":"checks/rds/encrypt-cluster-storage-data/#explanation","text":"Encryption should be enabled for an RDS Aurora cluster. When enabling encryption by setting the kms_key_id, the storage_encrypted must also be set to true.","title":"Explanation"},{"location":"checks/rds/encrypt-cluster-storage-data/#possible-impact","text":"Data can be read from the RDS cluster if it is compromised","title":"Possible Impact"},{"location":"checks/rds/encrypt-cluster-storage-data/#suggested-resolution","text":"Enable encryption for RDS clusters","title":"Suggested Resolution"},{"location":"checks/rds/encrypt-cluster-storage-data/#insecure-example","text":"The following example will fail the AVD-AWS-0079 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of rds sgr Resources : Cluster : Type : AWS::RDS::DBCluster Properties : StorageEncrypted : false","title":"Insecure Example"},{"location":"checks/rds/encrypt-cluster-storage-data/#secure-example","text":"The following example will pass the AVD-AWS-0079 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of rds sgr Resources : Cluster : Type : AWS::RDS::DBCluster Properties : StorageEncrypted : true KmsKeyId : \"something\"","title":"Secure Example"},{"location":"checks/rds/encrypt-cluster-storage-data/#related-links","text":"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html","title":"Related Links"},{"location":"checks/rds/encrypt-instance-storage-data/","text":"Explanation Encryption should be enabled for an RDS Database instances. When enabling encryption by setting the kms_key_id. Possible Impact Data can be read from RDS instances if compromised Suggested Resolution Enable encryption for RDS instances Insecure Example The following example will fail the AVD-AWS-0080 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of rds sgr Resources : Instance : Type : AWS::RDS::DBInstance Properties : StorageEncrypted : false Secure Example The following example will pass the AVD-AWS-0080 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of rds sgr Resources : Instance : Type : AWS::RDS::DBInstance Properties : StorageEncrypted : true KmsKeyId : \"something\" Related Links https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html","title":"encrypt-instance-storage-data"},{"location":"checks/rds/encrypt-instance-storage-data/#explanation","text":"Encryption should be enabled for an RDS Database instances. When enabling encryption by setting the kms_key_id.","title":"Explanation"},{"location":"checks/rds/encrypt-instance-storage-data/#possible-impact","text":"Data can be read from RDS instances if compromised","title":"Possible Impact"},{"location":"checks/rds/encrypt-instance-storage-data/#suggested-resolution","text":"Enable encryption for RDS instances","title":"Suggested Resolution"},{"location":"checks/rds/encrypt-instance-storage-data/#insecure-example","text":"The following example will fail the AVD-AWS-0080 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of rds sgr Resources : Instance : Type : AWS::RDS::DBInstance Properties : StorageEncrypted : false","title":"Insecure Example"},{"location":"checks/rds/encrypt-instance-storage-data/#secure-example","text":"The following example will pass the AVD-AWS-0080 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of rds sgr Resources : Instance : Type : AWS::RDS::DBInstance Properties : StorageEncrypted : true KmsKeyId : \"something\"","title":"Secure Example"},{"location":"checks/rds/encrypt-instance-storage-data/#related-links","text":"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.Encryption.html","title":"Related Links"},{"location":"checks/rds/no-classic-resources/","text":"Explanation AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead. Possible Impact Classic resources are running in a shared environment with other customers Suggested Resolution Switch to VPC resources Insecure Example The following example will fail the AVD-AWS-0081 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of rds sgr Resources : Queue : Type : AWS::RDS::DBSecurityGroup Properties : Description : \"\" Secure Example The following example will pass the AVD-AWS-0081 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of rds sgr Resources : Related Links https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html","title":"no-classic-resources"},{"location":"checks/rds/no-classic-resources/#explanation","text":"AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead.","title":"Explanation"},{"location":"checks/rds/no-classic-resources/#possible-impact","text":"Classic resources are running in a shared environment with other customers","title":"Possible Impact"},{"location":"checks/rds/no-classic-resources/#suggested-resolution","text":"Switch to VPC resources","title":"Suggested Resolution"},{"location":"checks/rds/no-classic-resources/#insecure-example","text":"The following example will fail the AVD-AWS-0081 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of rds sgr Resources : Queue : Type : AWS::RDS::DBSecurityGroup Properties : Description : \"\"","title":"Insecure Example"},{"location":"checks/rds/no-classic-resources/#secure-example","text":"The following example will pass the AVD-AWS-0081 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of rds sgr Resources :","title":"Secure Example"},{"location":"checks/rds/no-classic-resources/#related-links","text":"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html","title":"Related Links"},{"location":"checks/rds/no-public-db-access/","text":"Explanation Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function. Possible Impact The database instance is publicly accessible Suggested Resolution Set the database to not be publicly accessible Insecure Example The following example will fail the AVD-AWS-0082 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Queue : Type : AWS::RDS::DBInstance Properties : PubliclyAccessible : true Secure Example The following example will pass the AVD-AWS-0082 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Queue : Type : AWS::RDS::DBInstance Properties : PubliclyAccessible : false Related Links https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_VPC.WorkingWithRDSInstanceinaVPC.html#USER_VPC.Hiding","title":"no-public-db-access"},{"location":"checks/rds/no-public-db-access/#explanation","text":"Database resources should not publicly available. You should limit all access to the minimum that is required for your application to function.","title":"Explanation"},{"location":"checks/rds/no-public-db-access/#possible-impact","text":"The database instance is publicly accessible","title":"Possible Impact"},{"location":"checks/rds/no-public-db-access/#suggested-resolution","text":"Set the database to not be publicly accessible","title":"Suggested Resolution"},{"location":"checks/rds/no-public-db-access/#insecure-example","text":"The following example will fail the AVD-AWS-0082 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Queue : Type : AWS::RDS::DBInstance Properties : PubliclyAccessible : true","title":"Insecure Example"},{"location":"checks/rds/no-public-db-access/#secure-example","text":"The following example will pass the AVD-AWS-0082 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Queue : Type : AWS::RDS::DBInstance Properties : PubliclyAccessible : false","title":"Secure Example"},{"location":"checks/rds/no-public-db-access/#related-links","text":"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_VPC.WorkingWithRDSInstanceinaVPC.html#USER_VPC.Hiding","title":"Related Links"},{"location":"checks/rds/specify-backup-retention/","text":"Explanation RDS backup retention for clusters defaults to 1 day, this may not be enough to identify and respond to an issue. Backup retention periods should be set to a period that is a balance on cost and limiting risk. Possible Impact Potential loss of data and short opportunity for recovery Suggested Resolution Explicitly set the retention period to greater than the default Insecure Example The following example will fail the AVD-AWS-0077 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Queue : Type : AWS::RDS::DBInstance Properties : Secure Example The following example will pass the AVD-AWS-0077 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Queue : Type : AWS::RDS::DBInstance Properties : BackupRetentionPeriod : 30 Related Links https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html#USER_WorkingWithAutomatedBackups.BackupRetention","title":"specify-backup-retention"},{"location":"checks/rds/specify-backup-retention/#explanation","text":"RDS backup retention for clusters defaults to 1 day, this may not be enough to identify and respond to an issue. Backup retention periods should be set to a period that is a balance on cost and limiting risk.","title":"Explanation"},{"location":"checks/rds/specify-backup-retention/#possible-impact","text":"Potential loss of data and short opportunity for recovery","title":"Possible Impact"},{"location":"checks/rds/specify-backup-retention/#suggested-resolution","text":"Explicitly set the retention period to greater than the default","title":"Suggested Resolution"},{"location":"checks/rds/specify-backup-retention/#insecure-example","text":"The following example will fail the AVD-AWS-0077 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example Resources : Queue : Type : AWS::RDS::DBInstance Properties :","title":"Insecure Example"},{"location":"checks/rds/specify-backup-retention/#secure-example","text":"The following example will pass the AVD-AWS-0077 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example Resources : Queue : Type : AWS::RDS::DBInstance Properties : BackupRetentionPeriod : 30","title":"Secure Example"},{"location":"checks/rds/specify-backup-retention/#related-links","text":"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithAutomatedBackups.html#USER_WorkingWithAutomatedBackups.BackupRetention","title":"Related Links"},{"location":"checks/redshift/add-description-to-security-group/","text":"Explanation Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups and rules Insecure Example The following example will fail the AVD-AWS-0083 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift sgr Resources : Queue : Type : AWS::Redshift::ClusterSecurityGroup Properties : Description : \"\" Secure Example The following example will pass the AVD-AWS-0083 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of redshift sgr Resources : Queue : Type : AWS::Redshift::ClusterSecurityGroup Properties : Description : \"Disallow bad stuff\" Related Links https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"add-description-to-security-group"},{"location":"checks/redshift/add-description-to-security-group/#explanation","text":"Security groups and security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.","title":"Explanation"},{"location":"checks/redshift/add-description-to-security-group/#possible-impact","text":"Descriptions provide context for the firewall rule reasons","title":"Possible Impact"},{"location":"checks/redshift/add-description-to-security-group/#suggested-resolution","text":"Add descriptions for all security groups and rules","title":"Suggested Resolution"},{"location":"checks/redshift/add-description-to-security-group/#insecure-example","text":"The following example will fail the AVD-AWS-0083 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift sgr Resources : Queue : Type : AWS::Redshift::ClusterSecurityGroup Properties : Description : \"\"","title":"Insecure Example"},{"location":"checks/redshift/add-description-to-security-group/#secure-example","text":"The following example will pass the AVD-AWS-0083 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of redshift sgr Resources : Queue : Type : AWS::Redshift::ClusterSecurityGroup Properties : Description : \"Disallow bad stuff\"","title":"Secure Example"},{"location":"checks/redshift/add-description-to-security-group/#related-links","text":"https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"Related Links"},{"location":"checks/redshift/encryption-customer-key/","text":"Explanation Redshift clusters that contain sensitive data or are subject to regulation should be encrypted at rest to prevent data leakage should the infrastructure be compromised. Possible Impact Data may be leaked if infrastructure is compromised Suggested Resolution Enable encryption using CMK Insecure Example The following example will fail the AVD-AWS-0084 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift cluster Resources : Queue : Type : AWS::Redshift::Cluster Properties : Encrypted : true Secure Example The following example will pass the AVD-AWS-0084 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift cluster Resources : Queue : Type : AWS::Redshift::Cluster Properties : Encrypted : true KmsKeyId : \"something\" Related Links https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html","title":"encryption-customer-key"},{"location":"checks/redshift/encryption-customer-key/#explanation","text":"Redshift clusters that contain sensitive data or are subject to regulation should be encrypted at rest to prevent data leakage should the infrastructure be compromised.","title":"Explanation"},{"location":"checks/redshift/encryption-customer-key/#possible-impact","text":"Data may be leaked if infrastructure is compromised","title":"Possible Impact"},{"location":"checks/redshift/encryption-customer-key/#suggested-resolution","text":"Enable encryption using CMK","title":"Suggested Resolution"},{"location":"checks/redshift/encryption-customer-key/#insecure-example","text":"The following example will fail the AVD-AWS-0084 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift cluster Resources : Queue : Type : AWS::Redshift::Cluster Properties : Encrypted : true","title":"Insecure Example"},{"location":"checks/redshift/encryption-customer-key/#secure-example","text":"The following example will pass the AVD-AWS-0084 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift cluster Resources : Queue : Type : AWS::Redshift::Cluster Properties : Encrypted : true KmsKeyId : \"something\"","title":"Secure Example"},{"location":"checks/redshift/encryption-customer-key/#related-links","text":"https://docs.aws.amazon.com/redshift/latest/mgmt/working-with-db-encryption.html","title":"Related Links"},{"location":"checks/redshift/no-classic-resources/","text":"Explanation AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead. Possible Impact Classic resources are running in a shared environment with other customers Suggested Resolution Switch to VPC resources Insecure Example The following example will fail the AVD-AWS-0085 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift sgr Resources : Queue : Type : AWS::Redshift::ClusterSecurityGroup Properties : Description : \"\" Secure Example The following example will pass the AVD-AWS-0085 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of redshift sgr Resources : Related Links https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html","title":"no-classic-resources"},{"location":"checks/redshift/no-classic-resources/#explanation","text":"AWS Classic resources run in a shared environment with infrastructure owned by other AWS customers. You should run resources in a VPC instead.","title":"Explanation"},{"location":"checks/redshift/no-classic-resources/#possible-impact","text":"Classic resources are running in a shared environment with other customers","title":"Possible Impact"},{"location":"checks/redshift/no-classic-resources/#suggested-resolution","text":"Switch to VPC resources","title":"Suggested Resolution"},{"location":"checks/redshift/no-classic-resources/#insecure-example","text":"The following example will fail the AVD-AWS-0085 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift sgr Resources : Queue : Type : AWS::Redshift::ClusterSecurityGroup Properties : Description : \"\"","title":"Insecure Example"},{"location":"checks/redshift/no-classic-resources/#secure-example","text":"The following example will pass the AVD-AWS-0085 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of redshift sgr Resources :","title":"Secure Example"},{"location":"checks/redshift/no-classic-resources/#related-links","text":"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-classic-platform.html","title":"Related Links"},{"location":"checks/redshift/use-vpc/","text":"Explanation Redshift clusters that are created without subnet details will be created in EC2 classic mode, meaning that they will be outside of a known VPC and running in tennant. In order to benefit from the additional security features achieved with using an owned VPC, the subnet should be set. Possible Impact Redshift cluster does not benefit from VPC security if it is deployed in EC2 classic mode Suggested Resolution Deploy Redshift cluster into a non default VPC Insecure Example The following example will fail the AVD-AWS-0085 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift cluster Resources : Queue : Type : AWS::Redshift::Cluster Properties : ClusterSubnetGroupName : \"\" Secure Example The following example will pass the AVD-AWS-0085 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift cluster Resources : Queue : Type : AWS::Redshift::Cluster Properties : ClusterSubnetGroupName : \"my-subnet-group\" Related Links https://docs.aws.amazon.com/redshift/latest/mgmt/managing-clusters-vpc.html","title":"use-vpc"},{"location":"checks/redshift/use-vpc/#explanation","text":"Redshift clusters that are created without subnet details will be created in EC2 classic mode, meaning that they will be outside of a known VPC and running in tennant. In order to benefit from the additional security features achieved with using an owned VPC, the subnet should be set.","title":"Explanation"},{"location":"checks/redshift/use-vpc/#possible-impact","text":"Redshift cluster does not benefit from VPC security if it is deployed in EC2 classic mode","title":"Possible Impact"},{"location":"checks/redshift/use-vpc/#suggested-resolution","text":"Deploy Redshift cluster into a non default VPC","title":"Suggested Resolution"},{"location":"checks/redshift/use-vpc/#insecure-example","text":"The following example will fail the AVD-AWS-0085 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift cluster Resources : Queue : Type : AWS::Redshift::Cluster Properties : ClusterSubnetGroupName : \"\"","title":"Insecure Example"},{"location":"checks/redshift/use-vpc/#secure-example","text":"The following example will pass the AVD-AWS-0085 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of redshift cluster Resources : Queue : Type : AWS::Redshift::Cluster Properties : ClusterSubnetGroupName : \"my-subnet-group\"","title":"Secure Example"},{"location":"checks/redshift/use-vpc/#related-links","text":"https://docs.aws.amazon.com/redshift/latest/mgmt/managing-clusters-vpc.html","title":"Related Links"},{"location":"checks/s3/block-public-acls/","text":"Explanation S3 buckets should block public ACLs on buckets and any objects they contain. By blocking, PUTs with fail if the object has any public ACL a. Possible Impact PUT calls with public ACLs specified can make objects public Suggested Resolution Enable blocking any PUT calls with a public ACL specified Insecure Example The following example will fail the AVD-AWS-0086 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket Secure Example The following example will pass the AVD-AWS-0086 check. --- Resources : GoodExample : Properties : PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket Related Links https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"block-public-acls"},{"location":"checks/s3/block-public-acls/#explanation","text":"S3 buckets should block public ACLs on buckets and any objects they contain. By blocking, PUTs with fail if the object has any public ACL a.","title":"Explanation"},{"location":"checks/s3/block-public-acls/#possible-impact","text":"PUT calls with public ACLs specified can make objects public","title":"Possible Impact"},{"location":"checks/s3/block-public-acls/#suggested-resolution","text":"Enable blocking any PUT calls with a public ACL specified","title":"Suggested Resolution"},{"location":"checks/s3/block-public-acls/#insecure-example","text":"The following example will fail the AVD-AWS-0086 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket","title":"Insecure Example"},{"location":"checks/s3/block-public-acls/#secure-example","text":"The following example will pass the AVD-AWS-0086 check. --- Resources : GoodExample : Properties : PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket","title":"Secure Example"},{"location":"checks/s3/block-public-acls/#related-links","text":"https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/s3/block-public-policy/","text":"Explanation S3 bucket policy should have block public policy to prevent users from putting a policy that enable public access. Possible Impact Users could put a policy that allows public access Suggested Resolution Prevent policies that allow public access being PUT Insecure Example The following example will fail the AVD-AWS-0087 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket Secure Example The following example will pass the AVD-AWS-0087 check. --- Resources : GoodExample : Properties : PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket Related Links https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html","title":"block-public-policy"},{"location":"checks/s3/block-public-policy/#explanation","text":"S3 bucket policy should have block public policy to prevent users from putting a policy that enable public access.","title":"Explanation"},{"location":"checks/s3/block-public-policy/#possible-impact","text":"Users could put a policy that allows public access","title":"Possible Impact"},{"location":"checks/s3/block-public-policy/#suggested-resolution","text":"Prevent policies that allow public access being PUT","title":"Suggested Resolution"},{"location":"checks/s3/block-public-policy/#insecure-example","text":"The following example will fail the AVD-AWS-0087 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket","title":"Insecure Example"},{"location":"checks/s3/block-public-policy/#secure-example","text":"The following example will pass the AVD-AWS-0087 check. --- Resources : GoodExample : Properties : PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket","title":"Secure Example"},{"location":"checks/s3/block-public-policy/#related-links","text":"https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/s3/enable-bucket-encryption/","text":"Explanation S3 Buckets should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific buckets. Possible Impact The bucket objects could be read if compromised Suggested Resolution Configure bucket encryption Insecure Example The following example will fail the AVD-AWS-0088 check. --- Resources : BadExample : Properties : BucketEncryption : ServerSideEncryptionConfiguration : - BucketKeyEnabled : false ServerSideEncryptionByDefault : KMSMasterKeyID : asdf SSEAlgorithm : asdf Type : AWS::S3::Bucket Secure Example The following example will pass the AVD-AWS-0088 check. Resources : GoodExample : Properties : BucketEncryption : ServerSideEncryptionConfiguration : - BucketKeyEnabled : true ServerSideEncryptionByDefault : SSEAlgorithm : AES256 Type : AWS::S3::Bucket Related Links https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-encryption.html","title":"enable-bucket-encryption"},{"location":"checks/s3/enable-bucket-encryption/#explanation","text":"S3 Buckets should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific buckets.","title":"Explanation"},{"location":"checks/s3/enable-bucket-encryption/#possible-impact","text":"The bucket objects could be read if compromised","title":"Possible Impact"},{"location":"checks/s3/enable-bucket-encryption/#suggested-resolution","text":"Configure bucket encryption","title":"Suggested Resolution"},{"location":"checks/s3/enable-bucket-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0088 check. --- Resources : BadExample : Properties : BucketEncryption : ServerSideEncryptionConfiguration : - BucketKeyEnabled : false ServerSideEncryptionByDefault : KMSMasterKeyID : asdf SSEAlgorithm : asdf Type : AWS::S3::Bucket","title":"Insecure Example"},{"location":"checks/s3/enable-bucket-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0088 check. Resources : GoodExample : Properties : BucketEncryption : ServerSideEncryptionConfiguration : - BucketKeyEnabled : true ServerSideEncryptionByDefault : SSEAlgorithm : AES256 Type : AWS::S3::Bucket","title":"Secure Example"},{"location":"checks/s3/enable-bucket-encryption/#related-links","text":"https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-encryption.html","title":"Related Links"},{"location":"checks/s3/enable-bucket-logging/","text":"Explanation Buckets should have logging enabled so that access can be audited. Possible Impact There is no way to determine the access to this bucket Suggested Resolution Add a logging block to the resource to enable access logging Insecure Example The following example will fail the AVD-AWS-0089 check. --- Resources : DisabledEncryptionBucket : Properties : Type : AWS::S3::Bucket Secure Example The following example will pass the AVD-AWS-0089 check. --- Resources : GoodExample : Properties : LoggingConfiguration : DestinationBucketName : logging-bucket LogFilePrefix : accesslogs/ Type : AWS::S3::Bucket Related Links https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html","title":"enable-bucket-logging"},{"location":"checks/s3/enable-bucket-logging/#explanation","text":"Buckets should have logging enabled so that access can be audited.","title":"Explanation"},{"location":"checks/s3/enable-bucket-logging/#possible-impact","text":"There is no way to determine the access to this bucket","title":"Possible Impact"},{"location":"checks/s3/enable-bucket-logging/#suggested-resolution","text":"Add a logging block to the resource to enable access logging","title":"Suggested Resolution"},{"location":"checks/s3/enable-bucket-logging/#insecure-example","text":"The following example will fail the AVD-AWS-0089 check. --- Resources : DisabledEncryptionBucket : Properties : Type : AWS::S3::Bucket","title":"Insecure Example"},{"location":"checks/s3/enable-bucket-logging/#secure-example","text":"The following example will pass the AVD-AWS-0089 check. --- Resources : GoodExample : Properties : LoggingConfiguration : DestinationBucketName : logging-bucket LogFilePrefix : accesslogs/ Type : AWS::S3::Bucket","title":"Secure Example"},{"location":"checks/s3/enable-bucket-logging/#related-links","text":"https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html","title":"Related Links"},{"location":"checks/s3/enable-versioning/","text":"Explanation Versioning in Amazon S3 is a means of keeping multiple variants of an object in the same bucket. You can use the S3 Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures. Possible Impact Deleted or modified data would not be recoverable Suggested Resolution Enable versioning to protect against accidental/malicious removal or modification Insecure Example The following example will fail the AVD-AWS-0090 check. --- Resources : BadExample : Type : AWS::S3::Bucket Secure Example The following example will pass the AVD-AWS-0090 check. --- Resources : GoodExample : Properties : VersioningConfiguration : Status : Enabled Type : AWS::S3::Bucket Related Links https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html","title":"enable-versioning"},{"location":"checks/s3/enable-versioning/#explanation","text":"Versioning in Amazon S3 is a means of keeping multiple variants of an object in the same bucket. You can use the S3 Versioning feature to preserve, retrieve, and restore every version of every object stored in your buckets. With versioning you can recover more easily from both unintended user actions and application failures.","title":"Explanation"},{"location":"checks/s3/enable-versioning/#possible-impact","text":"Deleted or modified data would not be recoverable","title":"Possible Impact"},{"location":"checks/s3/enable-versioning/#suggested-resolution","text":"Enable versioning to protect against accidental/malicious removal or modification","title":"Suggested Resolution"},{"location":"checks/s3/enable-versioning/#insecure-example","text":"The following example will fail the AVD-AWS-0090 check. --- Resources : BadExample : Type : AWS::S3::Bucket","title":"Insecure Example"},{"location":"checks/s3/enable-versioning/#secure-example","text":"The following example will pass the AVD-AWS-0090 check. --- Resources : GoodExample : Properties : VersioningConfiguration : Status : Enabled Type : AWS::S3::Bucket","title":"Secure Example"},{"location":"checks/s3/enable-versioning/#related-links","text":"https://docs.aws.amazon.com/AmazonS3/latest/userguide/Versioning.html","title":"Related Links"},{"location":"checks/s3/ignore-public-acls/","text":"Explanation S3 buckets should ignore public ACLs on buckets and any objects they contain. By ignoring rather than blocking, PUT calls with public ACLs will still be applied but the ACL will be ignored. Possible Impact PUT calls with public ACLs specified can make objects public Suggested Resolution Enable ignoring the application of public ACLs in PUT calls Insecure Example The following example will fail the AVD-AWS-0091 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket Secure Example The following example will pass the AVD-AWS-0091 check. --- Resources : GoodExample : Properties : AccessControl : Private PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket Related Links https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"ignore-public-acls"},{"location":"checks/s3/ignore-public-acls/#explanation","text":"S3 buckets should ignore public ACLs on buckets and any objects they contain. By ignoring rather than blocking, PUT calls with public ACLs will still be applied but the ACL will be ignored.","title":"Explanation"},{"location":"checks/s3/ignore-public-acls/#possible-impact","text":"PUT calls with public ACLs specified can make objects public","title":"Possible Impact"},{"location":"checks/s3/ignore-public-acls/#suggested-resolution","text":"Enable ignoring the application of public ACLs in PUT calls","title":"Suggested Resolution"},{"location":"checks/s3/ignore-public-acls/#insecure-example","text":"The following example will fail the AVD-AWS-0091 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket","title":"Insecure Example"},{"location":"checks/s3/ignore-public-acls/#secure-example","text":"The following example will pass the AVD-AWS-0091 check. --- Resources : GoodExample : Properties : AccessControl : Private PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket","title":"Secure Example"},{"location":"checks/s3/ignore-public-acls/#related-links","text":"https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/s3/no-public-access-with-acl/","text":"Explanation Buckets should have logging enabled so that access can be audited. Possible Impact There is no way to determine the access to this bucket Suggested Resolution Add a logging block to the resource to enable access logging Insecure Example The following example will fail the AVD-AWS-0092 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket Secure Example The following example will pass the AVD-AWS-0092 check. --- Resources : GoodExample : Properties : AccessControl : Private Type : AWS::S3::Bucket Related Links https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html","title":"no-public-access-with-acl"},{"location":"checks/s3/no-public-access-with-acl/#explanation","text":"Buckets should have logging enabled so that access can be audited.","title":"Explanation"},{"location":"checks/s3/no-public-access-with-acl/#possible-impact","text":"There is no way to determine the access to this bucket","title":"Possible Impact"},{"location":"checks/s3/no-public-access-with-acl/#suggested-resolution","text":"Add a logging block to the resource to enable access logging","title":"Suggested Resolution"},{"location":"checks/s3/no-public-access-with-acl/#insecure-example","text":"The following example will fail the AVD-AWS-0092 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket","title":"Insecure Example"},{"location":"checks/s3/no-public-access-with-acl/#secure-example","text":"The following example will pass the AVD-AWS-0092 check. --- Resources : GoodExample : Properties : AccessControl : Private Type : AWS::S3::Bucket","title":"Secure Example"},{"location":"checks/s3/no-public-access-with-acl/#related-links","text":"https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html","title":"Related Links"},{"location":"checks/s3/no-public-buckets/","text":"Explanation S3 buckets should restrict public policies for the bucket. By enabling, the restrict_public_buckets, only the bucket owner and AWS Services can access if it has a public policy. Possible Impact Public buckets can be accessed by anyone Suggested Resolution Limit the access to public buckets to only the owner or AWS Services (eg; CloudFront) Insecure Example The following example will fail the AVD-AWS-0093 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket Secure Example The following example will pass the AVD-AWS-0093 check. --- Resources : GoodExample : Properties : PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket Related Links https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html","title":"no-public-buckets"},{"location":"checks/s3/no-public-buckets/#explanation","text":"S3 buckets should restrict public policies for the bucket. By enabling, the restrict_public_buckets, only the bucket owner and AWS Services can access if it has a public policy.","title":"Explanation"},{"location":"checks/s3/no-public-buckets/#possible-impact","text":"Public buckets can be accessed by anyone","title":"Possible Impact"},{"location":"checks/s3/no-public-buckets/#suggested-resolution","text":"Limit the access to public buckets to only the owner or AWS Services (eg; CloudFront)","title":"Suggested Resolution"},{"location":"checks/s3/no-public-buckets/#insecure-example","text":"The following example will fail the AVD-AWS-0093 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket","title":"Insecure Example"},{"location":"checks/s3/no-public-buckets/#secure-example","text":"The following example will pass the AVD-AWS-0093 check. --- Resources : GoodExample : Properties : PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket","title":"Secure Example"},{"location":"checks/s3/no-public-buckets/#related-links","text":"https://docs.aws.amazon.com/AmazonS3/latest/dev-retired/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/s3/specify-public-access-block/","text":"Explanation The \"block public access\" settings in S3 override individual policies that apply to a given bucket, meaning that all public access can be controlled in one central types for that bucket. It is therefore good practice to define these settings for each bucket in order to clearly define the public access that can be allowed for it. Possible Impact Public access policies may be applied to sensitive data buckets Suggested Resolution Define a aws_s3_bucket_public_access_block for the given bucket to control public access policies Insecure Example The following example will fail the AVD-AWS-0094 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket Secure Example The following example will pass the AVD-AWS-0094 check. --- Resources : GoodExample : Properties : AccessControl : Private PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket Related Links https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"specify-public-access-block"},{"location":"checks/s3/specify-public-access-block/#explanation","text":"The \"block public access\" settings in S3 override individual policies that apply to a given bucket, meaning that all public access can be controlled in one central types for that bucket. It is therefore good practice to define these settings for each bucket in order to clearly define the public access that can be allowed for it.","title":"Explanation"},{"location":"checks/s3/specify-public-access-block/#possible-impact","text":"Public access policies may be applied to sensitive data buckets","title":"Possible Impact"},{"location":"checks/s3/specify-public-access-block/#suggested-resolution","text":"Define a aws_s3_bucket_public_access_block for the given bucket to control public access policies","title":"Suggested Resolution"},{"location":"checks/s3/specify-public-access-block/#insecure-example","text":"The following example will fail the AVD-AWS-0094 check. --- Resources : BadExample : Properties : AccessControl : AuthenticatedRead Type : AWS::S3::Bucket","title":"Insecure Example"},{"location":"checks/s3/specify-public-access-block/#secure-example","text":"The following example will pass the AVD-AWS-0094 check. --- Resources : GoodExample : Properties : AccessControl : Private PublicAccessBlockConfiguration : BlockPublicAcls : true BlockPublicPolicy : true IgnorePublicAcls : true RestrictPublicBuckets : true Type : AWS::S3::Bucket","title":"Secure Example"},{"location":"checks/s3/specify-public-access-block/#related-links","text":"https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html","title":"Related Links"},{"location":"checks/sam/api-use-secure-tls-policy/","text":"Explanation You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+. Possible Impact Outdated SSL policies increase exposure to known vulnerabilities Suggested Resolution Use the most modern TLS/SSL policies available Insecure Example The following example will fail the AVD-AWS-0112 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Bad SAM API example StageName : Prod TracingEnabled : false Secure Example The following example will pass the AVD-AWS-0112 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Good SAM API example StageName : Prod TracingEnabled : false Domain : SecurityPolicy : TLS_1_2 Related Links https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-property-api-domainconfiguration.html#sam-api-domainconfiguration-securitypolicy","title":"api-use-secure-tls-policy"},{"location":"checks/sam/api-use-secure-tls-policy/#explanation","text":"You should not use outdated/insecure TLS versions for encryption. You should be using TLS v1.2+.","title":"Explanation"},{"location":"checks/sam/api-use-secure-tls-policy/#possible-impact","text":"Outdated SSL policies increase exposure to known vulnerabilities","title":"Possible Impact"},{"location":"checks/sam/api-use-secure-tls-policy/#suggested-resolution","text":"Use the most modern TLS/SSL policies available","title":"Suggested Resolution"},{"location":"checks/sam/api-use-secure-tls-policy/#insecure-example","text":"The following example will fail the AVD-AWS-0112 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Bad SAM API example StageName : Prod TracingEnabled : false","title":"Insecure Example"},{"location":"checks/sam/api-use-secure-tls-policy/#secure-example","text":"The following example will pass the AVD-AWS-0112 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Good SAM API example StageName : Prod TracingEnabled : false Domain : SecurityPolicy : TLS_1_2","title":"Secure Example"},{"location":"checks/sam/api-use-secure-tls-policy/#related-links","text":"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-property-api-domainconfiguration.html#sam-api-domainconfiguration-securitypolicy","title":"Related Links"},{"location":"checks/sam/enable-api-access-logging/","text":"Explanation API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages. Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for API Gateway stages Insecure Example The following example will fail the AVD-AWS-0113 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Bad SAM API example StageName : Prod TracingEnabled : false Secure Example The following example will pass the AVD-AWS-0113 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Good SAM API example StageName : Prod TracingEnabled : false Domain : SecurityPolicy : TLS_1_2 AccessLogSetting : DestinationArn : gateway-logging Format : json Related Links https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-api.html#sam-api-accesslogsetting","title":"enable-api-access-logging"},{"location":"checks/sam/enable-api-access-logging/#explanation","text":"API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages.","title":"Explanation"},{"location":"checks/sam/enable-api-access-logging/#possible-impact","text":"Logging provides vital information about access and usage","title":"Possible Impact"},{"location":"checks/sam/enable-api-access-logging/#suggested-resolution","text":"Enable logging for API Gateway stages","title":"Suggested Resolution"},{"location":"checks/sam/enable-api-access-logging/#insecure-example","text":"The following example will fail the AVD-AWS-0113 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Bad SAM API example StageName : Prod TracingEnabled : false","title":"Insecure Example"},{"location":"checks/sam/enable-api-access-logging/#secure-example","text":"The following example will pass the AVD-AWS-0113 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Good SAM API example StageName : Prod TracingEnabled : false Domain : SecurityPolicy : TLS_1_2 AccessLogSetting : DestinationArn : gateway-logging Format : json","title":"Secure Example"},{"location":"checks/sam/enable-api-access-logging/#related-links","text":"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-api.html#sam-api-accesslogsetting","title":"Related Links"},{"location":"checks/sam/enable-api-cache-encryption/","text":"Explanation Method cache encryption ensures that any sensitive data in the cache is not vulnerable to compromise in the event of interception Possible Impact Data stored in the cache that is unencrypted may be vulnerable to compromise Suggested Resolution Enable cache encryption Insecure Example The following example will fail the AVD-AWS-0110 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Bad SAM API example StageName : Prod TracingEnabled : false Secure Example The following example will pass the AVD-AWS-0110 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Good SAM API example StageName : Prod TracingEnabled : false Domain : SecurityPolicy : TLS_1_2 MethodSettings : CacheDataEncrypted : true Related Links https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-apigateway-stage-methodsetting.html#cfn-apigateway-stage-methodsetting-cachedataencrypted","title":"enable-api-cache-encryption"},{"location":"checks/sam/enable-api-cache-encryption/#explanation","text":"Method cache encryption ensures that any sensitive data in the cache is not vulnerable to compromise in the event of interception","title":"Explanation"},{"location":"checks/sam/enable-api-cache-encryption/#possible-impact","text":"Data stored in the cache that is unencrypted may be vulnerable to compromise","title":"Possible Impact"},{"location":"checks/sam/enable-api-cache-encryption/#suggested-resolution","text":"Enable cache encryption","title":"Suggested Resolution"},{"location":"checks/sam/enable-api-cache-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0110 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Bad SAM API example StageName : Prod TracingEnabled : false","title":"Insecure Example"},{"location":"checks/sam/enable-api-cache-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0110 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Good SAM API example StageName : Prod TracingEnabled : false Domain : SecurityPolicy : TLS_1_2 MethodSettings : CacheDataEncrypted : true","title":"Secure Example"},{"location":"checks/sam/enable-api-cache-encryption/#related-links","text":"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-apigateway-stage-methodsetting.html#cfn-apigateway-stage-methodsetting-cachedataencrypted","title":"Related Links"},{"location":"checks/sam/enable-api-tracing/","text":"Explanation X-Ray tracing enables end-to-end debugging and analysis of all API Gateway HTTP requests. Possible Impact Without full tracing enabled it is difficult to trace the flow of logs Suggested Resolution Enable tracing Insecure Example The following example will fail the AVD-AWS-0111 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Bad SAM API example StageName : Prod TracingEnabled : false Secure Example The following example will pass the AVD-AWS-0111 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Good SAM API example StageName : Prod TracingEnabled : true Related Links https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-api.html#sam-api-tracingenabled","title":"enable-api-tracing"},{"location":"checks/sam/enable-api-tracing/#explanation","text":"X-Ray tracing enables end-to-end debugging and analysis of all API Gateway HTTP requests.","title":"Explanation"},{"location":"checks/sam/enable-api-tracing/#possible-impact","text":"Without full tracing enabled it is difficult to trace the flow of logs","title":"Possible Impact"},{"location":"checks/sam/enable-api-tracing/#suggested-resolution","text":"Enable tracing","title":"Suggested Resolution"},{"location":"checks/sam/enable-api-tracing/#insecure-example","text":"The following example will fail the AVD-AWS-0111 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Bad SAM API example StageName : Prod TracingEnabled : false","title":"Insecure Example"},{"location":"checks/sam/enable-api-tracing/#secure-example","text":"The following example will pass the AVD-AWS-0111 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::Api Properties : Name : Good SAM API example StageName : Prod TracingEnabled : true","title":"Secure Example"},{"location":"checks/sam/enable-api-tracing/#related-links","text":"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-api.html#sam-api-tracingenabled","title":"Related Links"},{"location":"checks/sam/enable-function-tracing/","text":"Explanation X-Ray tracing enables end-to-end debugging and analysis of the function. Possible Impact Without full tracing enabled it is difficult to trace the flow of logs Suggested Resolution Enable tracing Insecure Example The following example will fail the AVD-AWS-0113 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM Function Resources : BadFunction : Type : AWS::Serverless::Function Properties : PackageType : Image ImageUri : account-id.dkr.ecr.region.amazonaws.com/ecr-repo-name:image-name ImageConfig : Command : - \"app.lambda_handler\" EntryPoint : - \"entrypoint1\" WorkingDirectory : \"workDir\" Secure Example The following example will pass the AVD-AWS-0113 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM Function Resources : GoodFunction : Type : AWS::Serverless::Function Properties : PackageType : Image ImageUri : account-id.dkr.ecr.region.amazonaws.com/ecr-repo-name:image-name ImageConfig : Command : - \"app.lambda_handler\" EntryPoint : - \"entrypoint1\" WorkingDirectory : \"workDir\" Tracing : Active Related Links https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html#sam-function-tracing","title":"enable-function-tracing"},{"location":"checks/sam/enable-function-tracing/#explanation","text":"X-Ray tracing enables end-to-end debugging and analysis of the function.","title":"Explanation"},{"location":"checks/sam/enable-function-tracing/#possible-impact","text":"Without full tracing enabled it is difficult to trace the flow of logs","title":"Possible Impact"},{"location":"checks/sam/enable-function-tracing/#suggested-resolution","text":"Enable tracing","title":"Suggested Resolution"},{"location":"checks/sam/enable-function-tracing/#insecure-example","text":"The following example will fail the AVD-AWS-0113 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM Function Resources : BadFunction : Type : AWS::Serverless::Function Properties : PackageType : Image ImageUri : account-id.dkr.ecr.region.amazonaws.com/ecr-repo-name:image-name ImageConfig : Command : - \"app.lambda_handler\" EntryPoint : - \"entrypoint1\" WorkingDirectory : \"workDir\"","title":"Insecure Example"},{"location":"checks/sam/enable-function-tracing/#secure-example","text":"The following example will pass the AVD-AWS-0113 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM Function Resources : GoodFunction : Type : AWS::Serverless::Function Properties : PackageType : Image ImageUri : account-id.dkr.ecr.region.amazonaws.com/ecr-repo-name:image-name ImageConfig : Command : - \"app.lambda_handler\" EntryPoint : - \"entrypoint1\" WorkingDirectory : \"workDir\" Tracing : Active","title":"Secure Example"},{"location":"checks/sam/enable-function-tracing/#related-links","text":"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html#sam-function-tracing","title":"Related Links"},{"location":"checks/sam/enable-http-api-access-logging/","text":"Explanation API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages. Possible Impact Logging provides vital information about access and usage Suggested Resolution Enable logging for API Gateway stages Insecure Example The following example will fail the AVD-AWS-0116 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : HttpApi : Type : AWS::Serverless::HttpApi Properties : Properties : Name : Good SAM API example StageName : Prod Tracing : Passthrough Secure Example The following example will pass the AVD-AWS-0116 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::HttpApi Properties : Name : Good SAM API example StageName : Prod Tracing : Activey AccessLogSetting : DestinationArn : gateway-logging Format : json Related Links https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-httpapi.html#sam-httpapi-accesslogsettings","title":"enable-http-api-access-logging"},{"location":"checks/sam/enable-http-api-access-logging/#explanation","text":"API Gateway stages should have access log settings block configured to track all access to a particular stage. This should be applied to both v1 and v2 gateway stages.","title":"Explanation"},{"location":"checks/sam/enable-http-api-access-logging/#possible-impact","text":"Logging provides vital information about access and usage","title":"Possible Impact"},{"location":"checks/sam/enable-http-api-access-logging/#suggested-resolution","text":"Enable logging for API Gateway stages","title":"Suggested Resolution"},{"location":"checks/sam/enable-http-api-access-logging/#insecure-example","text":"The following example will fail the AVD-AWS-0116 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : HttpApi : Type : AWS::Serverless::HttpApi Properties : Properties : Name : Good SAM API example StageName : Prod Tracing : Passthrough","title":"Insecure Example"},{"location":"checks/sam/enable-http-api-access-logging/#secure-example","text":"The following example will pass the AVD-AWS-0116 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : ApiGatewayApi : Type : AWS::Serverless::HttpApi Properties : Name : Good SAM API example StageName : Prod Tracing : Activey AccessLogSetting : DestinationArn : gateway-logging Format : json","title":"Secure Example"},{"location":"checks/sam/enable-http-api-access-logging/#related-links","text":"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-httpapi.html#sam-httpapi-accesslogsettings","title":"Related Links"},{"location":"checks/sam/enable-state-machine-tracing/","text":"Explanation X-Ray tracing enables end-to-end debugging and analysis of all state machine activities. Possible Impact Without full tracing enabled it is difficult to trace the flow of logs Suggested Resolution Enable tracing Insecure Example The following example will fail the AVD-AWS-0117 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : BadStateMachine : Type : AWS::Serverless::StateMachine Properties : Definition : StartAt : MyLambdaState States : MyLambdaState : Type : Task Resource : arn:aws:lambda:us-east-1:123456123456:function:my-sample-lambda-app End : true Role : arn:aws:iam::123456123456:role/service-role/my-sample-role Tracing : Enabled : false Secure Example The following example will pass the AVD-AWS-0117 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : GoodStateMachine : Type : AWS::Serverless::StateMachine Properties : Definition : StartAt : MyLambdaState States : MyLambdaState : Type : Task Resource : arn:aws:lambda:us-east-1:123456123456:function:my-sample-lambda-app End : true Role : arn:aws:iam::123456123456:role/service-role/my-sample-role Tracing : Enabled : true Related Links https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-statemachine.html#sam-statemachine-tracing","title":"enable-state-machine-tracing"},{"location":"checks/sam/enable-state-machine-tracing/#explanation","text":"X-Ray tracing enables end-to-end debugging and analysis of all state machine activities.","title":"Explanation"},{"location":"checks/sam/enable-state-machine-tracing/#possible-impact","text":"Without full tracing enabled it is difficult to trace the flow of logs","title":"Possible Impact"},{"location":"checks/sam/enable-state-machine-tracing/#suggested-resolution","text":"Enable tracing","title":"Suggested Resolution"},{"location":"checks/sam/enable-state-machine-tracing/#insecure-example","text":"The following example will fail the AVD-AWS-0117 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM API Resources : BadStateMachine : Type : AWS::Serverless::StateMachine Properties : Definition : StartAt : MyLambdaState States : MyLambdaState : Type : Task Resource : arn:aws:lambda:us-east-1:123456123456:function:my-sample-lambda-app End : true Role : arn:aws:iam::123456123456:role/service-role/my-sample-role Tracing : Enabled : false","title":"Insecure Example"},{"location":"checks/sam/enable-state-machine-tracing/#secure-example","text":"The following example will pass the AVD-AWS-0117 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM API Resources : GoodStateMachine : Type : AWS::Serverless::StateMachine Properties : Definition : StartAt : MyLambdaState States : MyLambdaState : Type : Task Resource : arn:aws:lambda:us-east-1:123456123456:function:my-sample-lambda-app End : true Role : arn:aws:iam::123456123456:role/service-role/my-sample-role Tracing : Enabled : true","title":"Secure Example"},{"location":"checks/sam/enable-state-machine-tracing/#related-links","text":"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-statemachine.html#sam-statemachine-tracing","title":"Related Links"},{"location":"checks/sam/enable-table-encryption/","text":"Explanation Encryption should be enabled at all available levels to ensure that data is protected if compromised. Possible Impact Data stored in the table that is unencrypted may be vulnerable to compromise Suggested Resolution Enable server side encryption Insecure Example The following example will fail the AVD-AWS-0121 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM Table Resources : BadFunction : Type : AWS::Serverless::SimpleTable Properties : TableName : Bad Table SSESpecification : SSEEnabled : false Secure Example The following example will pass the AVD-AWS-0121 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM Table Resources : GoodFunction : Type : AWS::Serverless::SimpleTable Properties : TableName : GoodTable SSESpecification : SSEEnabled : true Related Links https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-simpletable.html#sam-simpletable-ssespecification","title":"enable-table-encryption"},{"location":"checks/sam/enable-table-encryption/#explanation","text":"Encryption should be enabled at all available levels to ensure that data is protected if compromised.","title":"Explanation"},{"location":"checks/sam/enable-table-encryption/#possible-impact","text":"Data stored in the table that is unencrypted may be vulnerable to compromise","title":"Possible Impact"},{"location":"checks/sam/enable-table-encryption/#suggested-resolution","text":"Enable server side encryption","title":"Suggested Resolution"},{"location":"checks/sam/enable-table-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0121 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM Table Resources : BadFunction : Type : AWS::Serverless::SimpleTable Properties : TableName : Bad Table SSESpecification : SSEEnabled : false","title":"Insecure Example"},{"location":"checks/sam/enable-table-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0121 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM Table Resources : GoodFunction : Type : AWS::Serverless::SimpleTable Properties : TableName : GoodTable SSESpecification : SSEEnabled : true","title":"Secure Example"},{"location":"checks/sam/enable-table-encryption/#related-links","text":"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-simpletable.html#sam-simpletable-ssespecification","title":"Related Links"},{"location":"checks/sam/no-function-policy-wildcards/","text":"Explanation You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals. Possible Impact Overly permissive policies may grant access to sensitive resources Suggested Resolution Specify the exact permissions required, and to which resources they should apply instead of using wildcards. Insecure Example The following example will fail the AVD-AWS-0114 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM Function Resources : BadFunction : Type : AWS::Serverless::Function Properties : PackageType : Image ImageUri : account-id.dkr.ecr.region.amazonaws.com/ecr-repo-name:image-name ImageConfig : Command : - \"app.lambda_handler\" EntryPoint : - \"entrypoint1\" WorkingDirectory : \"workDir\" Policies : - AWSLambdaExecute - Version : '2012-10-17' Statement : - Effect : Allow Action : - s3:* Resource : 'arn:aws:s3:::my-bucket/*' Secure Example The following example will pass the AVD-AWS-0114 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM Function Resources : GoodFunction : Type : AWS::Serverless::Function Properties : PackageType : Image ImageUri : account-id.dkr.ecr.region.amazonaws.com/ecr-repo-name:image-name ImageConfig : Command : - \"app.lambda_handler\" EntryPoint : - \"entrypoint1\" WorkingDirectory : \"workDir\" Policies : - AWSLambdaExecute - Version : '2012-10-17' Statement : - Effect : Allow Action : - s3:GetObject - s3:GetObjectACL Resource : 'arn:aws:s3:::my-bucket/*' Related Links https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html#sam-function-policies","title":"no-function-policy-wildcards"},{"location":"checks/sam/no-function-policy-wildcards/#explanation","text":"You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals.","title":"Explanation"},{"location":"checks/sam/no-function-policy-wildcards/#possible-impact","text":"Overly permissive policies may grant access to sensitive resources","title":"Possible Impact"},{"location":"checks/sam/no-function-policy-wildcards/#suggested-resolution","text":"Specify the exact permissions required, and to which resources they should apply instead of using wildcards.","title":"Suggested Resolution"},{"location":"checks/sam/no-function-policy-wildcards/#insecure-example","text":"The following example will fail the AVD-AWS-0114 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM Function Resources : BadFunction : Type : AWS::Serverless::Function Properties : PackageType : Image ImageUri : account-id.dkr.ecr.region.amazonaws.com/ecr-repo-name:image-name ImageConfig : Command : - \"app.lambda_handler\" EntryPoint : - \"entrypoint1\" WorkingDirectory : \"workDir\" Policies : - AWSLambdaExecute - Version : '2012-10-17' Statement : - Effect : Allow Action : - s3:* Resource : 'arn:aws:s3:::my-bucket/*'","title":"Insecure Example"},{"location":"checks/sam/no-function-policy-wildcards/#secure-example","text":"The following example will pass the AVD-AWS-0114 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM Function Resources : GoodFunction : Type : AWS::Serverless::Function Properties : PackageType : Image ImageUri : account-id.dkr.ecr.region.amazonaws.com/ecr-repo-name:image-name ImageConfig : Command : - \"app.lambda_handler\" EntryPoint : - \"entrypoint1\" WorkingDirectory : \"workDir\" Policies : - AWSLambdaExecute - Version : '2012-10-17' Statement : - Effect : Allow Action : - s3:GetObject - s3:GetObjectACL Resource : 'arn:aws:s3:::my-bucket/*'","title":"Secure Example"},{"location":"checks/sam/no-function-policy-wildcards/#related-links","text":"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html#sam-function-policies","title":"Related Links"},{"location":"checks/sam/no-state-machine-policy-wildcards/","text":"Explanation You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals. Possible Impact Overly permissive policies may grant access to sensitive resources Suggested Resolution Specify the exact permissions required, and to which resources they should apply instead of using wildcards. Insecure Example The following example will fail the AVD-AWS-0120 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM Function Resources : BadFunction : Type : AWS::Serverless::StateMachine Properties : Definition : StartAt : MyLambdaState States : MyLambdaState : Type : Task Resource : arn:aws:lambda:us-east-1:123456123456:function:my-sample-lambda-app End : true Role : arn:aws:iam::123456123456:role/service-role/my-sample-role Tracing : Enabled : true Policies : - AWSLambdaExecute - Version : '2012-10-17' Statement : - Effect : Allow Action : - s3:* Resource : 'arn:aws:s3:::my-bucket/*' Secure Example The following example will pass the AVD-AWS-0120 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM Function Resources : GoodFunction : Type : AWS::Serverless::StateMachine Properties : Definition : StartAt : MyLambdaState States : MyLambdaState : Type : Task Resource : arn:aws:lambda:us-east-1:123456123456:function:my-sample-lambda-app End : true Role : arn:aws:iam::123456123456:role/service-role/my-sample-role Tracing : Enabled : true Policies : - AWSLambdaExecute - Version : '2012-10-17' Statement : - Effect : Allow Action : - s3:GetObject - s3:GetObjectACL Resource : 'arn:aws:s3:::my-bucket/*' Related Links https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-statemachine.html#sam-statemachine-policies","title":"no-state-machine-policy-wildcards"},{"location":"checks/sam/no-state-machine-policy-wildcards/#explanation","text":"You should use the principle of least privilege when defining your IAM policies. This means you should specify each exact permission required without using wildcards, as this could cause the granting of access to certain undesired actions, resources and principals.","title":"Explanation"},{"location":"checks/sam/no-state-machine-policy-wildcards/#possible-impact","text":"Overly permissive policies may grant access to sensitive resources","title":"Possible Impact"},{"location":"checks/sam/no-state-machine-policy-wildcards/#suggested-resolution","text":"Specify the exact permissions required, and to which resources they should apply instead of using wildcards.","title":"Suggested Resolution"},{"location":"checks/sam/no-state-machine-policy-wildcards/#insecure-example","text":"The following example will fail the AVD-AWS-0120 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad Example of SAM Function Resources : BadFunction : Type : AWS::Serverless::StateMachine Properties : Definition : StartAt : MyLambdaState States : MyLambdaState : Type : Task Resource : arn:aws:lambda:us-east-1:123456123456:function:my-sample-lambda-app End : true Role : arn:aws:iam::123456123456:role/service-role/my-sample-role Tracing : Enabled : true Policies : - AWSLambdaExecute - Version : '2012-10-17' Statement : - Effect : Allow Action : - s3:* Resource : 'arn:aws:s3:::my-bucket/*'","title":"Insecure Example"},{"location":"checks/sam/no-state-machine-policy-wildcards/#secure-example","text":"The following example will pass the AVD-AWS-0120 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good Example of SAM Function Resources : GoodFunction : Type : AWS::Serverless::StateMachine Properties : Definition : StartAt : MyLambdaState States : MyLambdaState : Type : Task Resource : arn:aws:lambda:us-east-1:123456123456:function:my-sample-lambda-app End : true Role : arn:aws:iam::123456123456:role/service-role/my-sample-role Tracing : Enabled : true Policies : - AWSLambdaExecute - Version : '2012-10-17' Statement : - Effect : Allow Action : - s3:GetObject - s3:GetObjectACL Resource : 'arn:aws:s3:::my-bucket/*'","title":"Secure Example"},{"location":"checks/sam/no-state-machine-policy-wildcards/#related-links","text":"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-statemachine.html#sam-statemachine-policies","title":"Related Links"},{"location":"checks/sns/enable-topic-encryption/","text":"Explanation Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues. Possible Impact The SNS topic messages could be read if compromised Suggested Resolution Turn on SNS Topic encryption Insecure Example The following example will fail the AVD-AWS-0095 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of topic Resources : Queue : Type : AWS::SNS::Topic Properties : TopicName : blah Secure Example The following example will pass the AVD-AWS-0095 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of topic Resources : Queue : Type : AWS::SQS::Topic Properties : TopicName : blah KmsMasterKeyId : some-key Related Links https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html","title":"enable-topic-encryption"},{"location":"checks/sns/enable-topic-encryption/#explanation","text":"Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues.","title":"Explanation"},{"location":"checks/sns/enable-topic-encryption/#possible-impact","text":"The SNS topic messages could be read if compromised","title":"Possible Impact"},{"location":"checks/sns/enable-topic-encryption/#suggested-resolution","text":"Turn on SNS Topic encryption","title":"Suggested Resolution"},{"location":"checks/sns/enable-topic-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0095 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of topic Resources : Queue : Type : AWS::SNS::Topic Properties : TopicName : blah","title":"Insecure Example"},{"location":"checks/sns/enable-topic-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0095 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of topic Resources : Queue : Type : AWS::SQS::Topic Properties : TopicName : blah KmsMasterKeyId : some-key","title":"Secure Example"},{"location":"checks/sns/enable-topic-encryption/#related-links","text":"https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html","title":"Related Links"},{"location":"checks/sqs/enable-queue-encryption/","text":"Explanation Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues. Possible Impact The SQS queue messages could be read if compromised Suggested Resolution Turn on SQS Queue encryption Insecure Example The following example will fail the AVD-AWS-0096 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of queue Resources : Queue : Type : AWS::SQS::Queue Properties : QueueName : my-queue Secure Example The following example will pass the AVD-AWS-0096 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of queue Resources : Queue : Type : AWS::SQS::Queue Properties : KmsMasterKeyId : some-key QueueName : my-queue Related Links https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html","title":"enable-queue-encryption"},{"location":"checks/sqs/enable-queue-encryption/#explanation","text":"Queues should be encrypted with customer managed KMS keys and not default AWS managed keys, in order to allow granular control over access to specific queues.","title":"Explanation"},{"location":"checks/sqs/enable-queue-encryption/#possible-impact","text":"The SQS queue messages could be read if compromised","title":"Possible Impact"},{"location":"checks/sqs/enable-queue-encryption/#suggested-resolution","text":"Turn on SQS Queue encryption","title":"Suggested Resolution"},{"location":"checks/sqs/enable-queue-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0096 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of queue Resources : Queue : Type : AWS::SQS::Queue Properties : QueueName : my-queue","title":"Insecure Example"},{"location":"checks/sqs/enable-queue-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0096 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of queue Resources : Queue : Type : AWS::SQS::Queue Properties : KmsMasterKeyId : some-key QueueName : my-queue","title":"Secure Example"},{"location":"checks/sqs/enable-queue-encryption/#related-links","text":"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-server-side-encryption.html","title":"Related Links"},{"location":"checks/sqs/no-wildcards-in-policy-documents/","text":"Explanation SQS Policy actions should always be restricted to a specific set. This ensures that the queue itself cannot be modified or deleted, and prevents possible future additions to queue actions to be implicitly allowed. Possible Impact SQS policies with wildcard actions allow more that is required Suggested Resolution Keep policy scope to the minimum that is required to be effective Insecure Example The following example will fail the AVD-AWS-0097 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of queue policy Resources : MyQueue : Type : AWS::SQS::Queue Properties : Name : something SampleSQSPolicy : Type : AWS::SQS::QueuePolicy Properties : Queues : - !Ref MyQueue PolicyDocument : Statement : - Action : - \"*\" Effect : \"Allow\" Resource : \"arn:aws:sqs:us-east-2:444455556666:queue2\" Principal : AWS : - \"111122223333\" Secure Example The following example will pass the AVD-AWS-0097 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of queue policy Resources : MyQueue : Type : AWS::SQS::Queue Properties : Name : something SampleSQSPolicy : Type : AWS::SQS::QueuePolicy Properties : Queues : - Ref : MyQueue PolicyDocument : Statement : - Action : - \"SQS:SendMessage\" - \"SQS:ReceiveMessage\" Effect : \"Allow\" Resource : \"arn:aws:sqs:us-east-2:444455556666:queue2\" Principal : AWS : - \"111122223333\" Related Links https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-security-best-practices.html","title":"no-wildcards-in-policy-documents"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#explanation","text":"SQS Policy actions should always be restricted to a specific set. This ensures that the queue itself cannot be modified or deleted, and prevents possible future additions to queue actions to be implicitly allowed.","title":"Explanation"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#possible-impact","text":"SQS policies with wildcard actions allow more that is required","title":"Possible Impact"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#suggested-resolution","text":"Keep policy scope to the minimum that is required to be effective","title":"Suggested Resolution"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#insecure-example","text":"The following example will fail the AVD-AWS-0097 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of queue policy Resources : MyQueue : Type : AWS::SQS::Queue Properties : Name : something SampleSQSPolicy : Type : AWS::SQS::QueuePolicy Properties : Queues : - !Ref MyQueue PolicyDocument : Statement : - Action : - \"*\" Effect : \"Allow\" Resource : \"arn:aws:sqs:us-east-2:444455556666:queue2\" Principal : AWS : - \"111122223333\"","title":"Insecure Example"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#secure-example","text":"The following example will pass the AVD-AWS-0097 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of queue policy Resources : MyQueue : Type : AWS::SQS::Queue Properties : Name : something SampleSQSPolicy : Type : AWS::SQS::QueuePolicy Properties : Queues : - Ref : MyQueue PolicyDocument : Statement : - Action : - \"SQS:SendMessage\" - \"SQS:ReceiveMessage\" Effect : \"Allow\" Resource : \"arn:aws:sqs:us-east-2:444455556666:queue2\" Principal : AWS : - \"111122223333\"","title":"Secure Example"},{"location":"checks/sqs/no-wildcards-in-policy-documents/#related-links","text":"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-security-best-practices.html","title":"Related Links"},{"location":"checks/ssm/secret-use-customer-key/","text":"Explanation Secrets Manager encrypts secrets by default using a default key created by AWS. To ensure control and granularity of secret encryption, CMK's should be used explicitly. Possible Impact Using AWS managed keys reduces the flexibility and control over the encryption key Suggested Resolution Use customer managed keys Insecure Example The following example will fail the AVD-AWS-0098 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of secret Resources : BadSecret : Type : AWS::SecretsManager::Secret Properties : Description : \"secret\" Name : \"blah\" SecretString : \"don't tell anyone\" Secure Example The following example will pass the AVD-AWS-0098 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of ingress rule Resources : Secret : Type : AWS::SecretsManager::Secret Properties : Description : \"secret\" KmsKeyId : \"my-key-id\" Name : \"blah\" SecretString : \"don't tell anyone\" Related Links https://docs.aws.amazon.com/kms/latest/developerguide/services-secrets-manager.html#asm-encrypt","title":"secret-use-customer-key"},{"location":"checks/ssm/secret-use-customer-key/#explanation","text":"Secrets Manager encrypts secrets by default using a default key created by AWS. To ensure control and granularity of secret encryption, CMK's should be used explicitly.","title":"Explanation"},{"location":"checks/ssm/secret-use-customer-key/#possible-impact","text":"Using AWS managed keys reduces the flexibility and control over the encryption key","title":"Possible Impact"},{"location":"checks/ssm/secret-use-customer-key/#suggested-resolution","text":"Use customer managed keys","title":"Suggested Resolution"},{"location":"checks/ssm/secret-use-customer-key/#insecure-example","text":"The following example will fail the AVD-AWS-0098 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of secret Resources : BadSecret : Type : AWS::SecretsManager::Secret Properties : Description : \"secret\" Name : \"blah\" SecretString : \"don't tell anyone\"","title":"Insecure Example"},{"location":"checks/ssm/secret-use-customer-key/#secure-example","text":"The following example will pass the AVD-AWS-0098 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of ingress rule Resources : Secret : Type : AWS::SecretsManager::Secret Properties : Description : \"secret\" KmsKeyId : \"my-key-id\" Name : \"blah\" SecretString : \"don't tell anyone\"","title":"Secure Example"},{"location":"checks/ssm/secret-use-customer-key/#related-links","text":"https://docs.aws.amazon.com/kms/latest/developerguide/services-secrets-manager.html#asm-encrypt","title":"Related Links"},{"location":"checks/vpc/add-description-to-security-group-rule/","text":"Explanation Security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups rules Insecure Example The following example will fail the AVD-AWS-0099 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of SGR description Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 127.0.0.1/32 IpProtocol : \"-1\" Secure Example The following example will pass the AVD-AWS-0099 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of SGR description Resources : GoodSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 127.0.0.1/32 Description : \"Can connect to loopback\" IpProtocol : \"-1\" Related Links https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"add-description-to-security-group-rule"},{"location":"checks/vpc/add-description-to-security-group-rule/#explanation","text":"Security group rules should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.","title":"Explanation"},{"location":"checks/vpc/add-description-to-security-group-rule/#possible-impact","text":"Descriptions provide context for the firewall rule reasons","title":"Possible Impact"},{"location":"checks/vpc/add-description-to-security-group-rule/#suggested-resolution","text":"Add descriptions for all security groups rules","title":"Suggested Resolution"},{"location":"checks/vpc/add-description-to-security-group-rule/#insecure-example","text":"The following example will fail the AVD-AWS-0099 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of SGR description Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 127.0.0.1/32 IpProtocol : \"-1\"","title":"Insecure Example"},{"location":"checks/vpc/add-description-to-security-group-rule/#secure-example","text":"The following example will pass the AVD-AWS-0099 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of SGR description Resources : GoodSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 127.0.0.1/32 Description : \"Can connect to loopback\" IpProtocol : \"-1\"","title":"Secure Example"},{"location":"checks/vpc/add-description-to-security-group-rule/#related-links","text":"https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"Related Links"},{"location":"checks/vpc/add-description-to-security-group/","text":"Explanation Security groups should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups. Possible Impact Descriptions provide context for the firewall rule reasons Suggested Resolution Add descriptions for all security groups Insecure Example The following example will fail the AVD-AWS-0099 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of group description Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : SecurityGroupEgress : - CidrIp : 127.0.0.1/32 IpProtocol : \"-1\" Secure Example The following example will pass the AVD-AWS-0099 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of group description Resources : GoodSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 127.0.0.1/32 IpProtocol : \"-1\" Related Links https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"add-description-to-security-group"},{"location":"checks/vpc/add-description-to-security-group/#explanation","text":"Security groups should include a description for auditing purposes. Simplifies auditing, debugging, and managing security groups.","title":"Explanation"},{"location":"checks/vpc/add-description-to-security-group/#possible-impact","text":"Descriptions provide context for the firewall rule reasons","title":"Possible Impact"},{"location":"checks/vpc/add-description-to-security-group/#suggested-resolution","text":"Add descriptions for all security groups","title":"Suggested Resolution"},{"location":"checks/vpc/add-description-to-security-group/#insecure-example","text":"The following example will fail the AVD-AWS-0099 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of group description Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : SecurityGroupEgress : - CidrIp : 127.0.0.1/32 IpProtocol : \"-1\"","title":"Insecure Example"},{"location":"checks/vpc/add-description-to-security-group/#secure-example","text":"The following example will pass the AVD-AWS-0099 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of group description Resources : GoodSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 127.0.0.1/32 IpProtocol : \"-1\"","title":"Secure Example"},{"location":"checks/vpc/add-description-to-security-group/#related-links","text":"https://www.cloudconformity.com/knowledge-base/aws/EC2/security-group-rules-description.html","title":"Related Links"},{"location":"checks/vpc/no-excessive-port-access/","text":"Explanation Ensure access to specific required ports is allowed, and nothing else. Possible Impact All ports exposed for egressing data Suggested Resolution Set specific allowed ports Insecure Example The following example will fail the AVD-AWS-0102 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of excessive ports Resources : NetworkACL : Type : AWS::EC2::NetworkAcl Properties : VpcId : \"something\" Rule : Type : AWS::EC2::NetworkAclEntry Properties : NetworkAclId : Ref : NetworkACL Protocol : -1 Secure Example The following example will pass the AVD-AWS-0102 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Godd example of excessive ports Resources : NetworkACL : Type : AWS::EC2::NetworkAcl Properties : VpcId : \"something\" Rule : Type : AWS::EC2::NetworkAclEntry Properties : NetworkAclId : Ref : NetworkACL Protocol : 6 Related Links https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html","title":"no-excessive-port-access"},{"location":"checks/vpc/no-excessive-port-access/#explanation","text":"Ensure access to specific required ports is allowed, and nothing else.","title":"Explanation"},{"location":"checks/vpc/no-excessive-port-access/#possible-impact","text":"All ports exposed for egressing data","title":"Possible Impact"},{"location":"checks/vpc/no-excessive-port-access/#suggested-resolution","text":"Set specific allowed ports","title":"Suggested Resolution"},{"location":"checks/vpc/no-excessive-port-access/#insecure-example","text":"The following example will fail the AVD-AWS-0102 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of excessive ports Resources : NetworkACL : Type : AWS::EC2::NetworkAcl Properties : VpcId : \"something\" Rule : Type : AWS::EC2::NetworkAclEntry Properties : NetworkAclId : Ref : NetworkACL Protocol : -1","title":"Insecure Example"},{"location":"checks/vpc/no-excessive-port-access/#secure-example","text":"The following example will pass the AVD-AWS-0102 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Godd example of excessive ports Resources : NetworkACL : Type : AWS::EC2::NetworkAcl Properties : VpcId : \"something\" Rule : Type : AWS::EC2::NetworkAclEntry Properties : NetworkAclId : Ref : NetworkACL Protocol : 6","title":"Secure Example"},{"location":"checks/vpc/no-excessive-port-access/#related-links","text":"https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html","title":"Related Links"},{"location":"checks/vpc/no-public-egress-sgr/","text":"Explanation Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible. Possible Impact Your port is egressing data to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the AVD-AWS-0104 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of egress rule Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 80.1.2.3/32 IpProtocol : \"6\" Secure Example The following example will pass the AVD-AWS-0104 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of egress rule Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 127.0.0.1/32 IpProtocol : \"6\" Related Links https://docs.aws.amazon.com/whitepapers/latest/building-scalable-secure-multi-vpc-network-infrastructure/centralized-egress-to-internet.html","title":"no-public-egress-sgr"},{"location":"checks/vpc/no-public-egress-sgr/#explanation","text":"Opening up ports to connect out to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that are explicitly required where possible.","title":"Explanation"},{"location":"checks/vpc/no-public-egress-sgr/#possible-impact","text":"Your port is egressing data to the internet","title":"Possible Impact"},{"location":"checks/vpc/no-public-egress-sgr/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/vpc/no-public-egress-sgr/#insecure-example","text":"The following example will fail the AVD-AWS-0104 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of egress rule Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 80.1.2.3/32 IpProtocol : \"6\"","title":"Insecure Example"},{"location":"checks/vpc/no-public-egress-sgr/#secure-example","text":"The following example will pass the AVD-AWS-0104 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of egress rule Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupEgress : - CidrIp : 127.0.0.1/32 IpProtocol : \"6\"","title":"Secure Example"},{"location":"checks/vpc/no-public-egress-sgr/#related-links","text":"https://docs.aws.amazon.com/whitepapers/latest/building-scalable-secure-multi-vpc-network-infrastructure/centralized-egress-to-internet.html","title":"Related Links"},{"location":"checks/vpc/no-public-ingress-acl/","text":"Explanation Opening up ACLs to the public internet is potentially dangerous. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact The ports are exposed for ingressing data to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the AVD-AWS-0105 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of excessive ports Resources : NetworkACL : Type : AWS::EC2::NetworkAcl Properties : VpcId : \"something\" Rule : Type : AWS::EC2::NetworkAclEntry Properties : NetworkAclId : Ref : NetworkACL Protocol : 6 CidrBlock : 0.0.0.0/0 RuleAction : allow Secure Example The following example will pass the AVD-AWS-0105 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Godd example of excessive ports Resources : NetworkACL : Type : AWS::EC2::NetworkAcl Properties : VpcId : \"something\" Rule : Type : AWS::EC2::NetworkAclEntry Properties : NetworkAclId : Ref : NetworkACL Protocol : 6 CidrBlock : 10.0.0.0/8 RuleAction : allow Related Links https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html","title":"no-public-ingress-acl"},{"location":"checks/vpc/no-public-ingress-acl/#explanation","text":"Opening up ACLs to the public internet is potentially dangerous. You should restrict access to IP addresses or ranges that explicitly require it where possible.","title":"Explanation"},{"location":"checks/vpc/no-public-ingress-acl/#possible-impact","text":"The ports are exposed for ingressing data to the internet","title":"Possible Impact"},{"location":"checks/vpc/no-public-ingress-acl/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/vpc/no-public-ingress-acl/#insecure-example","text":"The following example will fail the AVD-AWS-0105 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of excessive ports Resources : NetworkACL : Type : AWS::EC2::NetworkAcl Properties : VpcId : \"something\" Rule : Type : AWS::EC2::NetworkAclEntry Properties : NetworkAclId : Ref : NetworkACL Protocol : 6 CidrBlock : 0.0.0.0/0 RuleAction : allow","title":"Insecure Example"},{"location":"checks/vpc/no-public-ingress-acl/#secure-example","text":"The following example will pass the AVD-AWS-0105 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Godd example of excessive ports Resources : NetworkACL : Type : AWS::EC2::NetworkAcl Properties : VpcId : \"something\" Rule : Type : AWS::EC2::NetworkAclEntry Properties : NetworkAclId : Ref : NetworkACL Protocol : 6 CidrBlock : 10.0.0.0/8 RuleAction : allow","title":"Secure Example"},{"location":"checks/vpc/no-public-ingress-acl/#related-links","text":"https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html","title":"Related Links"},{"location":"checks/vpc/no-public-ingress-sgr/","text":"Explanation Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible. Possible Impact Your port exposed to the internet Suggested Resolution Set a more restrictive cidr range Insecure Example The following example will fail the AVD-AWS-0107 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of ingress rule Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupIngress : - CidrIp : 80.1.2.3/32 IpProtocol : \"6\" Secure Example The following example will pass the AVD-AWS-0107 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of ingress rule Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupIngress : - CidrIp : 127.0.0.1/32 IpProtocol : \"6\" Related Links https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html","title":"no-public-ingress-sgr"},{"location":"checks/vpc/no-public-ingress-sgr/#explanation","text":"Opening up ports to the public internet is generally to be avoided. You should restrict access to IP addresses or ranges that explicitly require it where possible.","title":"Explanation"},{"location":"checks/vpc/no-public-ingress-sgr/#possible-impact","text":"Your port exposed to the internet","title":"Possible Impact"},{"location":"checks/vpc/no-public-ingress-sgr/#suggested-resolution","text":"Set a more restrictive cidr range","title":"Suggested Resolution"},{"location":"checks/vpc/no-public-ingress-sgr/#insecure-example","text":"The following example will fail the AVD-AWS-0107 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Bad example of ingress rule Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupIngress : - CidrIp : 80.1.2.3/32 IpProtocol : \"6\"","title":"Insecure Example"},{"location":"checks/vpc/no-public-ingress-sgr/#secure-example","text":"The following example will pass the AVD-AWS-0107 check. --- AWSTemplateFormatVersion : 2010-09-09 Description : Good example of ingress rule Resources : BadSecurityGroup : Type : AWS::EC2::SecurityGroup Properties : GroupDescription : Limits security group egress traffic SecurityGroupIngress : - CidrIp : 127.0.0.1/32 IpProtocol : \"6\"","title":"Secure Example"},{"location":"checks/vpc/no-public-ingress-sgr/#related-links","text":"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-rules-reference.html","title":"Related Links"},{"location":"checks/workspaces/enable-disk-encryption/","text":"Explanation Workspace volumes for both user and root should be encrypted to protect the data stored on them. Possible Impact Data can be freely read if compromised Suggested Resolution Root and user volume encryption should be enabled Insecure Example The following example will fail the AVD-AWS-0109 check. --- Resources : BadExample : Type : AWS::WorkSpaces::Workspace Properties : RootVolumeEncryptionEnabled : false UserVolumeEncryptionEnabled : false UserName : \"admin\" Secure Example The following example will pass the AVD-AWS-0109 check. --- Resources : GoodExample : Type : AWS::WorkSpaces::Workspace Properties : RootVolumeEncryptionEnabled : true UserVolumeEncryptionEnabled : true UserName : \"admin\" Related Links https://docs.aws.amazon.com/workspaces/latest/adminguide/encrypt-workspaces.html","title":"enable-disk-encryption"},{"location":"checks/workspaces/enable-disk-encryption/#explanation","text":"Workspace volumes for both user and root should be encrypted to protect the data stored on them.","title":"Explanation"},{"location":"checks/workspaces/enable-disk-encryption/#possible-impact","text":"Data can be freely read if compromised","title":"Possible Impact"},{"location":"checks/workspaces/enable-disk-encryption/#suggested-resolution","text":"Root and user volume encryption should be enabled","title":"Suggested Resolution"},{"location":"checks/workspaces/enable-disk-encryption/#insecure-example","text":"The following example will fail the AVD-AWS-0109 check. --- Resources : BadExample : Type : AWS::WorkSpaces::Workspace Properties : RootVolumeEncryptionEnabled : false UserVolumeEncryptionEnabled : false UserName : \"admin\"","title":"Insecure Example"},{"location":"checks/workspaces/enable-disk-encryption/#secure-example","text":"The following example will pass the AVD-AWS-0109 check. --- Resources : GoodExample : Type : AWS::WorkSpaces::Workspace Properties : RootVolumeEncryptionEnabled : true UserVolumeEncryptionEnabled : true UserName : \"admin\"","title":"Secure Example"},{"location":"checks/workspaces/enable-disk-encryption/#related-links","text":"https://docs.aws.amazon.com/workspaces/latest/adminguide/encrypt-workspaces.html","title":"Related Links"},{"location":"getting-started/credits/","text":"Authors Liam Galvin (liamg) Owen Rumney (owenrumney)","title":"Authors"},{"location":"getting-started/credits/#authors","text":"Liam Galvin (liamg) Owen Rumney (owenrumney)","title":"Authors"},{"location":"getting-started/installation/","text":"Install with brew/linuxbrew: brew tap cfsec/cfsec Install with Chocolatey: choco install cfsec You can grab the binary for your system from the releases page . Install with Go: go install github.com/aquasecurity/cfsec/cmd/cfsec@latest","title":"Installation"},{"location":"getting-started/installation/#install-with-brewlinuxbrew","text":"brew tap cfsec/cfsec","title":"Install with brew/linuxbrew:"},{"location":"getting-started/installation/#install-with-chocolatey","text":"choco install cfsec You can grab the binary for your system from the releases page .","title":"Install with Chocolatey:"},{"location":"getting-started/installation/#install-with-go","text":"go install github.com/aquasecurity/cfsec/cmd/cfsec@latest","title":"Install with Go:"},{"location":"getting-started/quickstart/","text":"Using as a command line tool The easiest way to run cfsec is to run it in the directory you want to scan. cfsec cfsec will traverse the directory structure processing valid CloudFormation file. If you want to run on a specific location, this can be passed as an argument; cfsec ./stacks/prod/bucket.yaml The exit status will be non-zero if cfsec finds problems, otherwise the exit status will be zero. Use with Docker As an alternative to installing and running cfsec on your system, you may run cfsec in a Docker container. To run: docker run --rm -it -v \" $( pwd ) :/src\" aquasec/cfsec /src Using in CI cfsec can be added to any CI pipeline as a command with the exit code dictating if it breaks the build. We do provide a GitHub Action that will also upload the results to GitHub code scanning UI. Passing Arguments This page only covers the basics of what cfsec can do - much more is achievable using the arguments on the Parameters page.","title":"Quick Start"},{"location":"getting-started/quickstart/#using-as-a-command-line-tool","text":"The easiest way to run cfsec is to run it in the directory you want to scan. cfsec cfsec will traverse the directory structure processing valid CloudFormation file. If you want to run on a specific location, this can be passed as an argument; cfsec ./stacks/prod/bucket.yaml The exit status will be non-zero if cfsec finds problems, otherwise the exit status will be zero.","title":"Using as a command line tool"},{"location":"getting-started/quickstart/#use-with-docker","text":"As an alternative to installing and running cfsec on your system, you may run cfsec in a Docker container. To run: docker run --rm -it -v \" $( pwd ) :/src\" aquasec/cfsec /src","title":"Use with Docker"},{"location":"getting-started/quickstart/#using-in-ci","text":"cfsec can be added to any CI pipeline as a command with the exit code dictating if it breaks the build. We do provide a GitHub Action that will also upload the results to GitHub code scanning UI.","title":"Using in CI"},{"location":"getting-started/quickstart/#passing-arguments","text":"This page only covers the basics of what cfsec can do - much more is achievable using the arguments on the Parameters page.","title":"Passing Arguments"},{"location":"getting-started/usage/","text":"cfsec can by run with no arguments and will act on the current folder. For a richer experience, there are many additional command line arguments that you can make use of. Argument Short Code Description --format [default,json,csv] -f Select output format: default, json, csv --help -h help for cfsec --no-color Disable colored output (American style!) --no-colour Disable coloured output --parameters -p Pass overrides for parameter values --verbose Enable verbose logging --version -v Show version information and exit This list can also be found by running cfsec --help","title":"Parameters"},{"location":"getting-started/configuration/github-actions/github-action/","text":"What is it? Github security alerts sit on the Security tab in your github project and detail any security issues that have been found. cfsec can enrich this information, annotating the exact areas in the code base for a given branch with the details of the failure and the severity. We have provided an action which can be used in your github repo with very little effort. Adding the action Github Actions make it easy to add functionality; to add an action, go to the Action tab to create a new workflow and choose to Set up a workflow yourself. Paste in the workflow content below (be sure to check you're using the latest version of the cfsec-sarif-action by checking here ) name : cfsec on : push : branches : - main pull_request : jobs : cfsec : name : cfsec sarif report runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : cfsec uses : cfsec/cfsec-sarif-action@main with : sarif_file : cfsec.sarif - name : Upload SARIF file uses : github/codeql-action/upload-sarif@v1 with : # Path to SARIF file relative to the root of the repository sarif_file : cfsec.sarif What is this doing? Basically, this action is starting a new ubuntu github action container and checking out the code for either the pull request or the push to master/main . Once the code has been checked out, cfsec with process everything in the local path and generate a sarif report. Finally, the sarif report will be uploaded and the Security tab updated with the identified checks. It will look something like; Anything else I should know? If you have code that is deeper in the github repo, you can use working_directory for the action; - name : cfsec uses : cfsec/cfsec-sarif-action@v0.0.3 with : working_directory : stacks/prod sarif_file : cfsec.sarif github_token : ${{ secrets.GITHUB_TOKEN }} This will target the checks to all folders under stacks/prod","title":"GitHub Action"},{"location":"getting-started/configuration/github-actions/github-action/#what-is-it","text":"Github security alerts sit on the Security tab in your github project and detail any security issues that have been found. cfsec can enrich this information, annotating the exact areas in the code base for a given branch with the details of the failure and the severity. We have provided an action which can be used in your github repo with very little effort.","title":"What is it?"},{"location":"getting-started/configuration/github-actions/github-action/#adding-the-action","text":"Github Actions make it easy to add functionality; to add an action, go to the Action tab to create a new workflow and choose to Set up a workflow yourself. Paste in the workflow content below (be sure to check you're using the latest version of the cfsec-sarif-action by checking here ) name : cfsec on : push : branches : - main pull_request : jobs : cfsec : name : cfsec sarif report runs-on : ubuntu-latest steps : - name : Clone repo uses : actions/checkout@master - name : cfsec uses : cfsec/cfsec-sarif-action@main with : sarif_file : cfsec.sarif - name : Upload SARIF file uses : github/codeql-action/upload-sarif@v1 with : # Path to SARIF file relative to the root of the repository sarif_file : cfsec.sarif","title":"Adding the action"},{"location":"getting-started/configuration/github-actions/github-action/#what-is-this-doing","text":"Basically, this action is starting a new ubuntu github action container and checking out the code for either the pull request or the push to master/main . Once the code has been checked out, cfsec with process everything in the local path and generate a sarif report. Finally, the sarif report will be uploaded and the Security tab updated with the identified checks. It will look something like;","title":"What is this doing?"},{"location":"getting-started/configuration/github-actions/github-action/#anything-else-i-should-know","text":"If you have code that is deeper in the github repo, you can use working_directory for the action; - name : cfsec uses : cfsec/cfsec-sarif-action@v0.0.3 with : working_directory : stacks/prod sarif_file : cfsec.sarif github_token : ${{ secrets.GITHUB_TOKEN }} This will target the checks to all folders under stacks/prod","title":"Anything else I should know?"}]}